var ImgMotie="",MotieHost="",$IE=$.browser.msie,$win=$(window),$html=$("html"),$IE6=$IE&&"6.0"==$.browser.version,$IE7=$IE&&"7.0"==$.browser.version,$IE8=$IE&&"8.0"==$.browser.version,proxy={$:$},$OLDIE=$IE6||$IE7||$IE8;$.fn.xresize=function(t,e,i){var a,o=!1,i=i||$.noop;return e=e||"scroll resize",this.bind(e,function(e){var n=this;a&&(clearTimeout(a),a=null),0==o&&(o=!0,i.call(n,e)),a=setTimeout(function(){o=!1,t.call(n,e)},100)})},function(t){"function"==typeof define&&define.amd?define(["jquery"],t):t(jQuery)}(function(t){function e(t){return t}function i(t){return decodeURIComponent(t.replace(o," "))}function a(t){0===t.indexOf('"')&&(t=t.slice(1,-1).replace(/\\"/g,'"').replace(/\\\\/g,"\\"));try{return n.json?JSON.parse(t):t}catch(e){}}var o=/\+/g,n=t.cookie=function(o,s,r){if(void 0!==s){if(r=t.extend({},n.defaults,r),"number"==typeof r.expires){var l=r.expires,c=r.expires=new Date;c.setDate(c.getDate()+l)}return s=n.json?JSON.stringify(s):String(s),document.cookie=[encodeURIComponent(o),"=",n.raw?s:encodeURIComponent(s),r.expires?"; expires="+r.expires.toUTCString():"",r.path?"; path="+r.path:"",r.domain?"; domain="+r.domain:"",r.secure?"; secure":""].join("")}for(var d=n.raw?e:i,u=document.cookie.split("; "),h=o?void 0:{},f=0,m=u.length;f<m;f++){var p=u[f].split("="),g=d(p.shift()),y=d(p.join("="));if(o&&o===g){h=a(y);break}o||(h[g]=a(y))}return h};n.defaults={},t.removeCookie=function(e,i){return void 0!==t.cookie(e)&&(t.cookie(e,"",t.extend(i,{expires:-1})),!0)}}),Date.prototype.format=function(t){var e={"M+":this.getMonth()+1,"d+":this.getDate(),"h+":this.getHours(),"m+":this.getMinutes(),"s+":this.getSeconds(),"q+":Math.floor((this.getMonth()+3)/3),S:this.getMilliseconds()};/(y+)/.test(t)&&(t=t.replace(RegExp.$1,(this.getFullYear()+"").substr(4-RegExp.$1.length)));for(var i in e)new RegExp("("+i+")").test(t)&&(t=t.replace(RegExp.$1,1==RegExp.$1.length?e[i]:("00"+e[i]).substr((""+e[i]).length)));return t},Date.prototype.getDiffTime=function(t){if("object"==typeof t){var e=this.getTime()-t.getTime();return e>0?e:-e}return 0},Date.prototype.addTime=function(t){this.setTime(this.getTime()+t)},Date.prototype.getShowTime=function(t){var e=new Date;if(e.setHours(0),e.setMinutes(0),e.setSeconds(0),this.getTime()>e.getTime()){var i=this.getDiffTime(t)/1e3;if(i<=10)return"10秒前";if(i<=50)return 10*Math.ceil(i/10)+"秒前";if(i<3600)return Math.ceil(i/60)+"分钟前";if(i<86400)return"今天"+this.format("hh:mm")}},Date.getDate=function(t){var e=t;if(0==e.length)return!1;var i=/^(\d{1,4})(-|\/)(\d{1,2})\2(\d{1,2})/,a=e.match(i);if(null!=a&&(e+=" 00:00:00"),i=/^(\d{1,4})(-|\/)(\d{1,2})\2(\d{1,2}) (\d{1,2}):(\d{1,2}):(\d{1,2})/,a=e.match(i),null==a)return console.log("你输入的日期格式有误，正确格式为：2004-12-01 或 2004-12-01 12:23:45"),!1;var o=new Date(a[1],a[3]-1,a[4],a[5],a[6],a[7]);return o.getFullYear()==a[1]&&o.getMonth()+1==a[3]&&o.getDate()==a[4]&&o.getHours()==a[5]&&o.getMinutes()==a[6]&&o.getSeconds()==a[7]?o:(console.log("你输入的日期或时间超出有效范围，请仔细检查！"),!1)},Array.prototype.in_array=function(t){for(i=0;i<this.length;i++)if(this[i]==t)return!0;return!1},function(){Motie=Mo={},$(function(){$body=oBody=$("body"),$main=$("#main")}),Motie.config={domain:"http://www.motie.com",ImageServer:"http://img.motieimg.com"},ImgMotie=Motie.config.ImageServer,Motie.init={UserMenu:function(){var t=$("#user-slide-menu"),e=$("#person-status"),i=function(){e.removeClass("person-status-active"),t.hide(),$(document).unbind("click",i)};return e.click(function(){t.width(e.outerWidth()),t.is(":visible")?(e.removeClass("person-status-active"),t.hide()):(e.addClass("person-status-active"),t.show(),setTimeout(function(){$(document).bind("click",i)},100))}).hover(function(){e.addClass("person-status-hover")},function(){e.removeClass("person-status-hover")}),this},ReturnTop:function(t){var e=$(".mo-ui-top-bar");t=$.extend({where:"body",bottom:e.data("ie6-bottom")||36,alwaysShow:!!e.length&&!!e.data("always-show"),html:e.length?e:'<div class="fixed-rb"><a class="goTop" href="javascript:;" title="返回顶端"></a></div>',onRendered:$.noop});var i=$(t.html),a=i.find(".goTop"),o=!1;return $("body").hasClass("no-top")||(a.click(function(){$win.scrollTop(0)}),$IE6&&i.css("bottom","auto"),$(window).xresize(function(){var e=$win.scrollTop(),a=$win.height(),n=0,s=i.height()+t.bottom;$IE6&&(n=e>0?e+a-s:a-s,i.show().css("top",n),o=!1),e>0||t.alwaysShow?i.show().stop().animate({opacity:"1"},"fast"):t.alwaysShow||0!=e||i.stop().animate({opacity:"0"},"fast",function(){i.hide()})},"resize.gotop scroll.gotop",function(){$IE6&&i.hide()}),$(t.where).append(i),$win.trigger("scroll.gotop")),this},RepeatedSubmission:function(){return $("form").length&&$("form").each(function(){var t=$(this).data("submiting",!1),e=t.find(":submit, :image");t.submit(function(){$(this).validate||t.data("submiting",!0)}),e.click(function(){if(!$(this).validate&&t.data("submiting")===!0)return!1})}),this},HeaderBubble:function(t){if(""==_config)return this;var e=$(".new_header").length?35:55,i=$(".bubbleFixed"),a=!1,o=$(window),n=null,t=void 0===t?e:t,s=i.find(".close-layer"),r=function(){a?o.scrollTop()>t?$IE6?i.css("top",o.scrollTop()+"px"):i.css("top",0):i.css("top",t+"px"):i.css("top","-999999px")},l=function(){var t=$("#layer-remind"),e=$("#refreshDiv"),i=$("#twitter-page"),o=t.find("ul"),s=(o.find("li"),"undefined"!=typeof timestamp||i.length?{timestamp:timestamp,t:Math.random(),currentEventId:i.find(".mod-all-message .mod-basic-txtbox-layout .txtbox-item:not(.removme):first").data("event-id")}:{t:Math.random()});$.getJSON("/ajax/bubble?callback=?",s,function(i){if(void 0==i)return clearInterval(n),n=null,t.hide(),void(a=!1);var s={follower:0,notice:0,sys_msg:0,msg:0,atme_twitter:0,atme_reply:0,invite_count:0,custom_answer_count:0};i=$.extend({},s,i),$("#layer-remind li").each(function(){$(this).remove()});var l=[0==i.follower?"":"<li>"+i.follower+"位新粉丝,<a href='/contact/follower'>点击查看</a></li>",0==i.notice?"":"<li>"+i.notice+"条新提醒,<a href='/msg/notice'>点击查看</a></li>",0==i.sys_msg?"":"<li>"+i.sys_msg+"条新通知,<a href='/msg/system'>点击查看</a></li>",0==i.msg?"":"<li>"+i.msg+"条新私信,<a href='/msg'>点击查看</a></li>",0==i.atme_twitter?"":"<li>"+i.atme_twitter+"条@我的微博,<a href='/msg/atme'>点击查看</a></li>",0==i.atme_reply?"":"<li>"+i.atme_reply+"条@我的回应,<a href='/msg/atme/?type=7'>点击查看</a></li>",0==i.invite_count?"":"<li>"+i.invite_count+"条待处理的邀请,<a href='/group/invite/accept'>点击查看</a></li>",0==i.custom_answer_count?"":"<li>"+i.custom_answer_count+"条客服留言,<a href='/msg/kefu'>点击查看</a></li>"].join("");if(o.append(l),o.find("li").length?(a=!0,t.show(),r()):a=!1,i.event_count>0)if(void 0!=window.NEW_TWITTER)e.is(":hidden")&&$(".mod-update").show();else{var c,d=$(".mod-all-message .mod-tabs li[class=current]").attr("data-index");ALL_INDEX!=d&&(c="/?index="+ALL_INDEX,e.find("a").removeAttr("onclick").attr("href",c)),e.is(":hidden")&&$(".mod-update").show()}})};return s.click(function(){a=!1,r(),window.clearInterval(n)}),o.xresize(r),window.setTimeout(l,3e3),n=window.setInterval(l,6e4),this},BindNameCard:function(){return Motie.nameCard&&Motie.nameCard.bind("body"),this},BindMediaPlayer:function(){return Motie.MediaPlayer.bind("body"),this},TextareaAutoHeight:function(){return $.fn.elastic&&$("textarea.autoHeight").length&&$("textarea.autoHeight").elastic(),this},LazyLoad:function(){return Mo.lazyload({defObj:"#main"}),this},CustomSelect:function(){return Motie.customSelect&&$(".custom-select").length&&$(".custom-select").each(function(){this.name&&new Motie.customSelect(this)}),this},TextDefaultValue:function(){return $.fn.inputDefault&&$("input[placeholder], input[default-value]").each(function(){($.browser.msie||""==this.placeholder)&&$(this).inputDefault()}),this},MedalCard:function(){return Motie.medalCard&&$(".mod-author-info .ico-area a.medal[id]").length&&$(".mod-author-info .ico-area a.medal[id]").each(function(){new Motie.medalCard(this)}),this},Search:function(){return $(".search-top").length&&Mo.ui.search&&Mo.ui.search(".search-top","/ajax/rest/"),this},CreateMessage:function(){return Motie.createMessage&&$(".mod-dk").length&&$(".mod-dk").each(function(t){var e,i=($(this),this.id);e=new Motie.createMessage({max:140,ele:this}),this.id&&(Motie.createMessage.cache[i]=e)}),this},bindDelegate:function(){return Mo.core.delegate&&Mo.core.delegate(),this},bindCommentSend:function(){return Mo.core.action.comment&&$("div[role=data-comment],ul[role=data-comment]").each(function(){0!=$(this).data("comment-init")&&Mo.core.action.comment().bind($(this))}),this},TwoConfirmations:function(){return $(".delete").live("click",function(){return confirm("确定要删除吗？")}),$(".confim").live("click",function(){var t=$(this).attr("msg");return""==t&&(t="确认删除？"),confirm(t)}),this},getProxy:function(){return proxy.ele=$("#proxy"),proxy.ele.length&&proxy.ele.on("load",function(){proxy.$=proxy.ele[0].contentWindow.$}),this},InitAll:function(){this.BindNameCard().getProxy().CreateMessage().CustomSelect().HeaderBubble().LazyLoad().MedalCard().ReturnTop().RepeatedSubmission().BindMediaPlayer().TextDefaultValue().bindDelegate().bindCommentSend().Search(),$("#bastard").length&&new Motie.subNav({ele:$("#bastard"),subnav:$("#layer-more")})}},Motie.error=[],Motie.bindAtTo=function(t){var e='<ul>{{#users}}<li id="{{uid}}">{{{username}}}</li>{{/users}}</ul>';$(t).textbox({dataUrl:"/ajax/atme/follow/list?callback=?",listTmpl:e})},Motie.delay=function(t,e){return setTimeout(t,e||1)},Motie.register=function(t,e){for(var i=t.split("."),a=Motie,o=Motie.error,n=null;n=i.shift();)if(i.length)void 0===a[n]&&(a[n]={}),a=a[n];else if(void 0===a[n])try{a[n]=e(Motie)}catch(s){o.push(s)}},Motie.CheckLogin=function(){return function(t,e){return e=$.extend({reload:!0,onClose:$.noop,onSuccess:$.noop,html:""},e),""!=_config||(t&&new Mo.openAjaxDialog({destroy:!0,width:580,layerClass:"mo-login-dialog",url:"/ajax/login/showLayer",onload:function(t){function i(){var t=Math.ceil(1e12*Math.random());o.attr("src","/ajax/auth/code?t="+t),n.val(t)}function a(){u.html(u.find("script").html()),o=u.find("img"),n=u.find("input[name=t]"),s=u.find("a"),codeInput=u.find("input[name=code]"),s.click(function(){return i(),!1})}var o,n,s,r=t.layer,l=r.find("input[type=email]"),c=r.find(".M-button-submit"),d=r.find("form"),u=r.find(".authCode"),h=Mo.ui.ico,f=Mo.core.ajaxStatus;u.data("need-code")&&(a(),i(),$(".itemc label").inFieldLabels()),t.validate=d.validate({submitHandler:function(o){$(o).ajaxSubmit({beforeSubmit:function(){f.processing(c),c.addClass("M-button-disabled").html(h.loading+h.sp+" 登录中")},success:function(o){f.done(c),c.removeClass("M-button-disabled"),"success"==o.code?(c.addClass("M-button-green").html(h.loading+h.sp+" 登录成功"),e.reload&&(location.href=location.href),e.onSuccess.call(t,o,!1)):(r.find("input[name=code]").length||($(".itemc label").inFieldLabels(),a()),i(),c.html("登录"),$(".alert-error-p").addClass("alert-error").html(o.message),e.onSuccess.call(t,o,!0))}})},rules:{both:{required:!0,email:!0},password:{required:!0},code:{required:!!r.find("input[name=code]").length}},messages:{both:{required:"",email:""},password:{required:" "},code:{required:" "}},errorPlacement:function(t,e){e.parent().parent().parent().append(t)}}),l.blur(function(){l.valid()}),c.click(function(){f.inProcess(c)||d.submit()})},onHide:function(t){e.onClose.call(t)}}).render(),!1)}}(),Motie.ResponseType=function(t){return"{"==t.substring(0,1)?"json":"html"},Motie.ResponseCheck=function(data){var params={html:"",refresh:!1,success:$.noop,error:$.noop};$.extend(params,data);var html=$.trim(params.html),code=!1,msg,data,type=Motie.ResponseType(html);"json"==type&&(data=eval("("+html+")"),msg=data.message,code=data.code),"html"==type||"ok"==code||params.html===!0?params.success(html):"json"!=type&&params.html!==!1||"refresh"!=code&&"error"!=code||new Mo.alert({type:"error",data:{html:msg},onRendered:function(t){params.error(code,msg,t),params.refresh&&setTimeout(function(){t.change({type:"loading",html:msg})},2e3),setTimeout(function(){t.hideLayer()},3e3)}}).render()};var layerClass=Base.extend({constructor:function(t){var e={handle:"",closeHandle:"",destroy:!0,renderShow:!0,onRender:$.noop,onRendered:$.noop,onShow:$.noop,onHide:$.noop,tpl:layerClass.tplStore.basicTpl,data:{},layerClass:"",layerId:"",overlay:!0,fixed:!1,fixCenter:!0,eventType:"click",effectShow:!1,effectHide:!1,effectShowOption:{},effectHideOption:{},effectShowCallback:$.noop,effectHideCallback:$.noop,showDuration:800,hideDuration:800,toggleShow:!1,draggable:!1,width:"auto",height:"auto",position:"middle",offset:{x:0,y:0},insertType:"append",where:"body",html:"",tplUrl:"",tplData:"",onLoadTpl:$.noop,dataUrl:"",dataData:{},onLoadData:$.noop,partials:null},i=this;t&&$.extend(e,t),this.defaults=e,this.rendered=!1,this.onShow=e.onShow,this.onHide=e.onHide,this.onRender=e.onRender,this.onRendered=e.onRendered,this.handle=e.handle.jquery?e.handle:$(e.handle),this.layer={},this.handle.live(e.eventType,function(t){i.bindHandle(i,t)})},bindHandle:function(t,e){var i=t.defaults;return i.toggleShow&&t.layer.showed?t.hideLayer(t):t.render(),!1},position:function(t){var e,i=this,a=i.defaults,o=i.layer,n=i.handle,s={p:a.position,o:a.offset};if(t&&$.extend(s,t),s.p!==!1){if("string"==typeof s.p)switch(s.p){case"middle":e={left:"50%",marginLeft:-o.width()/2,top:$win.scrollTop()+($win.height()-o.height())/2};break;case"handle-lb":e={left:n.offset().left+offset.x,top:n.offset().top+n.height()+s.o.y};break;case"handle-rb":e={left:n.offset().left-o.width()+n.width()+s.o.x,top:n.offset().top+n.height()+s.o.y};break;case"handle-lt":e={left:n.offset().left+s.o.x,top:n.offset().top-o.height()+s.o.y};break;case"handle-rt":e={left:n.offset().left-o.width()+n.width()+s.o.x,top:n.offset().top-o.height()+s.o.y};break;case"custom":e={left:s.o.x,top:s.o.y}}else s.p.jquery&&(e={left:s.p.offset().left+s.o.x,top:s.p.offset().top+s.p.outerHeight()+s.o.y});return o.css(e),a.fixCenter&&void 0===o.isFixed&&($IE6?$(window).xresize(function(){o.isFixed=!0,i.position()}):o.css({position:"fixed",top:"50%",marginTop:-o.height()/2})),i}},hideLayer:function(t){var t=t||this,e=t.defaults,i=function(){t.layer.hide(),t.onHide(t),t.layer.showed=!1,1==e.destroy&&(t.handle.unbind(e.eventType,t.bindHandle),t.layer.remove(),t.rendered=!1,t.layer={}),e.overlay&&t.overlay("hide")};return t.rendered&&t.layer.is(":visible")&&(e.effectHide?"slideUp"==e.effectHide?t.layer.slideUp(e.hideDuration,function(){e.effectHideCallback(t),i()}):t.layer.hide(e.effectHide,e.effectHideOption,e.hideDuration,function(){e.effectHideCallback(t),i()}):i()),t},showLayer:function(t){var t=t||this,e=t.layer,i=t.defaults;try{if(!t.rendered)throw" Mo.layer Error: The Layer has not been rendered! \n\n primaryId:"+layerClass.primaryId}catch(a){return console.log(a),!1}e.attr({fullWidth:e.width(),fullHeight:e.height()});var o=function(){i.overlay&&t.overlay(),i.effectShow?"slideDown"==i.effectShow?t.layer.slideDown(i.showDuration,function(){i.effectShowCallback(t),t.position(),t.layer.showed=!0}):t.layer.show(i.effectShow,i.effectShowOption,i.showDuration,function(){i.effectShowCallback(t),t.position(),t.layer.showed=!0}):(e.css({width:i.width,height:i.height}).show(),t.onShow(t),t.position(),t.layer.showed=!0)};return o(),t},basicTpl:"{{{html}}}",render:function(t){var e=this,i=e.defaults,a={tpl:i.tpl,html:i.html,data:i.data,width:i.width,onRender:e.onRender,onRendered:e.onRendered,partials:i.partials};t&&$.extend(a,t);var o=function(){var t=function(t){e.layer=$(Mustache.to_html(Mustache.to_html(a.tpl,t),t,a.partials)).css("width",a.width).data("layer",e),e.data=t,$(i.where)[i.insertType](e.layer),e.rendered=!0,a.onRendered(e),""!=i.layerClass&&e.layer.addClass(i.layerClass),""!=i.layerId&&e.layer.attr("id",i.layerId),i.renderShow&&e.showLayer(e,i),e.layer.data("primaryId",e.primaryId=++layerClass.primaryId),e.layer.find("[role=drag-handle]").length&&e.layer.draggable({handle:e.layer.find("[role=drag-handle]"),containment:"body"}),e.closeBind()};i.dataUrl?$.getJSON(i.dataUrl,i.dataData,function(a){t(a),i.onLoadData(e,a)}):t(a.data)};return a.onRender(e),e.rendered?e.showLayer(e,i):i.tplUrl?$.ajax({url:i.tplUrl,data:i.tplData,cache:!1,success:function(t){i.tpl=t,i.onLoadTpl(e,t),o()}}):o(),e},closeBind:function(){var t=this,e=this.defaults;return e.closeHandle&&$(e.closeHandle).live("click",function(e){return t.hideLayer(t),!1}),t.layer.find(".pop-close").click(function(){return t.hideLayer(t),!1}),t},overlay:function(t){var e=this;return this.defaults.overlay&&overlayer(),this.defaults.fixed,overlayer("hide"!=t?"show":"hide"),e}},{primaryId:0,tplStore:{basicTpl:'<div defaultTemplate="defaultTemplate" style="display: none; position: absolute;z-index: 500">\t\t\t\t<div style="position:relative">\t\t\t\t\t<table style="width: 100%;height: 100%;" class="pop-dialog-table">\t\t\t\t\t\t<tbody>\t\t\t\t\t\t\t<tr>\t\t\t\t\t\t\t\t<td class="pop-tl"></td>\t\t\t\t\t\t\t\t<td class="pop-border"></td>\t\t\t\t\t\t\t\t<td class="pop-tr"></td>\t\t\t\t\t\t\t</tr>\t\t\t\t\t\t\t<tr>\t\t\t\t\t\t\t\t<td class="pop-border"></td>\t\t\t\t\t\t\t\t<td class="pop-content"><div class="pop-insert-here">{{{html}}}</div></td>\t\t\t\t\t\t\t\t<td class="pop-border"></td>\t\t\t\t\t\t\t</tr>\t\t\t\t\t\t\t<tr>\t\t\t\t\t\t\t\t<td class="pop-bl"></td>\t\t\t\t\t\t\t\t<td class="pop-border"></td>\t\t\t\t\t\t\t\t<td class="pop-br"></td>\t\t\t\t\t\t\t</tr>\t\t\t\t\t\t</tbody>\t\t\t\t\t</table>\t\t\t\t</div>\t\t\t</div>',SiteBasicTpl:'<div class="popLayerTpl"><div class="hd">\t\t\t\t\t<span title="关闭" class="pop-close-rt pop-close"></span>\t\t\t\t\t<h3>{{{title}}}</h3> \t\t\t\t</div>\t\t\t\t<div class="bd configure">\t\t\t\t\t{{{html}}}\t\t\t\t</div>\t\t\t</div>'}});Mo.layer=layerClass,Mo.alert=Mo.layer.extend({constructor:function(t){var e={type:"ok",tpl:'<div style="position: absolute; z-index: 500;" class="alert-{{type}} alert">{{{html}}}</div>',data:{html:""},width:200};$.extend(e,t),e.tpl=e.tpl.replace("{{type}}",e.type),this.base(e)},change:function(t){this.layer.attr("class","alert-"+t.type+" alert").html(t.html)}});var openAjaxDialog=layerClass.extend({constructor:function(t){var e={onload:function(){},onerror:function(){},tpl:this.basicTpl};try{if(!t||!$.isPlainObject(t))throw"Mo.openAjaxDialog Error: params must exists and must be a PlainObject"}catch(i){console.log(i)}$.extend(e,t),this.base(e)},basicTpl:'<div defaultTemplate="defaultTemplate" style="display: none; position: absolute; z-index: 100">\t\t\t\t<div style="position:relative">\t\t\t\t\t<table style="width: 100%;height: 100%;" class="pop-dialog-table">\t\t\t\t\t\t<tbody>\t\t\t\t\t\t\t<tr>\t\t\t\t\t\t\t\t<td class="pop-tl"></td>\t\t\t\t\t\t\t\t<td class="pop-border"></td>\t\t\t\t\t\t\t\t<td class="pop-tr"></td>\t\t\t\t\t\t\t</tr>\t\t\t\t\t\t\t<tr>\t\t\t\t\t\t\t\t<td class="pop-border"></td>\t\t\t\t\t\t\t\t<td class="pop-content"><div class="loading-html" style="margin:50px auto 30px auto;width:150px;line-height:30px;"><img alt="loading.." class="vm" src="'+ImgMotie+'/_assets/ajaxLoadingDialog.gif"><span class="vm fz-16" style="margin-left:20px;">载入中..</span></div><div class="pop-insert-here"></div></td>\t\t\t\t\t\t\t\t<td class="pop-border"></td>\t\t\t\t\t\t\t</tr>\t\t\t\t\t\t\t<tr>\t\t\t\t\t\t\t\t<td class="pop-bl"></td>\t\t\t\t\t\t\t\t<td class="pop-border"></td>\t\t\t\t\t\t\t\t<td class="pop-br"></td>\t\t\t\t\t\t\t</tr>\t\t\t\t\t\t</tbody>\t\t\t\t\t</table>\t\t\t\t</div>\t\t\t</div>',render:function(){var t=this.defaults,e=this;return e.rendered?e.showLayer(e):(e.layer=$(t.tpl).css("width",t.width),$(t.where)[t.insertType](e.layer),e.rendered=!0,e.layer.loadingHtml=e.layer.find(".loading-html"),e.showLayer(e),t.draggable&&e.layer.draggable({containment:"body"}),$.ajax({url:t.url,cache:!1,data:t.data,success:function(i){try{if(""==$.trim(i))throw"Mo.openAjaxDialog Error: responseText is empty, check send data or jsp code";e.layer.loadingHtml.hide(),""!=t.layerClass&&e.layer.addClass(t.layerClass),""!=t.layerId&&e.layer.attr("id",t.layerId),e.layer.find(".pop-insert-here").html(i),e.position(),e.closeBind(),t.onload(e)}catch(a){throw a}},error:function(){e.layer.find(".pop-insert-here").html('<a href="javascript:;" class="pop-close fr"></a><div class="cl"></div><div style="margin:50px auto 30px auto;width:200px;line-height:30px;"><img src="'+ImgMotie+'/_assets/ErrorIco.gif" class="vm" /><span class="vm fz-16" style="margin-left: 20px;">载入失败:(</span></div>'),e.layer.loadingHtml.hide(),e.closeBind(),t.onerror(e)}})),e}});Mo.openAjaxDialog=openAjaxDialog;var overlayer=function(){var t,e,i;return t={create:function(){i=$('<div id="overlay"></div>').css({width:"100%"}),t.fixed(),overlayer.layer=i,$("body").append(i),$win.bind("scroll resize",t.fixed)},fixed:function(){var t=$(document).height();e=$win.height()>=t?$win.height():t,i.css("height",e+"px")},show:function(){t.fixed(),i.show()},hide:function(){i.hide()},destroy:function(){$win.unbind("scroll resize",t.fixed),i.remove(),i=null}},function(e){switch(void 0===overlayer.layer&&t.create(),e){case"show":t.show();break;case"hide":t.hide();break;case"destroy":t.destroy()}}}();Mo.overlayer=overlayer,Motie.tools={RandomCache:function(){return Math.ceil(1e8*Math.random())},FormatText:function(t){function e(t){var e=t.match(/(<a\b[^>]+>(.*?)<\/a>)/gi),i=[];if(t="　　"+t.replace(/[ \u3000\t\r]/g,"").replace(/[\n]+/g,"\r\n\r\n　　"),e&&e.length){i=t.match(/(<a[^>]+>(.*?)<\/a>)/gi);for(var a=0,o=i.length;a<o;a++)t=t.replace(i[a],e[a])}return t}for(var i=t.split("(\n\r)|(\n)"),a=null,o=0,n=[],s=i.length;o<s;o++){var a=i[o];""==a?n.push("\n\r"):n.push(e(a))}return n.join("")}},Motie.ProcessUrl=function(t,e){for(var i=t,a=0,o=e.length;a<o;a++)i=i.replace("$"+(a+1),e[a]);return i},Motie.TextareaUtils=function(){var t={},e=document.selection;return t.selectionStart=function(t){if(!e)return t.selectionStart;var i=e.createRange(),a=0,o=document.body.createTextRange();for(o.moveToElementText(t),a;o.compareEndPoints("StartToStart",i)<0;a++)o.moveStart("character",1);return a},t.selectionBefore=function(e){return e.value.slice(0,t.selectionStart(e))},t.selectText=function(t,i,a){if(t.focus(),!e)return void t.setSelectionRange(i,a);var o=t.createTextRange();o.collapse(1),o.moveStart("character",i),o.moveEnd("character",a-i),o.select()},t.insertText=function(i,a,o,n){if(i.focus(),n=n||0,!e){var s=i.value,r=o-n,l=r+a.length;return i.value=s.slice(0,r)+a+s.slice(o,s.length),void t.selectText(i,l,l)}var c=e.createRange();c.moveStart("character",-n),c.text=a},t.getCursorPos=function(t){if("undefined"!=typeof t){var i=0;if($IE){t.focus();var a=null;a=e.createRange();var o=a.duplicate();o.moveToElementText(t),o.setEndPoint("EndToEnd",a),t.selectionStart=o.text.length-a.text.length,t.selectionEnd=t.selectionStart+a.text.length,i=t.selectionStart}else(t.selectionStart||"0"==t.selectionStart)&&(i=t.selectionStart);return i}},t.getSelectedText=function(t){var i="",a=function(t){return void 0!=t.selectionStart&&void 0!=t.selectionEnd?t.value.substring(t.selectionStart,t.selectionEnd):""};return i=window.getSelection?a(t):e.createRange().text},t.setCursor=function(t,e,i){if("undefined"!=typeof t)if(e=null==e?t.value.length:e,i=null==i?0:i,t.focus(),t.createTextRange){var a=t.createTextRange();a.move("character",e),a.moveEnd("character",i),a.select()}else t.setSelectionRange(e,e+i)},t.unCoverInsertText=function(t,e,i){i=null==i?{}:i,i.rcs=null==i.rcs?t.value.length:1*i.rcs,i.rccl=null==i.rccl?0:1*i.rccl;var a=t.value,o=a.slice(0,i.rcs),n=a.slice(i.rcs+i.rccl,""==a?0:a.length);t.value=o+e+n,this.setCursor(t,i.rcs+(null==e?0:e.length))},t}(),Motie.nameCard=function(t){var e=this;null===Motie.nameCard.layer&&e.createCard(),this.handle=$(t.ele),this.handle.data("nameCard",!0),this.type=t.type,this.xid=t.xid,this.atname=t.atname||"",this.getCard=null,this.getSuccess=!1,this.cacheId=this.type+(this.atname?this.atname:this.xid);var i=Motie.nameCard.layer,a=Motie.nameCard.setPosition,o=i.loading,n=i.bd,s=new Motie.openLayer(this.handle,i,{duration:100,showTime:300,onShow:function(t){o.show(),n.empty();var i=Motie.nameCard.checkCache(e.cacheId);i&&!$IE?(o.hide(),n.html(i),a(t)):e.getCard=proxy.$.ajax({url:"/ajax/namecard/show",cache:!1,data:{type:e.type,id:e.xid,atname:e.atname},success:function(i){""!=$.trim(i)?(i=$(i),e.getSuccess=!0,Motie.nameCard.cache[e.cacheId]=i,n.html(i),o.hide(),a(t)):(o.hide(),n.html(['<div class="load-error ac" style="padding: 20px;">',"people"==e.type?"没有这个铁粉哟 :(":"这本书不存在哟:(","</div>"].join("")),a(t))},error:function(){t.hideLayer(),a(t)}})},onHide:function(t){e.getCard&&e.getCard.abort()}});s.processShow(),this.card=s,s.showLayer=function(){}},Motie.nameCard.setPosition=function(t){var e=t.handle,i=$html.scrollTop(),a=$win.height(),o=$main.offset().left,n=$main.width(),s=e.height(),r=(e.width(),e.offset().top),l=e.offset().left,c=Motie.nameCard.layer,d=Motie.nameCard.layer.arrow,u=(Motie.nameCard.layer.bd,0),h=0,f=function(){var t=i+a-r,e=t-s;return!(0==i&&r<c.height()||(e>0?e>=c.height():t>=c.height()||!(e<0)))}(),m=n-(l-o)<355;u=r+s+5,h=l-20,d.removeClass("pos-bl pos-rt pos-br"),f&&!m?(u=r-c.height()-10,d.addClass("pos-bl")):!f&&m?(u=r+s-30,h=l-c.width()-15,d.addClass("pos-rt")):f&&m&&(u=r-c.height()-10,h=l-c.width()+38,d.addClass("pos-br")),t.left=h,t.top=u,c.css({top:u,left:h}).show()},Motie.nameCard.prototype.createCard=function(){this.layer=$('<div class="namecard" visible="display" style="display: none; position: absolute;"><div style="position:relative"><div class="namecard-arrow"></div><table width="100%"><tbody><tr><td class="pop-tl"></td><td class="pop-border"></td><td class="pop-tr"></td></tr><tr><td class="pop-border"></td><td class="pop-content"><div class="mod-author-info mod"><div class="loading-card ac fz-14" style="background: url('+ImgMotie+'/_assets/ajax-loader.gif) no-repeat 100px center; line-height: 200px; height: 200px;">加载中..</div><div class="bd"></div></div></td><td class="pop-border"></td></tr><tr><td class="pop-bl"></td><td class="pop-border"></td><td class="pop-br"></td></tr></tbody></table></div></div>'),Motie.nameCard.layer=this.layer,Motie.nameCard.layer.bd=this.layer.find(".bd"),Motie.nameCard.layer.loading=this.layer.find(".loading-card"),Motie.nameCard.layer.arrow=this.layer.find(".namecard-arrow"),$body.append(this.layer)},Motie.nameCard.layer=null,Motie.nameCard.cache={},Motie.nameCard.checkCache=function(t){return Motie.nameCard.cache[t]||!1},Motie.nameCard.bind=function(t){var e,i="http://www.motie.com",a=function(t){var e=t,a=e.attr("href").replace(i,""),o=a.lastIndexOf("/")+1;o=a.substring(o,a.length),/^\/group\/\d+$/.test(a)?new Mo.nameCard({ele:t[0],type:"group",xid:o}):/^\/people\/\d+$/.test(a)?new Mo.nameCard({ele:t[0],type:"people",xid:o}):a.match(/^\/book\/\d+$/)?new Mo.nameCard({ele:t[0],type:"book",xid:o}):a.match(/^\/name\/\S*[^\/]$/)&&new Mo.nameCard({ele:t[0],type:"people",xid:0,atname:o})};$(t).delegate("a[href]","mouseenter",function(){var t=$(this);$(this).data("namecard")!==!1&&(e&&clearTimeout(e),e=setTimeout(function(){t.data("nameCard")||a(t)},200))}).delegate("a[href]","mouseout",function(){$(this).data("namecard")!==!1&&e&&clearTimeout(e)})},Motie.medalCard=function(t){var e=this;this.handle=$(t),this.id=this.handle.attr("id"),Motie.medalCard.layer||e.createCard(),this.getCard=null,this.getSuccess=!1,this.cacheId="medal-"+this.id;var i=Motie.medalCard.layer,a=i.loading,o=i.bd;new Motie.openLayer(this.handle,i,{showTime:500,onShow:function(t){a.show(),o.empty(),Motie.medalCard.setPosition(t);var i=Motie.medalCard.checkCache(e.cacheId);i&&!$IE?(a.hide(),o.html(i),Motie.medalCard.setPosition(t)):e.getCard=$.ajax({url:"/ajax/medal/show",cache:!1,data:{id:e.id},success:function(i){""!=$.trim(i)&&(i=$(i),e.getSuccess=!0,Motie.medalCard.cache[e.cacheId]=i,o.html(i),a.hide(),Motie.medalCard.setPosition(t))},error:function(){a.hide(),o.html('<div class="load-error ac" style="padding: 20px;">勋章读取错误</div>')}})},onHide:function(t){e.getCard&&e.getCard.abort()}})},Motie.medalCard.setPosition=function(t){var e=t.handle,i=($html.scrollTop(),$win.height(),e.height(),e.width(),e.offset().top,e.offset().left),a=Motie.medalCard.layer;a.css({left:i-110})},Motie.medalCard.cache={},Motie.medalCard.checkCache=function(t){return Motie.medalCard.cache[t]||!1},Motie.medalCard.prototype.createCard=function(){this.layer=$('<div class="mod-medal-card" visible="display" style="display: none;width: 253px;" x="-110" y="8"><table><tr><td colspan="3"><div class="pop-tt"></div></td></tr><tr><td class="pop-border"></td><td class="mc"><div class="loading-card ac fz-14" style="background: url("'+ImgMotie+'/_assets/ajax-loader.gif") no-repeat scroll 70px center transparent;  padding-left: 120px; line-height: 150px; height: 150px;">加载中..</div><div class="bd" style="width: 197px"></div></td><td class="pop-border"></td></tr><tr><td colspan="3"><div class="pop-bb"></div></td></tr></table></div>'),Motie.medalCard.layer=this.layer,Motie.medalCard.layer.bd=this.layer.find(".bd"),Motie.medalCard.layer.loading=this.layer.find(".loading-card"),$body.append(this.layer)},Motie.medalCard.layer=null,Motie.subNav=function(t){var e,i,a=this;this.ele=$(t.ele),this.subnav=t.subnav,e=this.subnav.attr("left"),i=this.subnav.attr("top"),this.ele.hover(function(){a.ele.addClass("active"),a.subnav.css({left:e+"px",top:i+"px"})},function(){a.ele.removeClass("active"),a.subnav.css({left:"-9999px",top:"-9999px"})})},Motie.setItemsPosition=function(t,e){1==t.size()?t.first().addClass(e+"-first current only-one-"+e):(t.first().addClass(e+"-first"),t.last().addClass(e+"-last"))},Motie.reSetItemsPosition=function(t,e){t.removeClass(e+"-first "+e+"-last current only-one-"+e),Motie.setItemsPosition(t,e)},Motie.GroupControal=function(t,e,i,a,o){var n=$(t),i=void 0!==i?i:parseInt(n.attr("ftype")),s=Motie.GroupControal.GroupClass;if(2==i)return!1;if(1==i&&(a=a?a:MotieHost+"/ajax/group/"+e+"/apply"),3==i){if(!confirm("退出小组","是否要退出小组？"))return!1;a=a?a:MotieHost+"/ajax/group/"+e+"/out"}$.ajax({url:a,cache:!1,success:function(t){var e=t.code,a=t.message;if("inspect"==e)new Mo.layer({destroy:!0,tpl:Mo.layer.tplStore.basicTpl,draggable:!1,width:510,data:{html:$("#ask-form").html()},onRendered:function(t){var e=t.layer.find("form");e.ajaxForm({cache:!1,success:function(e){text=e.code,"wait"==text?s(n.css("cursor","default"),"2"):"fail"==text||"enough"==text&&s(n,"4"),t.hideLayer(t)}})}}).render();else if("wait"==e)s(n,"2");else if("ok"==e)if(3==i){if("2"==joinType)return void n.remove();s(n,"1"),$(".btn-wantto-speak").click(function(){return alert("请先加入小组"),!1})}else $(".btn-wantto-speak").unbind("click"),s(n,"3");else alert(a)}})},window.groupControal=Motie.GroupControal,Motie.GroupControal.GroupClass=function(t,e){var i={1:"group-add",2:"group-processing",3:"group-exit",4:"group-full"};t.removeClass("group-add group-processing group-exit").addClass(i[e]),t.attr("ftype",e)},Motie.wordsCalculation=function(t,e){var i=this;return this.status=void 0!==e&&$(e),this.textarea=$(t),this.ele=this.textarea[0],this.onspace=this.textarea.attr("onspace"),this.onspace=!!this.onspace&&"false"!=this.onspace,this.Cal=function(t){var e=t.replace(/\t|\|n|\|r|\|v|\s|\u3000/g,"").length;return i.status&&i.status.text(e),e},this.textarea.bind("keyup",function(){i.Cal(i.textarea.val())}),this.Cal(""!==$.trim(this.textarea.text())?this.textarea.text():this.textarea.val())},Motie.createMessage=function(t){var e=this;this.ele=$(t.ele),this.max=this.ele.attr("max")||t.max,this.textarea=this.ele.find("textarea"),this.state=this.ele.find(".limit-number:first"),this.emotionHandle=this.ele.find(".emotionHandle:first"),this.uploadImgHandle=this.ele.find(".uploadImgHandle:first"),this.submitBtn=this.ele.find(".submit:first"),this.submitType=this.ele.find('input[name="submitType"]').val()||"ajax",this.onSubmit=t.onSubmit||function(){},this.onSuccess=t.onSuccess||function(){},this.submiting=!1,this.limit(),this.imageTempFile=this.ele.find("input[name='imageTempFile']"),this.form=this.textarea.parentsUntil("form").parent(),this.formAction=this.form.attr("action"),Mo.ui.at&&Mo.ui.at(this.textarea);
var i=Mo.core.action.comment();this.emotionHandle.length&&e.setEmotionValue(e),this.uploadImgHandle.length&&e.uploadImage(e),$("#upload-img .close").click(function(){$("input[name='imageTempFile']").val("")}),$("#uploadImgLayer a").click(function(){$("input[name='imageTempFile']").val("")}),$(document).click(function(){e.currentLayer&&"emotion"==e.currentLayer.attr("id")&&e.currentLayer.is(":visible")&&e.currentLayer.hide()}),this.textarea.keyup(function(t){e.limit(),(t.ctrlKey&&13==t.which||10==t.which)&&(e.submit(e),e.textarea.val(""))}),this.submitBtn.click(function(){return i.isAllowReply(e.submitBtn,0,8,function(){!e.submiting&&e.canbisubmit&&e.submit(e)}),!1})},Motie.createMessage.messageCache="",Motie.createMessage.prototype.limit=function(){var t=this;t.canbisubmit=Motie.limitTextarea(t.textarea,t.max,t.state),t.canbisubmit?(t.canbisubmit=!0,t.submitBtn.removeClass("disable")):(t.canbisubmit=!1,t.submitBtn.addClass("disable"))},Motie.createMessage.prototype.submit=function(t){var e=Motie.createMessage.messageCache;return Mo.ui.emotion().hide(),e&&e==t.textarea.val()&&""!=$.trim(e)?(alert("已经发过了，不要太贪心哟！"),!1):(e=t.textarea.val(),""==$.trim(e)?(alert("内容不能为空！"),!1):!t.textarea.hasClass("disabled")&&("ajax"==this.submitType?(t.onSubmit(t),t.ajax=$.ajax({type:"post",cache:!1,url:t.formAction,data:{content:t.textarea.val(),imageTempFile:t.imageTempFile.val()},success:function(e){t.textarea.val(""),t.submiting=!1,$("input[name='imageTempFile']").val(""),$("#uploadDiv").show(),$("#uploadImgLayer").hide(),$("#upload-img").hide(),t.limit(),t.onSuccess(e)}})):t.form.submit(),void(t.submiting=!0)))},Motie.createMessage.cache={},Motie.createMessage.prototype.currentLayer=null,Motie.createMessage.prototype.setEmotionValue=function(t){t.emotionHandle.click(function(){return $("#upload-img").hide(),Mo.ui.emotion($(this),t.textarea),!1})},Motie.createMessage.prototype.uploadImage=function(t){var e=$("#upload-img");this.uploadImage=e,t.uploadImgHandle.click(function(){return Mo.ui.emotion().hide(),e.css({top:t.uploadImgHandle.offset().top+t.uploadImgHandle.height()+10,left:t.uploadImgHandle.offset().left}).show(),!1}),e.find(".close").click(function(){return e.hide(),!1});var i=$("#upload"),a=$("#uploadStatus"),o=$("#imageFile"),n=new AjaxUpload(i,{action:"/ajax/icon/twitter/upload",name:"uploadfile",onSubmit:function(t,e){return e&&/^(jpg|jpeg|gif|png)$/i.test(e)?(a.addClass("uploading"),void a.text("图片上传中...")):(a.addClass("error").text("只允许  JPG、jpeg、 GIF、 PNG 的文件格式"),!1)},onComplete:function(t,e){var i=e.indexOf("<");i!=-1&&(e=e.substring(0,i)),l.attr("src",e),c.text(t),r.hide(),s.show(),a.text("").removeClass("uploading").removeClass("error"),o.val(e),$("input[name='imageTempFile']").val(e),""==$("textarea[name='content']").val()&&$("textarea[name='content']").val("分享图片")}});i.mouseover(function(){$(n._input).click(function(t){t.stopPropagation()})});var s=$("#uploadImgLayer"),r=$("#uploadDiv"),l=s.find("img"),c=s.find("h3"),d=s.find("a");d.click(function(){return l.attr("src",""),c.text(""),s.hide(),r.show(),e.hide(),!1})},Motie.customSelect=function(t){var e=this;this.ele=$(t),this.name=t.name,this.options=this.ele.find("option"),this.defaultValue=this.ele.attr("default")||!1,this.className=t.className,this.onChange=this.ele.attr("onchange")||this.ele.attr("changeSelect")||function(){},this.style=this.ele.attr("style")||"",e.changed=!1,this.data=[],this.items=null,this.selectList=$('<div class="custom-select-list" id="'+this.name+'-select-list"><div class="select-list-bd"><ul></ul></div></div>'),this.transition(e),this.selectElement=$('<div style="'+this.style+'" class="input-wrap '+this.className+'" id="'+this.name+'-select"><div class="input-bd"><a class="handle" item:value="'+this.defaultValue[0]+'" href="#">'+this.defaultValue[1]+'</a></div><input type="hidden" value="'+this.defaultValue[0]+'" name="'+this.name+'" /></div>'),this.handle=this.selectElement.find(".handle"),this.hiddenInput=this.selectElement.find("input:hidden"),this.ele.replaceWith(this.selectElement),this.selectList.appendTo($body),this.handle.click(function(){return e.selectList.is(":visible")?e.hideList(e):(e.hideList().setPosition().selectList.show(),Motie.customSelect.currentSelect=e.selectList),!1}),this.max=null,$(document).click(function(){e.hideList(e)}),$(window).bind("resize",function(){e.setPosition()})},Motie.customSelect.currentSelect=null,Motie.customSelect.prototype.transition=function(_self){for(var ul=this.selectList.find("ul"),i=0;i<this.options.size();i++){var tmp=this.options.eq(i);this.defaultValue==tmp.val()?(this.defaultValue=[tmp.val(),tmp.text()],ul.append('<li><a href="#" class="active" item:value="'+tmp.val()+'">'+tmp.text()+"</a></li>")):ul.append('<li><a href="#" item:value="'+tmp.val()+'">'+tmp.text()+"</a></li>"),_self.data.push({text:tmp.text(),value:tmp.val()})}return this.defaultValue===!1&&(this.defaultValue=[this.data[0].value,this.data[0].text]),this.items=ul.find("a"),this.items.click(function(){var $this=$(this);return _self.items.removeClass("active"),$this.addClass("active"),_self.handle.text($this.text()),_self.hiddenInput.val($this.attr("item:value")),_self.hideList(),"string"==typeof _self.onChange?(_self.changed||(_self.changed=!0,_self.onChange=_self.onChange.replace("value",'$this.attr("item:value")')),eval("("+_self.onChange+")")):_self.onChange($this.attr("item:value")),!1}),this},Motie.customSelect.prototype.setPosition=function(t){var e=this.selectList.height();return null===this.max&&e>144&&(this.max=!0,e=144),this.selectList.css({width:this.selectElement.width(),left:this.selectElement.offset().left,top:this.selectElement.offset().top+this.selectElement.outerHeight()-1,height:e,overflowY:this.max?"scroll":"hidden"}),this},Motie.customSelect.prototype.hideList=function(t){return Motie.customSelect.currentSelect&&Motie.customSelect.currentSelect.hide(),this},Motie.openLayer=function(t,e,i){if(!t[0]||!e[0])return!1;var a=this;this.options=i||{},this.onHide=this.options.onHide||function(){},this.onShow=this.options.onShow||function(){},this.handle=t,this.handleTop=this.handle.offset().top,this.handleLeft=this.handle.offset().left,this.layer=e,this.icant=this.layer.attr("icant")||!0,this.visible=this.layer.attr("visible")||"position","true"!=this.icant&&(e.parent().is("body")||(this.layer=e.clone(),e.remove(),$("body").append(this.layer))),this.x=this.layer.attr("x")||0,this.x=1*this.x,this.y=this.layer.attr("y")||0,this.y=1*this.y,this.left=function(){return a.handle.offset().left+a.x},this.top=function(){return a.handle.offset().top+a.handle.height()+a.y},this.duration=void 0!==this.options.duration?this.options.duration:1e3,this.showTime=void 0!==this.options.showTime?this.options.showTime:0,this.close=this.layer.find(".close-layer:first"),this.eventType=this.options.eventType||"mouseenter";var o=function(){a.layer.hover(function(){a.timer&&clearTimeout(a.timer),a.showLayer(a)},function(){a.lazyHide(a)}),a.onShow(a),a.showLayer(a)};a.processShow=function(){a.layer.unbind("hover"),a.timer=a.layer.data("timer"),a.showTimer=a.layer.data("showTimer"),a.timer&&clearTimeout(a.timer),a.showTimer&&clearTimeout(a.showTimer),a.showTime?a.showTimer=setTimeout(function(){o(),a.layer.data("showTimer",a.showTimer)},a.showTime):o()},this.handle.bind(this.eventType,function(t){a.processShow()}),this.handle.bind("mouseout",function(){a.lazyHide(a)}),this.layer.css("zIndex","1000"),this.close.click(function(){return a.hideLayer(a),!1})},Motie.openLayer.currentLayer=null,Motie.openLayer.prototype.lazyHide=function(t,e){return t.showTimer&&clearTimeout(t.showTimer),0==t.duration?(t.hideLayer(t),t):(this.timer&&clearTimeout(this.timer),this.timer=setTimeout(function(){t.hideLayer(t)},this.duration),void t.layer.data("timer",this.timer))},Motie.openLayer.prototype.showLayer=function(t){this.layer.css({left:t.left(),top:t.top()}).show()},Motie.openLayer.prototype.hideLayer=function(t,e){t=t||this,this.timer&&clearTimeout(this.timer),"position"==this.visible?this.layer.css({left:"-9999px",top:"-9999px"}):this.layer.hide(),t.layer.unbind("hover"),t.onHide(t)},Motie.popLayer=function(t,e,i){var a=this;return a.defaults={onHide:function(){},onShow:function(){},hideByEsc:!0},i&&$.extend(a.defaults,i),this.handle=t,this.layer=e,!(!this.layer[0]||!this.handle[0])&&(this.close=e.find(".pop-close"),Motie.popLayer.createOverlay(),this.handle.data("pop",this),this.handle.click(function(){a.show()}),this.close.click(function(){return a.hide(a),!1}),void(1==a.defaults.hideByEsc&&$(document).keyup(function(t){a.layer.is(":visible")&&27==t.keyCode&&a.hide(a)})))},Motie.popLayer.cache={},Motie.overlay=$("#overlay")[0],Motie.popLayer.createOverlay=function(){Motie.overlay||(Motie.overlay=$("<div></div>",{id:"overlay",display:"none"}).appendTo($("body")))},Motie.popLayer.prototype.show=function(t){return t=t||this,!!Motie.CheckLogin(!0)&&(Motie.overlay.show().css({height:$("body").height()}),t.layer.css({opacity:0,top:$win.scrollTop()+200}).stop().show().animate({opacity:1},"fast"),t.defaults.onShow(t),void Motie.overlay.unbind("click").click(function(){t.hide(t)}))},Motie.popLayer.prototype.hide=function(t){var t=t||this;this.defaults.onHide(this),Motie.overlay.hide(),this.layer.stop().animate({opacity:"0"},"fast",function(){t.layer.hide()})},Motie.loadImg=function(t,e){var i=new Image;i.src=t,i.complete?e.call(i):(i.onload=function(){e.call(i)},i.src=i.src)},Motie.lazyload=function(t){var e={defObj:null,defHeight:0};e=$.extend(e,t||{});var i=(e.defHeight,"object"==typeof e.defObj?e.defObj.find("img"):$(e.defObj).find("img")),a=function(){return document.documentElement.clientHeight+Math.max(document.documentElement.scrollTop,document.body.scrollTop)-e.defHeight},o=function(){i.each(function(){if($(this).offset().top<=a()){var t=$(this).attr("orgSrc");t&&$(this).attr("src",t).removeAttr("orgSrc")}})};o();var n=null;$(window).bind("scroll",function(){n&&clearTimeout(n),n=setTimeout(function(){o()},100)})},Motie.MediaPlayer=Base.extend({id:0,ownerPage:!1,type:"",body:null,reality:null,tumb:null,loadIco:null,constructor:function(t,e,i,a){if(this.element=t,this.smallImage=e,this.imageWrap=i,this.tumb=e.find(".tumb-image"),this.tumbPic=this.tumb.find("img"),this.element.data("media",this),this.type=this.element.attr("data-media-type"),this.TypeObject=a,this.TypeObject)return this.id=Motie.MediaPlayer.primary++,Motie.MediaPlayer.cache[this.id]=this,this.maxWidth=e.width()-30,this.isForward=e.parent().parent().hasClass("m-c"),this.shirt=Motie.MediaPlayer.basicTemplate,this.isForward||(this.shirt=['<div class="image-maskup"><div class="m-t"></div><div class="m-c">',this.shirt,"</div></div>"].join("")),this.element.hasClass("big-image")?(this.ownerPage=!0,void this.TypeObject.controal.call(this)):void this.setup()},setup:function(){var t=void 0===this.recreate?this.TypeObject.recreate:this.recreate,e=this.tumbPic[0]?this.tumbPic:this.smallImage;if(this.TypeObject.onCreate)switch(null==this.loadIco&&(this.loadIco=$('<span class="loadIco" style="position: absolute"></span>').css({left:e.width()/2-8,top:e.height()/2-8}),"IMG"==e[0].tagName?e.after(this.loadIco):e.append(this.loadIco)),t){case"recreate":!this.loadIco.is(":visible")&&this.loadIco.show()&&delete this.body&&!this.TypeObject.onCreate.call(this);break;case!1:this.ShowMedia();break;case!0:this.recreate="recreate",this.TypeObject.onCreate.call(this);break;case void 0:this.recreate=!1,this.TypeObject.onCreate.call(this)}else this.ShowMedia()},ShowMedia:function(){this.body?this.body.render():this.TypeObject.create.call(this),this.TypeObject.hideElement&&this.element.hide(),this.loadIco&&this.loadIco.hide()},CreateControal:function(){var t,e,i,a=this,o=this.TypeObject.controal?this.TypeObject.controal.slice(""):[],n=this.body.layer.find(".controal");if(o.unshift({text:"收起","class":"slide-up fl",click:function(){a.HideMedia()}}),this.buttons=[],t=o.length)for(var s=0;s<t;s++)e=o[s],e.href||(e.href="javascript:;"),i=$("<a>",e),i.data("boss",this),this.buttons.push(i),n.append(i),s!=t-1&&n.append('<span class="sp fl">|</span>')},HideMedia:function(){this.body.hideLayer(),this.element.show()},GetMaxWidth:function(){return this.maxWidth=this.smallImage.width()-30,this.smallImage.hasClass("big-image")&&(this.maxWidth=this.smallImage.width()),this.maxWidth}},{cache:{},primary:0,basicTemplate:'<div class="big-image"><div class="controal clear"></div><div class="maskup-content">{{{html}}}</div></div>',type:{},bind:function(t){$(t).delegate(".tumb-image","click",function(){var t=$(this);if(t.data("media"))t.data("media")&&t.data("media").body&&t.data("media").setup();else{var e=t.parentsUntil(".txtbox-image-wrap").parent().first(),i=e.find(".small-image"),a=Motie.MediaPlayer.type[i.attr("data-media-type")];if(!a)return!1;new Motie.MediaPlayer(t,i,e,a)}return!1})}}),$.extend(Motie.MediaPlayer.type,{image:{hideElement:!0,controal:[{text:"查看大图",target:"_blank","class":"show-big fl",href:"",click:function(){$(this).data("boss")}},{text:"向左转","class":"turn-left fl",click:function(){var t=$(this).data("boss");t.TypeObject.rotate.apply(t.body.pic,[t,"right"])}},{text:"向右转","class":"turn-right fl",click:function(){var t=$(this).data("boss");t.TypeObject.rotate.apply(t.body.pic,[t,"left"])}}],rotate:function(t,e){var i=this[0],a=i.getAttribute("step"),o=null,n=t.maxWidth;this.data("width")||$(this).data("height")||(this.data("width",i.width),this.data("height",i.height)),null==a&&(a=0),"left"===e?3==a?a=0:a++:"right"===e&&(0==a?a=3:a--),i.setAttribute("step",a);var s=this.data("width"),r=this.data("height");if((1==a||3==a)&&this.data("width")<this.data("height")&&this.data("height")>n&&(r=n,s=this.data("width")*n/this.data("height")),document.all)i.style.filter="progid:DXImageTransform.Microsoft.BasicImage(rotation="+a+")",i.width=s,i.height=r,o=this;else{var l=this.next("canvas")[0];0==this.next("canvas").length&&(this.css({visibility:"hidden",position:"absolute"}),l=document.createElement("canvas"),l.setAttribute("class","maxImg canvas"),i.parentNode.appendChild(l)),o=$(l);var c=l.getContext("2d"),d=1;switch(r=i.raw_height=$(i).attr("raw_height"),s=i.raw_width=$(i).attr("raw_width"),(1==a||3==a)&&i.raw_height>n&&(d=n/i.raw_height,r=n,s=d*i.raw_width),(0==a||2==a)&&i.raw_width>n&&(d=n/i.raw_width,r=d*i.raw_height,s=n),a){default:case 0:l.setAttribute("width",s),l.setAttribute("height",r),c.rotate(0*Math.PI/180),c.scale(d,d),c.drawImage(i,0,0);break;case 1:l.setAttribute("width",r),l.setAttribute("height",s),c.rotate(90*Math.PI/180),c.scale(d,d),c.drawImage(i,0,-i.raw_height);break;case 2:l.setAttribute("width",s),l.setAttribute("height",r),c.rotate(180*Math.PI/180),c.scale(d,d),c.drawImage(i,-i.raw_width,-i.raw_height);break;case 3:l.setAttribute("width",r),l.setAttribute("height",s),c.rotate(270*Math.PI/180),c.scale(d,d),c.drawImage(i,-i.raw_width,0)}}},onCreate:function(){var t=this,e=this.element.find("img").attr("src");this.path={small:e,large:e.replace(/(.*)s(\d*\..*)/,"$1l$2"),big:e.replace(/(.*)s(\d*\..*)/,"$1d$2")},this.largePic=new Image,this.largePic.src=this.path.large,Motie.loadImg(this.path.large,function(){t.largePic=this,t.ShowMedia()})},create:function(){var t=this,e=this.largePic.width,i=this.largePic.height,a=this.largePic.height,o=this.largePic.width,n=this.GetMaxWidth();e>n&&(i=n/e*i,e=n-10),new Motie.layer({tpl:this.shirt,overlay:!1,destroy:!0,data:{bigSrc:this.path.big,largeSrc:this.path.large,width:e,height:i,raw_width:o,raw_height:a,maxWidth:n,html:this.TypeObject.html},onShow:function(){t.imageWrap.prev(".message-noline").toggleClass("message-noline message")},onHide:function(){t.imageWrap.prev(".message").toggleClass("message-noline message")},where:this.element,insertType:"after",position:!1,onRendered:function(e){t.body=e,t.body.content=e.layer.find(".maskup-content"),t.CreateControal(),t.buttons[1].attr("href",t.path.big),t.body.content.find("img").click(function(){t.buttons[0].click()}),t.body.content.delegate("canvas","click",function(){t.buttons[0].click()}),t.body.pic=e.layer.find(".image")}}).render()},html:'<img alt="" src="{{largeSrc}}" width="{{width}}" height="{{height}}" maxWidth="{{maxWidth}}" raw_width="{{raw_width}}" raw_height="{{raw_height}}" class="image" />'},video:{hideElement:!0,create:function(){var t=this,e=this.GetMaxWidth(),i=this.tumbPic.attr("videosrc");new Motie.layer({tpl:this.shirt,overlay:!1,destroy:!0,data:{width:e,height:Math.ceil(.8*e),src:i,html:this.TypeObject.html},where:this.element,insertType:"after",position:!1,onRendered:function(e){t.body=e,t.body.content=e.layer.find(".maskup-content"),t.CreateControal()}}).render()},html:'<embed height="{{height}}" width="{{width}}" src="{{src}}" wmode="transparent" type="application/x-shockwave-flash" />'},poll:{recreate:!0,loadVote:function(){var t,e,i,a=this,o=this.body.layer,n=o.find("input[name=maxofchoice]").val(),s=o.find(".loadIco"),r=o.find("li"),l=0,c="1"===n,d=o.find(".vote-select"),u=!1,h=o.find(".vote-result").length,f=function(t){t?r.not(".selected").addClass("disabled").find("input").attr("disabled","disabled"):r.removeClass("disabled").find("input").removeAttr("disabled")};if(t=d.attr("data-value"),h)e=o.find(".progess").eq(0).width(),e-=80;else{var m=o.find("form");i=o.find(".btn-submit"),m.ajaxForm({beforeSubmit:function(){return!u&&(0==l?(alert("不能一个也不选哦！"),!1):(u=!0,void s.fadeIn("fast")))},success:function(t){a.body.hideLayer().render({data:{html:t,voted:!0}}),u=!1,s.attr("class","okIco fr").delay(1e3).fadeOut()}}),d.hasClass("allow-result")&&d.find("span.result").each(function(){var e=$(this).attr("data-value"),i=0==t?0:e/t,a=Math.round(100*i);$(this).text(e+"("+a+"%)")})}r.each(function(){var i=$(this),a=i.find("input"),o=function(t,e){var o=t?!a.is(":checked"):a.is(":checked");o?(a.removeAttr("checked"),l--,i.removeClass("selected"),f(!1)):l<n&&(a.attr("checked","checked"),l++,i.addClass("selected"),l==n&&"radio"!=e&&f(!0))};if(h){var s=i.find(".progess em"),d=s.width(),u=i.find(".percent"),m=u.attr("data-value"),p=0==t?0:m/t,g=Math.round(100*p);u.text(m+"("+g+"%)"),$IE6?s.css({width:p*e+d}):setTimeout(function(){s.animate({width:p*e+d},{easing:"easeOutExpo"})},100)}else a.click(function(t){o(!0,t.target.type),t.stopPropagation()}),i.click(function(){c?(++l,r.removeClass("selected"),i.addClass("selected"),a.attr("checked","checked")):o(!1)})})},onCreate:function(){var t=this,e=this.smallImage.attr("data-poll-url");$.ajax({url:e,cache:!1,success:function(e){t.voteHtml=e,t.ShowMedia()}})},create:function(){var t=this;new Mo.layer({tpl:"{{{html}}}",overlay:!1,position:!1,data:{html:'<div class="poll-form clear">'+this.voteHtml+"</div>"},where:this.smallImage.find(".talk-inner"),insertType:"append",onRendered:function(e){var i=e.layer,a=t.smallImage.find(".close");t.body=e,t.element.hide(),e.data.voted||a.toggleClass("must-hide").click(function(){t.HideMedia(),a.addClass("must-hide")}),t.TypeObject.loadVote.call(t),Mo.utils.dom.centerImage.call(i)}}).render()}},talk:{recreate:!0,hideElement:!1,onCreate:function(){var t=this;t.ShowMedia()},create:function(){var t=this,e=this.smallImage.attr("data-talk-text"),i=this.smallImage.attr("data-action");new Mo.layer({tpl:"{{{html}}}",overlay:!1,position:!1,data:{html:this.TypeObject.html,text:e,random:Mo.tools.RandomCache()},where:this.smallImage.find(".talk-inner"),insertType:"append",onShow:function(t){var e=t.layer,i=e.find("textarea");setTimeout(function(){Motie.TextareaUtils.setCursor(i[0],i.val().length,0)},1)},onRendered:function(e){var a=e.layer,o=a.find("textarea"),n=a.find(".status"),s=a.find("a[role=submit]"),r=a.find("a[role=emotion]"),l=t.smallImage.find(".close"),c=t.smallImage.find("span.loadStatus");t.body=e,t.CreateControal(),t.element.hide(),r.click(function(){return Mo.ui.emotion(r,o),!1}),l.toggleClass("must-hide").click(function(){t.HideMedia(),l.addClass("must-hide")}),o.width(a.width()-22),Mo.app.weibo(o,s,i,null,null,{},n,c,{onSuccess:function(e){e&&(c.toggleClass("lodeIco okIco"),l.toggleClass("must-hide"),a.slideUp("fast",function(){t.HideMedia()}),setTimeout(function(){c.toggleClass("lodeIco must-hide okIco")},500))}})}}).render()},html:['<div class="ask-form clear" style="clear:both">',"<div>",'<textarea name="content" id="txt{{random}}">{{text}}</textarea>',"</div>",'<p class="ar">','<a class="show-emotion vm fl" role="emotion" href="javascript:;"></a>','<span class="loadStatus" style="vertical-align:middle;margin: 5px"></span>','<span class="vm desc status" style="margin-right: 15px;"></span>','<a role="submit" href="javascript:;" class="M-button-s">向嘉宾提问</a>',"</p>","</div>"].join("")}}),Motie.EventAgency=Base.extend({contructor:function(){}}),Motie.limitTextarea=function(t,e,i,a){if("undefined"!=typeof t&&0!=t.length){a=void 0!==a&&a;var o=a?t.val().length:t.val().replace(/[\r|\n| |\u3000]/g,"").length,n=e-1*o;return i&&(n<0?(i.addClass("length-error"),i.html('已超过<b class="limit-number">'+Math.abs(n)+"</b>个字")):(i.removeClass("length-error"),i.html('您还可输入<b class="num">'+n+"</b>字"))),n>=0}},Mo.tags=Base.extend({constructor:function(t){var e,i=this,a={input:"",ul:"",className:"",max:1e3,disableEnter:!1,onAdd:function(){},onRemove:function(){},onOver:function(){},onEmpty:function(){},addAccordingTo:function(){return!0},defaultText:"输入标签",same:!1};this.options=e=$.extend(a,t),this.number=0,this.input=$(e.input),this.value=$.trim(this.input.val()).split(" "),this.ul=$(e.ul),this.hidden=$('<input type="hidden" name='+(this.input.attr("name")||"tags")+" />"),this.input.after(this.hidden).attr("name",""),""!=this.value[0]&&(this.input.val(""),$.each(this.value,function(t,e){i.add(e)})),this.input.bind("keydown blur",function(t){var a=($(this),i.ul),o=$.trim(this.value);if(e.disableEnter){if(8!=t.keyCode)return!1;i.remove(t)}else if(i.number<=i.options.max&&""!=o&&!o.match(/[' '|\u3000]+/)){if("blur"==t.type||"keydown"==t.type&&(9==t.keyCode||32==t.keyCode))return i.add(o),this.value="",!1}else i.number>0&&""==this.value&&8==t.keyCode&&a.find("li").size()&&i.remove(t)}),this.input.inputDefault({value:e.defaultText}).parent().click(function(){i.input.focus()}).end(),this.ul.find("li .rm").live("click",function(t){i.remove(t)})},add:function(t,e){var i=this,a=i.options,o=a.className,n=i.ul,e=e||{};if(i.number>=a.max)return a.onOver(i),!1;if(!a.same&&this.search(t)[0]===!0||!a.addAccordingTo(t))return!1;i.number++;var s=$('<li class="'+o+'"><a><em title="'+t+'" class="name">'+t+'</em><span title="删除" class="rm"></span></a></li>').data(e);return n.append(s),i.options.onAdd(i,s),i.hidden.val(i.getAll().join(" ")),i},remove:function(t){var e,a=this,o=a.ul;if(0==a.number)return opt.onEmpty(a),!1;switch(typeof t){case"object":switch(t.type){case"click":e=$(t.target).parent().parent();break;case"keydown":e=o.find("li:last")}break;case"number":e=o.find("li").eq(i);break;case"string":e=a.search(t)[2]}return e&&e.remove(),a.options.onRemove(a,e),a.hidden.val(a.getAll().join(" ")),a.number>0&&a.number--,a},search:function(t){for(var e=this.getAll(),i=[!1,0,null],a=0;a<e.length;a++)if(t==e[a]){i=[!0,a,this.ul.find("li").eq(a)];break}return i},getNumber:function(){return this.number},isMax:function(){return this.number>=this.options.max},getAll:function(){return $.map(this.ul.find("li"),function(t){return $(t).text()})}}),Motie.changeCity=function(t){var e=null;$.ajax({url:MotieHost+"/ajax/province/list",success:function(t){e=t}}),Motie.changeCity.layer=new Mo.layer({width:500,handle:$(t.handle),data:{html:['<a class="fr pop-close" href="#"></a>',"<h3>",'<img class="fl" src="'+ImgMotie+'/_assets/title-do-comment.gif"> 选择城市',"</h3>",'<div class="sp-20"></div>','<table class="for-table">',"<tbody>",'<tr height="100px">','<td class="col2">','<ul id="province"> </ul>',"</td>","</tr>","<tr><td><hr/></td> </tr>",'<tr height="60px;">','<td class="col2">','<ul id="city" class="tag-list"> </ul>',"</td>","</tr>","</tbody>","</table>"].join("")},onRendered:function(t){if(e){var i=[];$.each(e,function(t,e){i.push('<li onclick="Motie.changeCity.showCity('+e.id+')">'+e.name+"</li>")}),$("#province").html(i.join(""))}}})},Motie.changeCity.showCity=function(t){return $.ajax({url:MotieHost+"/ajax/city/"+t+"/list",cache:!1,success:function(t){1==t.length&&($("#selCity").val(t[0].name),$("#cityId").val(t[0].id),$("#do-select").toggle("fast"));var e=[];$.each(t,function(t,i){e.push('<li id="c'+i.id+'" onclick="Motie.changeCity.selectCity('+i.id+')">'+i.name+"</li>")}),$("#city").html(e.join(""))}}),!1},Motie.changeCity.selectCity=function(t){$("#selCity").val($("#c"+t).text()),$("#cityId").val(t),Motie.changeCity.layer.hideLayer(Motie.changeCity.layer)},Motie.addNewClass=function(t){var e=Date.getDate(serverTime),i=function(t){return!(e.getTime()>t.getTime()+6048e5)};t.find("li").each(function(){var t=$(this),e=t.attr("createdate"),a=Date.getDate(e);i(a)&&t.addClass("new")})},Motie.IsEmptyReply=function(t){var e=$.trim($("#"+t).val());return!(!e||/^回复@[^:]+:{1}$/i.test(e))||(alert("请输出回应内容！"),!1)}}(),Mo.register("core.delegate",function(t){return function(e,i){var a=t.core.action;$("body").delegate("a[action-type], button[action-type]","click",function(t){var e=this.getAttribute("action-type"),i=this.getAttribute("action-params")||"";if(e)if(a[e])a[e].call($(this),i);else{if(void 0==window.console)throw"action-type不存在："+e;console.log('action-type不存在："'+e+'",Element is:"',this,'"')}if($IE)return!1})}}),Mo.register("core.ajaxStatus",function(t){return{inProcess:function(t){return"processing"==t.attr("data-ajax-status")},done:function(t){return t.attr("data-ajax-status","done")},processing:function(t){return t.attr("data-ajax-status","processing")}}}),Mo.register("core.callback",function(t){return function(t,e,i){if(2==arguments.length)i=e,e=t;else{if(3!=arguments.length||!t.jquery)return $.noop;e=t.attr("data-custom-"+e)}return i[e]&&"function"==typeof i[e]?i[e]:$.noop}}),Mo.register("core.unique",function(){return function(t){for(var e,i=[],a={},o=0;null!=(e=t[o]);o++)a[e]||(i.push(e),a[e]=!0);return i}}),Motie.register("app.weibo",function(t){return function(e,i,a,o,n,s,r,l,c){function d(){if(u&&!h)if(a){l&&l.attr("class","loadIco").fadeIn("fast"),h=!0,e.addClass("disabled").attr("disabled","disabled");try{f[m]=e.val(),f[p]=n.val()}catch(i){t.error.push(i)}$.ajax({url:a,data:$.extend(f,s),type:"post",timeout:2e4,success:function(t){t?(l&&l.attr("class","okIco").delay(500).fadeOut(1e3),h=!1,e.removeClass("disabled").removeAttr("disabled"),c.onSuccess(t)):l&&l.attr("class","errorIco")},error:function(){l&&l.attr("class","errorIco"),c.onError()}})}else c()}var u=!1,h=!1,f={},m=e.attr("name"),p=n&&n.attr("name");if(c=$.extend({onSuccess:$.noop,onError:$.noop},c),o){var g=$.extend({},{url:"/ajax/icon/twitter/upload"},o);t.utils.upload(g)}e.keyup(function(a){u=t.limitTextarea(e,140,r),u?i.removeClass("disabled"):i.addClass("disabled"),(a.ctrlKey&&13==a.which||10==a.which)&&d()}).keyup(),t.ui.at&&t.ui.at(e),i.click(function(){d()})}}),Mo.register("utils.randomKey",function(t){return function(t){return Math.ceil(Math.random()*Math.pow(10,t||10))}}),Mo.register("utils.getFeedData",function(t){return function(t){var e=t.parent("[role=data-feed]").length?t.parent("[role=data-feed]"):t.parentsUntil("[role=data-feed]").last().parent();e[0]==document&&(e=t);var i={feedId:e.attr("data-feed-id")||0,typeId:e.attr("data-feed-type")||0,eventId:e.attr("data-event-id")||0};return i.feedId&&i.typeId?i:(void 0!=window.console&&console.log("action-type: "+t.attr("action-type")+" -- 不存在对象id或类型id，数据绑定对象：",e),null)}}),Motie.register("utils.upload",function(t){var e={handle:"",status:"",name:"uploadfile",appendTo:"body",url:"",ext:"^(jpg|jpeg|gif|png)$",id:"",onSubmit:$.noop,onComplete:$.noop,onError:$.noop};return function(i){try{var a=$.extend({},e,i)}catch(o){t.error.push(o)}return new AjaxUpload(a.handle,{id:a.id,appendTo:a.appendTo,action:a.url,name:a.name,onSubmit:function(t,e){var i=RegExp(e,"i");return e&&i.test(e)?(a.status&&(a.status.attr("class","loadIco").fadeIn("fast"),a.handle.hide()),void a.onSubmit(t,e)):(a.onError(t,e),!1)},onComplete:function(t,e){a.status&&a.status.attr("class","okIco").delay(500).fadeOut(700,function(){a.handle.show()}),a.onComplete(t,e)}})}}),Mo.register("utils.string",function(){var t={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;"},e={"&amp;":"&","&lt;":"<","&gt;":">","&quot;":'"',"&#39;":"'"};return{escapeHtml:function(e){return e.replace(/&(?!\w+;)|[<>"']/g,function(e){return t[e]||e})},reverseHtml:function(t){return t.replace(/&(amp|lt|gt|quot|#39);/g,function(t){return e[t]||t})},peelHtml:function(t){return t.replace(/<(.[^>]*)>/g,"").replace(/</g,"&lt").replace(/>/g,"&gt")},maxString:function(t,e){return t.length>e?t.substring(0,e)+"..":t},trim:function(t){return t.replace(/(^[\s\u3000]*)|([\s\u3000]*$)/g,"")},rtrim:function(t){return t.replace(/([\s\u3000]*$)/g,"")},ltrim:function(t){return t.replace(/(^[\s\u3000]*)/g,"")}}}),Mo.register("utils.array",function(){return{search:function(t,e){if($IE){for(var i=0,a=t.length;i<a;i++)if(t[i]===e)return!0;return!1}return t.indexOf(e)!=-1},unique:function(t){for(var e,i=[],a={},o=0;null!=(e=t[o]);o++)a[e]||(i.push(e),a[e]=!0);return i}}}),Mo.register("utils.cache",function(t){var e=Base.extend({constructor:function(t){this.setting=$.extend({}),this.count=0,this.store={},this.array=[]},save:function(t,e){return void 0!=t?(this.count++,2==arguments.length?(this.store[t]=e,e):(e=t,this.array.push(e),e)):null},get:function(t){return t in this.store?this.store[t]:null},empty:function(){this.store={},this.array=[]}});return e}),function(){Mo.register("utils.dom.centerImage",function(){return function(t){t=void 0==t?this:t;var e=$(t).find("ul img"),i=e.eq(0).parent().width();e.size(),e.length&&e.each(function(t){var e=$(this),a=e.attr("src"),o=i,n=new Image;n.src=a,Motie.loadImg(a,function(){var t=this.width,i=this.height,a=1;t>i?(i>o&&(a=o/i,e.height(o)),(t=e.width())>o&&e.css({"margin-left":-(t-o)/2})):t<i?(t>o&&(a=o/t,e.width(o)),i*a>o&&e.css({"margin-top":-(i*a-o)/2*.618})):t==i&&t>o&&e.width(o),e.height()<o&&i!=t&&$OLDIE&&($IE6||$IE7)&&e.css({"margin-top":(o-i)/2}),$IE6?e.show():e.fadeIn()})})}})}(),function(){Motie.register("utils.dom.elementScroll",function(t){var e={onScroll:$.noop,onBottom:$.noop,onTop:$.noop};return function(i,a){try{var o=$.extend({},e,a)}catch(n){t.error.push(n)}$(i).xresize(function(t){var e=$(this),i=e.scrollTop(),a=e.height(),n=e.children().first().outerHeight(),s={fullheight:n,pos:"top",current:0,height:a};0==i?(o.onTop(s),s.pos="top"):i+a==n?(o.onBottom(s),s.pos="bottom"):s.pos="fly",s.current=i,o.onScroll(s)})}})}(),function(){Mo.register("utils.dom.delayKeyup",function(t){return function(e){var i={element:"",duration:0,process:$.noop};e&&$.extend(i,e);var a=null,o=$(i.element),n=function(){return!!o.val()&&void("function"==typeof i.process?i.process(i.element,t):"object"==typeof i.process&&(i.process.start(),$.ajax(i.process)))};o.keyup(function(){i.duration>0?(a&&(clearTimeout(a),a=null),a=setTimeout(n,i.duration)):n()})}})}(),Mo.register("ui.overlay",function(){var t,e=$(window),i={layer:null,create:function(){t=$("body"),this.layer=$('<div class="mo-ui-overlay" />').appendTo("body")},hide:function(){this.layer.hide()},show:function(){null===this.layer&&this.create();var i=e.height(),a=t.outerHeight(),o=0;return o=i>=a?i:a,this.layer.css({height:o,opacity:.4}).show(),this.layer}};return i}),Mo.register("ui.flyout",function(){return function(t,e){var i=null,a=Mo._Constructor.flyout;return void 0===t?a:("string"==typeof t&&((i=a.template[t])?(t=$(i.element),e=e?$.extend(i.options,e):i.options):t=$(t),$("body").append(t)),t.data("flyout")||t.data("flyout",new a(t,e)),t.data("flyout"))}}),Mo.register("_Constructor.flyout",function(t){var e=$(window),i=$(document),a=Base.extend({constructor:function(e,i){this._baseFlyoutConstructor(e,i),this.element.on("keydown",function(){}).on("click",function(t){t.stopPropagation()}),this._primayId=t.utils.randomKey(),this.element.attr("data-flyout-primayId","M-flyout-"+this._primayId),
a.cache[this.primayId]=this},_element:null,_anchor:null,_where:{},parasitic:{},_baseFlyoutConstructor:function(t,e){this.setting={onRendered:$.noop,onShow:$.noop,onHide:$.noop,destroy:!1,ruleOutMe:!1,sameAnchorHide:!0,hideDirect:"default",stayTime:0,anchorStay:!1,hideOffset:10,showOffset:10,showDuration:150,easing:"swing",classStyle:""},this.element=t,this._originalHTML=t.html(),this._placement="top",this._alignment="center",this.element.addClass("mo-ui-flyout").css({position:"absolute"}),e&&($.extend(this.setting,e),e.anchor&&(this._anchor=e.anchor),this.element.addClass(this.setting.classStyle)),this.setting.onRendered.call(this,t)},show:function(t,e,i){this._baseFlyoutShow(t,e,i)},hide:function(){this._baseFlyoutHide(),i.unbind("click",this.hide)},_createStayTimer:function(){var t=this;this.setting.stayTime&&(this._clearStay(),this._stayTimer=setTimeout(function(){t.hide()},this.setting.stayTime+this.setting.showDuration))},_clearStay:function(){this._stayTimer&&(clearTimeout(this._stayTimer),this._stayTimer=null)},_fixed:function(){a.currentShowFlyout},destroy:function(){return this.element.remove(),a.cache[this.primayId]=null,null},recover:function(){this.element.html(this._originalHTML)},_baseFlyoutShow:function(t,e,o){var n=this,s=this.element,r=!1;if(t?t.jquery||(t=$(t)):t=this._anchor,e||(e=this._placement),o||(o=this._alignment),!t)throw"没有标记锚点";this._currentAnchor&&this._currentAnchor[0]==t[0]&&(r=!0),this._currentAnchor=t,this._currentPlacement=e,this._currentAlignment=o,a.currentShowFlyout=this,t&&this._getTopLeft(),this._hideAllVisibleFlyout(this),r&&this.setting.sameAnchorHide&&s.is(":visible")?this.hide():(!r||r&&!this.setting.sameAnchorHide||r&&this.setting.sameAnchorHide&&s.is(":hidden"))&&(i.unbind("click",$.proxy(this.hide,this)),n._createStayTimer(),s.show().css("z-index",this._getZIndex(t)).css(this._startPosition).animate(this._endPosition,{easing:this.setting.easing,duration:this.setting.showDuration,complete:function(){i.one("click",$.proxy(n.hide,n))}}),n.setting.onShow.call(n,s,t))},_baseFlyoutHide:function(){this._clearStay();var t=this,e={opacity:0},i=this.setting.hideOffset;switch(this.setting.hideDirect){case"top":e.top=this.element.offset().top-i;break;case"bottom":e.top=this.element.offset().top+i;break;case"left":e.left=this.element.offset().left-i;break;case"right":e.left=this.element.offset().left+i}this.element.animate(e,{easing:this.setting.easing,duration:100,complete:function(){$(this).hide(),t.setting.destroy&&t.destroy()}}),this.setting.onHide.call(this,this.element,this._currentAnchor)},_hideAllVisibleFlyout:function(t){$(".mo-ui-flyout").each(function(){var e=$(this),i=e.data("flyout");i===t&&t.element.is(":visible")&&t.setting.onHide.call(t,t.element,t._currentAnchor),i&&e.is(":visible")&&i!==t&&!i.setting.ruleOutMe&&i.hide()})},_getZIndex:function(t){var e=2e3,i=t.parentsUntil("body").last().css("z-index");return"auto"!=i&&i>=e&&(e=i+1),e},_getTopLeft:function(){var t=this._currentAnchor,i={left:t.offset().left,right:t.offset().left+t.outerWidth(),top:t.offset().top,bottom:t.offset().top+t.outerHeight(),width:t.outerWidth(),height:t.outerHeight()},a={width:this.element.outerWidth(),height:this.element.outerHeight()};switch(this._currentScrollTop=e.scrollTop(),this._startPosition={opacity:0},this._endPosition={opacity:1},this._currentPlacement){case"top":this._where.at="top",this._fitTop(i,a)||(this._fitBottom(i,a),this._where.at="bottom"),this._centerHorizontally(i,a,this._currentAlignment);break;case"bottom":this._where.at="bottom",this._fitBottom(i,a)||(this._fitTop(i,a),this._where.at="top"),this._centerHorizontally(i,a,this._currentAlignment);break;case"left":this._where.at="left",this._fitLeft(i,a)||(this._fitRight(i,a),this._where.at="right"),this._centerVertically(i,a);break;case"right":this._where.at="right",this._fitRight(i,a)||(this._fitLeft(i,a),this._where.at="left"),this._centerVertically(i,a);break;case"auto":}},_fitTop:function(t,e){return this._nextTop=t.top-e.height,this._nextAnimTop=this._nextTop-this.setting.showOffset,this._nextTop>=0&&this._nextAnimTop>this._currentScrollTop&&this._nextAnimTop+e.height<t.top},_fitBottom:function(t,i){return this._nextTop=t.bottom,this._nextAnimTop=t.bottom+this.setting.showOffset,this._nextTop>=0&&this._nextAnimTop-this._currentScrollTop+i.height<e.height()},_fitLeft:function(t,i){return this._nextLeft=t.left-i.width+this.setting.showOffset,this._nextAnimLeft=this._nextLeft-2*this.setting.showOffset,this._nextLeft>=0&&this._nextLeft+i.width<e.width()},_fitRight:function(t,i){return this._nextLeft=t.right-this.setting.showOffset,this._nextAnimLeft=this._nextLeft+2*this.setting.showOffset,this._nextLeft>=0&&this._nextLeft+i.width<e.width()},_centerVertically:function(t,i){this._nextTop=t.top+t.height/2-i.height/2,0>this._nextTop?this._nextTop=t.top:this._nextTop+i.height>e.height()+e.scrollTop()&&(this._nextTop=t.bottom),this._startPosition.top=this._nextTop,this._startPosition.left=this._nextLeft,this._endPosition.left=this._nextAnimLeft},_centerHorizontally:function(t,e,i){"center"==i?this._nextLeft=t.left+t.width/2-e.width/2:"left"==i?this._nextLeft=t.left:"right"==i&&(this._nextLeft=t.right-e.width),this._startPosition.left=this._nextLeft,this._startPosition.top=this._nextTop,this._endPosition.top=this._nextAnimTop}},{cache:{},currentShowFlyout:null,hideAllFlyout:function(){$(".mo-ui-flyout:visible").each(function(){var t=$(this),e=t.data("flyout");e&&t.is(":visible")&&e.hide()})},template:{confirm:{element:'<div>            \t\t\t\t<p class="text"></p>            \t\t\t\t<a href="javascript:;" role="ok" class="M-button-s">确认</a>            \t\t\t\t<a href="javascript:;" role="cancel" class="M-button-s M-button-grey">取消</a>            \t\t\t\t<span class="mo-ui-arrow-bottom"></span>            \t\t\t</div>',options:{classStyle:"mo-ui-flyout-confirm"}},info:{element:"<div></div>",options:{stayTime:800,sameAnchorHide:!1,hideDirect:"top"}},prompt:""}});return e.xresize(function(){a.hideAllFlyout()},"resize"),a}),Mo.register("ui.confirm",function(t){var e=null,i=null,a=null;return function(t,o,n,s,r,l){l=void 0!==l,1==l&&(a=e,e=null),o=o||$.noop,n=n||"",null==e&&(e=Mo.ui.flyout("confirm",{destroy:l,onRendered:function(t){var e=this;t.delegate("a[role]","click",function(){e.hide();var t=$(this).attr("role"),i=e._currentAnchor;return"ok"==t&&e.parasitic.ok(i,e),!1})}}),i=e.element.find("p.text")),e.parasitic={ok:o},n?(i.css("width","auto").show().html(n),e.element.outerWidth()>300&&i.width("250")):i.hide().html(""),e.show(t,s||"top",r||"center"),l&&(e=a)}}),Mo.register("ui.info",function(){var t=null;return function(e,i,a,o,n,s){t=e.data("flyout"),t||(t=Mo.ui.flyout("info",{destroy:!0,stayTime:o||800,classStyle:a||"mo-ui-info-ok",onHide:function(){e.data("flyout",null)},onRendered:function(){e.data("flyout",this)}}),t.element.html(i).mouseenter(function(){t._clearStay()}).mouseleave(function(){t._createStayTimer()}),t.show(e,n||"top",s||"center"))}}),function(){Mo.register("ui.emotion",function(){var t,e,i,a=!1,o=null,n=Motie.TextareaUtils,s={show:function(){s.get(function(t){t.css({top:i.offset().top+i.height()+10,left:i.offset().left}).show()})},hide:function(){o&&o.hide()},get:function(t){if(null===o){if(a)return;a=!0,$.ajax({url:"/ajax/emotion/all",success:function(e){a=!1,o=$(e).hide(),$("body").append(o),t(o),s.bind()}})}else t(o)},bind:function(){$(document).on("click",s.hide),o.find(".close").click(function(){s.hide()}),o.find("li").click(function(i){var a=e.val(),o=e[0],r=this.title,l=0,c=n.getCursorPos(o);if(""!=n.getSelectedText(o)){var d=Motie.TextareaUtils.getSelectedText(o).length;e.val([a.substring(0,c),"["+this.title+"]",a.substring(c+d,a.length)].join(""))}else e.val([a.substring(0,c),"["+this.title+"]",a.substring(c,a.length)].join(""));return l=c+r.length+2,n.setCursor(o,l,0),s.hide(),t(),!1})}};return function(a,o,n){if(void 0!==a){if(i=a.jquery?a:$(a),e=o.jquery?o:$(o),t=n||$.noop,!a.length)return void(void 0!=window.console&&console.log("Mo.ui.emotion：anchor不存在，无法定位表情层的显示位置"));if(!o.length)return void(void 0!=window.console&&console.log("Mo.ui.emotion：textarea不存在，无法插入表情"));s.show()}return s}})}(),Mo.register("ui.ico",function(t){var e={check:'<img src="http://img.motieimg.com/_resources/css/img/field.gif" class="ico-rela-check">',checked:'<img src="http://img.motieimg.com/_resources/css/img/field.gif" class="ico-rela-checked">',del:'<img src="http://img.motieimg.com/_resources/css/img/field.gif" class="ico-rela-del">',add:'<img src="http://img.motieimg.com/_resources/css/img/field.gif" class="ico-rela-add">',each:'<img src="http://img.motieimg.com/_resources/css/img/field.gif" class="ico-rela-each">',loading:'<img src="http://img.motieimg.com/_resources/css/img/field.gif" class="ico-load-hor">',sp:'<em class="sp"></em>',close:"✖"};return e}),Mo.register("ui.at",function(){return function(){}}),Mo.register("ui.search",function(){function t(t){return $('<li class="clear '+t.className+'"></li>').data("item.autocomplete",t).append(Mustache.to_html(d,t))}function e(t){return t.length>4?t.substring(0,4)+"..":t}function i(t){return t.replace(/(<(.[^>]*)>)|( )/g,"").replace(/</g,"&lt").replace(/>/g,"&gt")}function a(i){var a={book:{storage:[],text:"作品",objectType:2,desc:"作者："},people:{storage:[],text:"人",objectType:1,desc:"粉丝："},article:{storage:[],text:"文章",objectType:5,desc:"作者："},group:{storage:[],text:"小组",objectType:18,desc:"成员："}};for(var o in i){var n,s=o,r=i[o],c=a[s],d=c.storage,u={className:"term-link term-is-"+s,itemType:"link",label:"搜“<b>"+e(l)+"</b>”相关"+c.text+">>",value:l,desc:"",link:"/rest/?queryString="+l+"&objectType="+c.objectType};u.element=t(u),d.push(u);for(var h=0,f=r.length;f>h;h++)n=r[h],$.extend(n,{className:"item item-"+s,itemType:"item",label:n.label.replace(RegExp("("+l+")","ig"),"<b>$1</b>"),desc:c.desc+(/people|group/.test(s)?n.count:n.author),value:l}),n.element=t(n),d.push(n)}return[].concat(a.book.storage,a.people.storage,a.article.storage,a.group.storage,[{}])}var o,n={},s=null,r=null,l="",c={book:[],people:[],article:[],group:[]},d=['{{#icon}}<div class="lpic"><img width="36" src="{{icon}}" /></div>{{/icon}}','<div class="rtext"><a class="must-hide"></a><h3>{{{label}}}</h3>','<p class="desc">{{desc}}</p>',"</div>"].join("");return function(t,e){function d(){h.toggleClass("must-hide"),f.toggleClass("must-hide")}var u=$(t),h=u.find(".loadIco"),f=u.find("input[type=submit]"),m=u.find("input.lst").autocomplete({select:function(t,e){window.location.href=e.item.link},open:function(){r=s.find("li")},focus:function(t,e){var i=e.item,a=i.element;r.removeClass("item-current"),a.addClass("item-current"),"item"==i.itemType&&m.val(i.label)},source:function(t,s){if(l=i(t.term),""!=l){if(l in n)return void s(a(n[l]));d(),o=$.ajax({url:e,cache:!1,data:{queryString:l},error:function(){d(),s(a(c))},success:function(t,e,i){d(),n[l]=$.isEmptyObject(t)?c:t,i===o&&s(a(n[l]))}})}}}),p=m.data("autocomplete");s=p.widget().toggleClass("search-result"),s.delegate("li","click",function(){window.location=$(this).data("item.autocomplete").link}).delegate("li","mouseover",function(){r.removeClass("item-current"),$(this).addClass("item-current")}),p._renderItem=function(t,e){return t.append(e.element)},p._move=function(t,e){return this.menu.element.is(":visible")?void this.menu[t](e):void this.search(null,e)}}}),Mo.register("ui.autocomplete",function(t){var e=t.utils.string,i=Base.extend({constructor:function(t,e){this.input=t,this.setting=$.extend({url:"",dataType:"",select:$.noop,open:$.noop,focus:$.noop,classStyle:"",selectFirst:!0},e),this._baseCreateUIAutoComplete()},cache:{},lastXhr:null,list:null,allItem:null,term:"",_baseCreateUIAutoComplete:function(){var t=this;this.input.autocomplete({select:function(e,i){t.setting.select.call(t,e,i)},open:function(e,i){t.allItem=t.list.find("li"),$(this).removeClass("ui-corner-all"),t.setting.open.call(t,e,i),t.setting.selectFirst&&t.list.find("li:first a").trigger("mouseenter")},focus:function(e,i){t.setting.focus.call(t,e,i)},source:function(i,a){if(t.term=e.peelHtml(i.term),""!=t.term)return t.term in t.cache?void a(t.cache[t.term]):void(t.lastXhr=$.ajax({url:t.setting.url,dataType:"jsonp",data:{word:t.term,count:10},success:function(e,i,o){t.cache[t.term]=$.isEmptyObject(e)?emptyObject:$.map(e.users,function(t){return{label:t.username,value:t.username}}),o===t.lastXhr&&a(t.cache[t.term])}}))}}),t.list=this.input.data("autocomplete").widget().toggleClass("mo-ui-autocomplete-result "+this.setting.classStyle)}},{cache:{}});return function(t,e){var a,o,n;return t=t.jquery?t:$(t),!!t[0]&&(a=e.input||t.find("[role=input]"),o=e.submit||t.find("[role=submit]"),n=e.load||t.find("[role=load]"),!!a[0]&&new i(a,e))}}),Mo.register("ui.tags",function(t){var e=Base.extend({constructor:function(t){var e,i=this;this.options=e=$.extend({input:"",ul:"",className:"",max:1e3,disableEnter:!1,onAdd:$.noop,onRemove:$.noop,onOver:$.noop,onRendered:$.noop,onEmpty:$.noop,addAccordingTo:function(){return!0},defaultText:"输入标签",same:!1},t),this.number=0,this.enableAdd=!0,this.input=$(e.input),this.value=$.trim(this.input.val()).split(" "),this.ul=$(e.ul),this.hidden=$('<input type="hidden" name='+(this.input.attr("name")||"tags")+" />"),this.input.after(this.hidden).attr("name",""),""!=this.value[0]&&(this.input.val(""),$.each(this.value,function(t,e){i.add(e)})),this.input.bind("keydown blur",function(t){var a=($(this),i.ul),o=$.trim(this.value);if(e.disableEnter){if(8!=t.keyCode)return!1;i.remove(t)}else if(i.number<=i.options.max&&""!=o&&!o.match(/[' '|\u3000]+/)){if("blur"==t.type&&i.enableAdd||"keydown"==t.type&&(9==t.keyCode||32==t.keyCode)||13==t.keyCode)return i.add(o),this.value="",!1}else i.number>0&&""==this.value&&8==t.keyCode&&a.find("li").size()&&i.remove(t)}),this.input.parent().click(function(){i.input.focus()}).end(),this.ul.delegate("li .rm","click",function(t){i.remove(t)}),this.options.onRendered.call(this)},add:function(t,e){var i=this,a=i.options,o=a.className,n=i.ul,e=e||{},s=this.search(t);if(i.number>=a.max)return a.onOver(i),!1;if(!a.same&&s[0]===!0||!a.addAccordingTo(t))return s[2].find("a").effect("highlight"),!1;i.number++;var r=$('<li class="'+o+'"><a><em title="'+t+'" class="name">'+t+'</em><span title="删除" class="rm"></span></a></li>').data(e);return n.append(r),i.options.onAdd(i,r),i.hidden.val(i.getAll().join(" ")),i},addMore:function(t){var e=this;t="string"==typeof t?$.trim(t).split(" "):t,void 0!=t&&""!=t[0]&&$.map(t,function(t,i){e.add(t)})},remove:function(t){var e,a=this,o=a.ul;if(0==a.number)return opt.onEmpty(a),!1;switch(typeof t){case"object":switch(t.type){case"click":e=$(t.target).parent().parent();break;case"keydown":e=o.find("li:last")}break;case"number":e=o.find("li").eq(i);break;case"string":e=a.search(t)[2]}return e.length&&e.remove(),a.options.onRemove(a,e),a.hidden.val(a.getAll().join(" ")),a.number>0&&a.number--,a},empty:function(){this.ul.empty(),this.hidden.val(""),this.options.onEmpty(this)},search:function(t){for(var e=this.getAll(),i=[!1,0,null],a=0;a<e.length;a++)if(t==e[a]){i=[!0,a,this.ul.find("li").eq(a)];break}return i},getNumber:function(){return this.number},isMax:function(){return this.number>=this.options.max},getAll:function(){return $.map(this.ul.find("li"),function(t){return $(t).text()})},getValue:function(){return this.hidden.val()}});return function(t){return t?new e(t):e}}),function(){Mo.register("fx.tab",function(t){var e=function(t){var e,i=this,a=t||{},o=this.handles=$(a.handle),n=this.items=$(a.toggleItem),s=n.size(),r=eventType=a.eventType||"mouseenter",l=a.callback||$.noop,c=(a.show||1)-1,d=a.tabUrl||"",u=a.onSuccess||$.noop,h=a.cache===!0,f=$(a.loading),m=void 0===a.hoverStop||a.hoverStop,p=this.tabsCache=[],g=a.handleClass,y=a.handleCurrentClass,v=a.animate||!1,b=t.auto||!1,w=this.duration=t.duration||3e3;m&&n.mouseenter(function(){e&&clearTimeout(e)}).mouseleave(function(){b&&(e=setTimeout(function(){C(M(c))},w))});var x=function(t,e){function a(){n.css("display","none"),e.is("tbody")||e.is("tr")||e.is("td")?e.css("display",""):e.css("display","block")}i.show=t;var o=n.filter(":visible");if(v){if("function"==typeof v)v(i,o,e);else if("string"==typeof v)switch(v){case"opacity":o.stop().animate({opacity:0},function(){$(this).hide()}),e.show().stop().animate({opacity:1});break;case"translation":o.stop().animate({marginLeft:50,marginTop:50,opacity:0},function(){o.hide()}),e.show().stop().css({marginLeft:-50,marginTop:-50,opacity:0}).animate({marginLeft:0,marginTop:0,opacity:1})}}else a()};x(c,n.hide().eq(c)),l(c,o.eq(c),n.eq(c));var M=function(t){return t>=s-1?c=0:t>=0?++c:void 0},C=function(t){var i=void 0===t?c:t,a=o.eq(i),s=n.eq(i),r=p[i];c=i,a.hasClass(y)||(o.removeClass(y).addClass(g),a.addClass(y),void 0===r&&(r=!1),""!==d&&0==r?(f.stop().animate({opacity:1},"fast"),$.ajax({url:d,cache:!1,data:{name:a.attr("id")},success:function(t){s.html(t).show(),u(i,a,s),h&&(r=!0),f.stop().animate({opacity:0},"fast")}})):x(i,s),l(i,a,s),e&&clearTimeout(e),b&&(e=setTimeout(function(){C(M(i))},w)))};o.removeClass(y).eq(c).addClass(y).end().each(function(t){var i=$(this);eventType.push&&(r=eventType[t]),i[r](function(){e&&clearTimeout(e),C(t)})}),b&&(e=setTimeout(function(){C(M(c))},w)),""!==d&&o.eq(c).removeClass(y).click()};return e}),Motie.Tab=Mo.fx.tab}(),Mo.register("core.action.confirmToLink",function(t){return function(){return Mo.ui.confirm(this,function(t,e){var i=t.data("link"),a=t.data("anchor-text");a&&t.html(a),window.location=i},this.data("confirm-text")||""),!1}}),Mo.register("core.action.report",function(t){var e="/ajax/exposure/add";return function(t){if(Mo.CheckLogin(!0)){var i=this;if(t)try{t=JSON.parse(t)}catch(a){throw"对象参数错误"}else{var o=Mo.utils.getFeedData(i);t={objectId:o.feedId,objectType:o.typeId}}var n=(screen.height-700)/2,s=(screen.width-600)/2;window.open(e+"?objectId="+t.objectId+"&objectType="+t.objectType,"举报","height=700,innerHeight=700,width=600,innerWidth=600,top="+n+",left="+s+",toolbar=no,menubar=no,scrollbars=auto,resizeable=no,location=no,status=no")}}}),Mo.register("core.action.follow",function(t){var e=Mo.ui.ico,i=Mo.core.ajaxStatus,a=Mo.core.callback,o={people:1,book:2,site:21,blog:54},n={add:function(t,e,i,a,s){n.send("/ajax/contact/follow/add/"+e+"/"+o[i],t,s||function(){n.changeBtnStatus(t,i,a,t.attr("data-read-status"))})},del:function(t,e,i,s,r){n.send("/ajax/contact/follow/"+e+"/"+o[i]+"/del",t,r||function(){n.changeBtnStatus(t,i,s,"-1"),a(t,"callback-delFollow",Mo.core.action.follow)(t),a("callback_delFollow",Mo.core.action.follow)(t)})},dontFollowMe:function(t,i,a,s,r){var l=$("a.M-button-s[action-type=follow][data-follow-id="+i+"][data-follow-status="+s+"]");n.send("/ajax/contact/follower/"+i+"/"+o[a]+"/del",t,r||function(){n.status.set(l,5),"1"==s?n.status.set(l,5).html(e.add+e.sp+"加关注"):"3"==s&&n.status.set(l,2).html(e.checked+"已关注"+e.sp+"取消"),t.remove()})},outBlacklist:function(t,e,i,a,o){n.send("/ajax/contact/bastard/"+e+"/del",t,"function"==typeof o?o:function(){n.changeBtnStatus(t,i,a)})},removeToBlacklist:function(t,e){var i=t.parentsUntil("div.mod").last().find("a[data-follow-id="+e+"].M-button-b");n.outBlacklist(i,i.data("follow-id"),i.data("follow-type"),""+i.data("follow-status")),n.addToBlacklistStatus(!1)},addToBlacklist:function(t,i,a,o){n.send("/ajax/contact/bastard/add/"+i,t,"function"==typeof o?o:function(){n.addToBlacklistStatus(!0);var a=t.parentsUntil("div.mod").last().find("a[data-follow-id="+i+"].M-button-b");n.status.set(a,4).addClass("M-button-grey").html(e.del+"已加入黑名单"+e.sp+"解除")})},addToBlacklistStatus:function(t){var e=$("#addFollowOrNot");e.length&&(t?e.html("取消黑名单").attr("data-follow-status","remove-out-blacklist"):e.html("加入黑名单").attr("data-follow-status","add-to-blacklist"))},status:{set:function(t,e){return t.attr("data-follow-status",e)}},send:function(o,s,r){if(!i.inProcess(s)){s.timer=setTimeout(function(){i.processing(s).html(e.loading+e.sp+"处理中")},1e3);var l=s.clone();$.ajax({url:o,cache:!1,success:function(e){function o(){n.addToBlacklistStatus(!1),r(e)}function c(){t.ui.info(s,e.message)}s.timer&&(clearTimeout(s.timer),s.timer=null),i.done(s).trigger("done");var d=Mo.core.action.follow,u=typeof e,h="",f="";if("boolean"==u&&u||"string"==u&&""!=u)if(a("followSuccess",d)(s,l,e),h=s.attr("data-custom-success")){if(!d[h])throw o(),'自定义方法不存在：data-custom-success="'+h+'"没有注册到mo.core.action.follow';d[h](s,l,o)}else o();else if("object"==u&&"error"==e.code)if(f=s.attr("data-custom-error")){if(!d[f])throw c(),'自定义方法不存在：data-custom-error="'+h+'"没有注册到mo.core.action.follow';d[f](s,c)}else c()}})}},editReadFlyoutElement:'<div class="mo-ui-flyout-box"><a role="change" class="M-button-s M-button-grey" data-read-status="0">在读</a> <a role="change" class="M-button-s M-button-grey" data-read-status="2">已读完</a>&nbsp; <a href="javascript:;" style="font-size:12px;color:#666" class="cancel-follow">取消收藏</a></div>',editReadStatus:null,editBook:function(t,e,i){null==n.editReadStatus&&(n.editReadStatus=Mo.ui.flyout(n.editReadFlyoutElement,{onRendered:function(t){var e=this;this.buttons=t.find("a[role=change]").click(function(){e.buttons.removeClass("M-button-orange"),$(this).addClass("M-button-orange"),$.ajax({url:"/ajax/contact/follow/edit/"+e.parasitic.id,type:"post",data:{status:$(this).data("read-status")},success:function(t){"success"==t.code&&a(e._currentAnchor,"callback-editSuccess",Mo.core.action.follow)(e._currentAnchor,t.message),e.hide()}})}),t.find("a.cancel-follow").click(function(){n.del(e._currentAnchor,e.parasitic.id,"book","2"),e.hide()})},onShow:function(){this.buttons.removeClass("M-button-orange").filter("[data-read-status="+this.parasitic.read+"]").addClass("M-button-orange")}})),n.editReadStatus.parasitic={id:e,type:i,read:t.attr("data-read-status")},n.editReadStatus.show(t,"top","center")},changeBtnStatus:function(i,o,s,r){if("people"==o)switch(s){case"5":n.status.set(i,"2").html(e.checked+"已关注"+e.sp+"取消").addClass("M-button-grey");break;case"4":n.status.set(i,"5").html(e.add+e.sp+"加关注").removeClass("M-button-grey");break;case"2":n.status.set(i,"5").html(e.add+e.sp+"加关注").removeClass("M-button-grey");break;case"3":n.status.set(i,"1").html(e.check+e.sp+e.add+"加关注").removeClass("M-button-grey");break;case"1":n.status.set(i,"3").html(e.each+"互相关注"+e.sp+"取消").addClass("M-button-grey")}else if("book"==o)switch(s){case"5":n.status.set(i,"2"),i.attr("data-read-status",0),"bookDetail"!=i.data("belong")?i.addClass("M-button-grey").html(e.checked+"在读"+t.ui.ico.sp+"取消"):a(i,"callback-followThisBook",Mo.core.action.follow)(i,2);break;case"2":switch(n.status.set(i,"2").attr("data-read-status",r),r){case"-1":n.status.set(i,"5").html(e.add+e.sp+"收藏").removeClass("M-button-grey");break;case"0":"edit"==i.attr("control-type")?i.html(e.checked+"在读"+e.sp+"修改").addClass("M-button-grey"):i.html(e.checked+"在读"+e.sp+"取消").addClass("M-button-grey");break;case"1":i.html(e.checked+"在读"+e.sp+"修改").addClass("M-button-grey");break;case"2":i.html(e.checked+"已读完"+e.sp+"修改").addClass("M-button-grey")}}return i}};return function(){if(this.jquery){if(!Motie.CheckLogin(!0))return;var t=this,e=t.attr("data-follow-type"),i=t.attr("data-follow-id"),a=t.attr("data-follow-status"),o=t.attr("control-type");if("dontFollowMe"==o)return void n.dontFollowMe(t,i,e,a);if("edit"==t.attr("control-type")&&"book"==e&&"2"==a)return void n.editBook(t,i,e,a,t.data("read-status"));switch(a){case"1":n.add(t,i,e,a);break;case"5":n.add(t,i,e,a);break;case"2":n.del(t,i,e,a);break;case"3":n.del(t,i,e,a);break;case"4":n.outBlacklist(t,i,e,a);break;case"add-to-blacklist":n.addToBlacklist(t,i,e,a);break;case"remove-out-blacklist":n.removeToBlacklist(t,i,e,a)}}return n}}),Mo.register("core.action.comment",function(t){var e=(t.core.action.comment,Motie.TextareaUtils);Mo.core.ajaxStatus,Mo.ui.ico;var i={show:function(e){function a(t){if($.trim(t)){var a=$(t).hide();if(e.data("comment",a).data("open-status","open").attr("data-ajax-status","done"),customSuccess=e.attr("data-custom-success")){if(!u[customSuccess])throw'自定义方法不存在：data-custom-success="'+customSuccess+'"没有注册到mo.core.action.comment';e.html(d),u[customSuccess](e,i,t)}else e.parentsUntil(".txtbox-item").last().parent().append(a),a.attr({"data-reply-id":r,"data-reply-name":l}),i.bind(a),a.slideDown("fast",function(){a.find("textarea[role=input-comment]").focus(),e.html(d)})}}function o(t){if(c=e.attr("data-custom-error")){if(!u[c])throw'自定义方法不存在：data-custom-error="'+c+'"没有注册到mo.core.action.comment';u[c](e,t)}}var n=t.utils.getFeedData(e),s=e.data("get-count")||10,r=e.attr("data-reply-id")||0,l=e.data("reply-name")||"",c=customSuccess="",d=e.html(),u=t.core.action.comment;e.attr("data-ajax-status","processing").html(t.ui.ico.loading+"加载中"),i.get(n.feedId,n.typeId,n.eventId,s,a,o)},hide:function(e){var a=e.data("comment"),o=t.utils.getFeedData(e),n=e.find(".num");a&&(i.getCommentCount(o.feedId,o.typeId,function(t){n.text(t.reply)}),a.slideUp("fast",function(){a.remove(),e.data("comment",null)}))},allowReply:function(t,e,i,a){a=a||$.noop,$.ajax({url:"/ajax/reply/allowReply",data:{type:e,id:i},success:function(t){var e="";if("success"==t.code)a(!0,e,t);else if("error"==t.code){switch(t.message){case"too_fast":e="发的太快啦，请10秒后再发";break;case"no_login":e="您还没有登录";break;case"no_active":e="您的帐户还没有验证邮箱";break;case"shutup":e="您的账号已被禁言";break;case"not_allow":e='只有<em class="blue">'+t.name+"</em>关注的用户才可以回应";break;case"book_not_allow":e=t.name}a(!1,e,t)}}})},getCommentCount:function(t,e,i){$.getJSON("/ajax/info/"+t+"/"+e+"?callback=?",function(t){i(t)})},get:function(t,e,i,a,o,n){o=o||$.noop,n=n||$.noop,$.ajax({url:"/ajax/reply/list/"+t+"/"+e+"/"+a,cache:!1,data:{eventId:i},timeout:1e4,error:function(){n()},success:function(t){o(t)}})},send:function(t,e,i,a,o,n,s,r,l,c){$.ajax({url:"/ajax/reply/add/"+t+"_"+e,type:"post",data:{content:n,eventId:i,replyId:a,retwitter:s,replyOriginal:r},error:c,success:function(t){l(t)}})},del:function(e){t.ui.confirm(e,function(t){t.html(Mo.ui.ico.loading+"删除中..").attr("data-ajax-status","processing"),$.ajax({url:"/ajax/object/del",type:"post",data:{id:t.attr("data-comment-id"),type:7},success:function(e){e&&(t.html("已删除").attr("data-ajax-status","done"),t.parentsUntil("div[role=item-comment],li[role=item-comment]").parent().slideUp("fast",function(){$(this).remove()}))}})})},reply:function(t){if(!Motie.CheckLogin(!0))return!1;var a=t.parentsUntil("div[role=data-comment]").last().parent(),o=a.find("form[role=form-comment]"),n=o.find("textarea[role=input-comment]"),s=t.data("reply-name"),r=t.data("comment-id"),l=n.val(),c=n[0],d=l.length,u=(e.getCursorPos(c),"回复@"+s+":"),h=l.indexOf(":"),f=l.substring(0,h+1),m="";i.isAllowReply(t,r,7,function(){/^\u56de\u590d@.*:$/.test(f)?(m=l.replace(f,""),u+=m):""!=$.trim(l)&&(u+=l),n.val(u),d=n.val().length,e.setCursor(c,d,0),o.find("input[role=reply-id]").val(r),a.attr("data-reply-id",r)})},isAllowReply:function(t,e,a,o){i.allowReply(_config,a,e,function(e,i){return e?void o():void Mo.ui.info(t,i,"mo-ui-info-warning")})},quick:function(a){var o,n=t.utils.getFeedData(a),s=a.data("comment-id"),r=a.data("reply-name"),l=a.data("append-direct")||"bottom",c=a.data("comment-form");i.isAllowReply(a,s,7,function(){function t(){var t=c.find("textarea[role=input-comment]"),i="回复@"+r+":";t.val(i),c.show(),setTimeout(function(){e.setCursor(t[0],i.length,0),t.focus()},1)}function d(){var t=c.find("textarea[role=input-comment]");c.slideUp("fast"),t.val("")}if(c)c.is(":visible")?d():t();else{if(!$("#template-comment").length)throw'Mo.core.action.comment -> action-type="quick-reply"，无法调用reply模板，模板名称必须是#template-comment';if(!$("#template-reply").length)throw'Mo.core.action.comment -> action-type="quick-reply"，无法调用item模板，模板名称必须是#template-reply';var u=a.parentsUntil("[role=item-comment]").last().parent(),h=a.parentsUntil("[role=data-comment]").last().parent(),f=$(Mustache.to_html($("#template-comment").html(),{replyId:s,feedId:n.feedId,typeId:n.typeId,eventId:n.eventId})).hide();c=f,o=c.find("a[role=submit]"),u.append(f),i.bind(f,function(t){if(o.attr("data-ajax-status","done").html("回应"),c.find("textarea[role=input-comment]").val("").removeClass("M-textarea-disabled").removeAttr("disabled"),t.code||t.message)"error"==t.code&&Mo.ui.info(a,"发送失败","mo-ui-info-warning");else{var e=$(Mustache.to_html($("#template-reply").html(),{data:t}));"bottom"==l?h.find("[role=item-comment]:last").after(e):(e.hide(),h.find("[role=item-comment]:first").before(e),e.slideDown())}d()}),a.data("comment-form",f),t()}})},bind:function(a,o,n){function s(){var e=$.trim(d.val()),o=a.data("feed-id"),s=a.data("feed-type"),r=a.data("event-id")||0,l=a.attr("data-reply-id")||0;return"processing"!=d.attr("data-ajax-status")&&(""==e?(d.focus(),!1):void("ajax"==y?i.isAllowReply(x,o,s,function(){x.html(t.ui.ico.loading+t.ui.ico.sp+"稍等"),d.addClass("M-textarea-disabled").attr("disabled","disabled"),i.send(o,s,r,l,p,e,f.is(":checked"),h.is(":checked"),C,n)}):c.submit()))}if(!a.data("binded")){var r,l,c=a.find("form[role=form-comment]"),d=c.find("textarea[role=input-comment]"),u=$(a.data("use-template")),h=c.find("input[name=replyOriginal]"),f=c.find("input[name=forwardMyComment]"),m=a.data("reply-name"),p=a.data("comment-type")||"people",g=c.find("a[role=emotion]"),y=c.data("submit-type")||"ajax",v=c.find("a[role=uploadImageBtn]"),b=c.find("div[role=showUploadImage]"),w=c.find("input[name=imageTempFile]"),x=c.find("a[role=submit], input[role=submit]");if(a.data("old-reply-id",a.data("reply-id")||0),c.length){if(a.data("binded",!0),a.data("feed-type")&&a.data("feed-id")&&c.length&&!/52|51/.test(a.data("feed-type").toString())&&i.allowReply(_config,a.data("feed-type"),a.data("feed-id"),function(t,e){t||c.hide().after('<div class="allow-reply">'+e+"</div>")}),c.data("commentFormBind"))return!1;c.data("commentFormBind",!0),a.attr("role","data-comment"),u=u.length?u.html():['<div role="item-comment" class="txtbox-cc-items item-comment">','<a href="{{data.userVO.url}}">{{data.userVO.name}}：</a>{{{data.summary}}}<span class="time">({{data.showTime}})</span>','<p class="ar ctl">','<a href="javascript:;" class="action-report color-999" action-type="report" action-params=\'{"objectId":"{{data.id}}","objectType":"7"}\'>举报</a>&nbsp;&nbsp;&nbsp;','<a class="delete" href="javascript:;" action-type="comment" control-type="del" data-comment-id="{{data.id}}">删除</a>',"</p>","</div>"].join("");var M=function(t,e){if(e=e||"prepend",t){d.val("").removeClass("M-textarea-disabled").removeAttr("disabled").focus(),x.attr("data-ajax-status","done").html("回应");var i=$(Mustache.to_html(u,{data:t})).hide();a.find("[role=list-comment]")[e](i),i.slideDown("fast"),a.find(".txtbox-no-comment").hide(),a.attr("data-reply-id",a.data("old-reply-id")),h.removeAttr("checked"),f.removeAttr("checked")}},C=o?function(t){o(t,M)}:M;if(n=n||function(){x.attr("data-ajax-status","done").html("回应"),Mo.ui.info(x,"系统错误，请稍后再试","mo-ui-info-warning")},m){var k="回复@"+m+":";d.val(k),setTimeout(function(){e.setCursor(d[0],k.length,0)},1)}v.length&&w.length&&(b.length&&(r=b.find("img"),l=b.find("a.del-img"),l.click(function(){r.attr("src",""),w.val(""),b.hide()})),Mo.utils.upload({handle:v,append:v,name:"uploadfile",url:"/ajax/icon/twitter/upload",onError:function(){Mo.ui.info(thisFlyout._currentAnchor,"图片格式只能是jpg、jpeg、gif、png","mo-ui-info-warning")},onSubmit:function(){v.toggleClass("uploadimgIco loadIco")},onComplete:function(t,e){v.toggleClass("uploadimgIco loadIco").data("hasResource",e);var i=e.indexOf("<");-1!=i&&(e=e.substring(0,i)),w.val(e),b.length&&(b.show(),r.attr("src",e))}})),x.click(function(){return s(),!1}),d.elastic().keyup(function(t){""==$.trim(d.val())&&a.attr("data-reply-id",a.data("old-reply-id")),(t.ctrlKey&&13==t.which||10==t.which)&&s()}),t.ui.at&&t.ui.at(d),g.click(function(){return t.ui.emotion(g,d),!1})}}},status:function(t){return"processing"!=t.attr("data-ajax-status")}};return $(function(){var t=$(".focus-comment textarea");$(".focus-to-comment").click(function(){return t.focus(),!1})}),function(){if(this.jquery){var t=this.attr("control-type");
switch(t){case"get":if(i.status(this)&&null==this.data("comment")){if(!Motie.CheckLogin(!0))return;i.show(this)}else i.hide(this);break;case"quick-reply":i.quick(this);break;case"reply":i.reply(this);break;case"del":i.status(this)&&i.del(this)}}return i}}),Mo.register("core.action.forward",function(t){var e=!1,i=t.ui.ico,a=t.core.action.comment(),o={dialog:null,validate:function(t,e,i){return Motie.limitTextarea(t,140,e,!0)?(e.hasClass("text-wrong")&&e.removeClass("text-wrong"),i.hasClass("M-button-disabled")&&i.removeClass("M-button-disabled"),!0):(!e.hasClass("text-wrong")&&e.addClass("text-wrong"),!i.hasClass("M-button-disabled")&&i.addClass("M-button-disabled"),!1)},get:function(a,n,s,r){o.dialog=new t.openAjaxDialog({url:"/ajax/object/"+s+"/"+n,layerId:"twitterDiv",effectHide:"fade",hideDuration:200,width:550,onHide:function(e){o.dialog=null,t.ui.emotion().hide(),e.posting=!1},onload:function(l){function c(){var c=$.trim(u.val()),h="",f=t.core.action.forward,p=$.noop,g=a.find(".num");return!(e||m.hasClass("M-button-disabled")||c.length>140)&&(e=!0,m.html(i.loading+i.sp+"转发中"),void o.send(n,s,r,c,function(t){if(e=!1,h=a.attr("data-custom-success")){if(!f[h])throw'自定义方法不存在：data-custom-success="'+h+'"没有注册到mo.core.action.forward';p=f[h]}g.length&&g.text(parseInt(g.text())+1),m.addClass("M-button-green").html(i.check+i.sp+"转发成功！"),$("input[name='twitterPage']").val()&&(location.href=location.href),p(t,d),setTimeout(function(){l.hideLayer()},500)},function(){setTimeout(function(){l.hideLayer()},500)}))}var d=l.layer,u=d.find("textarea"),h=d.find(".status"),f=d.find("a[role=emotion]"),m=d.find("a[role=submit]");return d.find("#loginForm").length?(_config=0,l.layer.remove(),void Mo.CheckLogin(!0)):(m.click(function(){return c(),!1}),u.keyup(function(){o.validate(u,h,m)}).trigger("keyup"),t.ui.at&&t.ui.at(u),f.click(function(){return t.ui.emotion(f,u,function(){o.validate(u,h,m)}),!1}),Motie.TextareaUtils.setCursor(u[0],0,0),void u.keypress(function(t){(t.ctrlKey&&13==t.which||10==t.which)&&c()}))}}),o.dialog.render()},send:function(t,e,i,a,n,s){var r=o.dialog.layer,l=r.find("input[name=specialUrl]").val()||"/ajax/twitter/$1/$2/rt";$.ajax({url:Motie.ProcessUrl(l,[t,e]),cache:!1,type:"post",data:{content:a},success:function(t){n(t)},timeout:1e4,error:function(t,e,i){s(t,e,i)}})}};return function(){if(Motie.CheckLogin(!0)){var e=this,i=t.utils.getFeedData(e);null===o.dialog&&a.allowReply(_config,i.typeId,i.feedId,function(a,n){return a?void o.get(e,i.feedId,i.typeId,i.eventId):void t.ui.info(e,n,"mo-ui-info-warning")})}}}),function(){Mo.register("core.action.twitter",function(t){var e={del:function(e){"processing"!=e.attr("data-ajax-stauts")&&t.ui.confirm(e,function(e){e.attr("data-ajax-status","processing").html(t.ui.ico.loading+"删除中..");var i=t.utils.getFeedData(e),a=e.parentsUntil("div.txtbox-item").last().parent();$.ajax({url:"/ajax/object/del",type:"post",data:{id:i.feedId,type:i.typeId},success:function(t){t&&(e.attr("data-ajax-status","done").html("已删除"),!a.prev().length&&a.next().addClass("txtbox-item-first"),a.slideUp("fast",function(){$(this).remove()}))}})})}};return function(){if(this.jquery){var t=this.attr("control-type");"del"==t&&e.del(this)}return e}})}(),Mo.register("core.action.favorite",function(t){var e=Mo.core.ajaxStatus,i={set:function(a,o,n,s){if(a.length){var r=a.find(".num"),l=a.attr("data-custom-success"),c=a.find("img[role=status]"),d=t.utils.getFeedData(a);null!==d&&(o=d.feedId,n=d.typeId)}i.send("/ajax/favorite/"+o+"/"+n+"/set",a,s||function(i){e.done(a),i.succ?a.attr("title","取消喜欢").addClass("favorited"):a.attr("title","喜欢").removeClass("favorited"),r.length&&r.text(i.favor),c.length&&c.toggleClass("ico-heart-grey ico-heart-red"),t.ui.info(a,i.succ?"设置喜欢成功":"已取消喜欢","mo-ui-info-ok"),l&&t.core.action.favorite[l]&&t.core.action.favorite[l](a,i)})},send:function(t,e,i){$.ajax({url:t,cache:!1,success:function(t){i(t)}})}};return function(a){if(this.jquery){if(!Motie.CheckLogin(!0))return!1;var o=this;if(this.find(".num"),o.attr("data-custom-success"),this.find("img[role=status]"),t.utils.getFeedData(o),e.inProcess(o))return;e.processing(o),i.set(o)}return i}}),Mo.register("core.action.owner",function(t){var e={2:"作品",19:"小组",6:"评论",26:"小站",29:"小站"},i={layer:null,createReason:function(t){for(var i=["含有广告或垃圾信息","含有色情、淫秽或低俗内容","含有激进时政或意识形态话题","含有人身攻击或者恶意言论","违反"+e[t]+"发言规则","与"+e[t]+"主题无关"],a=[],o=0,n=i.length;o<n;o++)a.push('<label><input type="radio" class="radio" name="rs" /> '+i[o]+"</label><br />");return a.join("")},deleteReason:function(e){var o=e.parentsUntil("[role=item-comment]").parent(),n=e.attr("role"),s=e.attr("data-node-id"),r=e.attr("data-feed-type"),l=e.attr("data-action-url");new Mo.layer({width:500,layerId:"deleteReason",destroy:!0,data:{action:l,nodeId:s,html:a.reason,reason:i.createReason(r),title:"6"==r?"屏蔽":"删除"},onRendered:function(e){var i=e.layer,a=i.find("form"),s=$("#id7"),r=i.find("textarea"),l=i.find("input[name=reason]"),c=i.find("a[role=submit]"),d=i.find("a[role=close]");s.click(function(){r.focus()});var u=i.find(".radio:lt(6)").click(function(){$("#reason-message").empty()});r.click(function(){s.attr("checked","checked")}),c.click(function(){return a.submit(),!1}),d.click(function(){return e.hideLayer(),!1}),a.validate({submitHandler:function(i){var a=!1;u.each(function(t){if(this.checked)return l.val($.trim($(this).parent().text())),a=!0,!1}),!a&&s.is(":checked")&&l.val($.trim(r.val())),"processing"!=c.attr("data-ajax-status")&&(c.attr("data-ajax-status","processing"),c.html(t.ui.ico.loading+t.ui.ico.sp+"稍等.."),$(i).ajaxSubmit({success:function(i){c.attr("data-ajax-status","done"),c.addClass("M-button-green").html(t.ui.ico.check+t.ui.ico.sp+"提交成功"),n?(e.hideLayer(),o.slideUp(function(){o.remove()})):""!=$.trim(i)&&(window.location.href=i)}}))},rules:{rs:{minlength:1,required:!0},text:{required:"#id7:checked"}},messages:{rs:{required:"至少选一项"},reason:{required:"理由不能为空！"}},errorClass:"is-error",errorPlacement:function(t,e){$("#reason-message").html(t)}})}}).render()}},a={reason:'<a class="fr pop-close" href="javascript:;"></a><h3>{{title}}理由</h3><div class="sp-20"></div><form action="{{action}}" method="post"><div style="line-height:2em;">{{{reason}}}</div><input type="hidden" name="replyId" value="{{nodeId}}" /><input type="hidden" name="reason" /><div class="sp-20"></div><label for="id7"><input type="radio" class="radio" name="rs" id="id7" />其他原因 (填写框）</label><div class="sp-10"></div><textarea name="text" style="width: 100%; height: 150px; padding: 0;" class="textarea-single" name="reasontext"></textarea><div class="sp-10"></div><p id="reason-message"></p><div class="sp-10"></div><p class="ar"><a href="javascript:;" role="submit" class="M-button-s">确定</a> <a href="javascript:;" role="close" class="M-button-s M-button-grey">取消</a></p></form>'};return function(t){return i.deleteReason(this),!1}}),Mo.register("core.collect",function(){return function(t){$(t||"body").delegate("[data-collect-id]","click",function(t){var e=$(this),i=$(t.target),a=e.data("collect-id"),o=i.data("collect-index")||i.parent().data("collect-index");if(o){var n=new Image;n.src="http://click.motieimg.com/m.gif?id="+a+"&index="+o+"&_="+Math.ceil(1e5*Math.random());var s=i.is("a")?i:i.parent();if(s.is("a")&&"_blank"!=s.attr("target"))return setTimeout(function(){window.location.href=s.attr("href")},20),!1}})}});