define(["components/dialog","service/bookDetailService","components/loading","components/overlay","components/resultTipDialog","core"],function(t,e,i,c,s,n){var r=new t({template:"#template-buy-dialog",data:{selectedIndex:0,selectedChapters:20,btnList:[{text:"后20章",discount:"九折",active:!1,costPrice:0,discountPrice:0},{text:"后50章",discount:"八折",active:!1,costPrice:0,discountPrice:0},{text:"后100章",discount:"七折",active:!1,costPrice:0,discountPrice:0},{text:"后200章",discount:"六折",active:!1,costPrice:0,discountPrice:0}],isActive:!1,balancePrice:"",redPacket:"",costPrice:0,discountPrice:0,buyVoid:!0,isGetPrice:!1,unBuyCount:0,buyText:"确认购买",buyFlag:!1},computed:{buyVoid:function(){return!(this.balancePrice&&0!=this.balancePrice&&this.balancePrice>=this.discountPrice&&this.unBuyCount>=this.selectedChapters)&&!(this.redPacket&&0!=this.redPacket&&this.redPacket>=this.costPrice&&this.unBuyCount>=this.selectedChapters)}},events:{show:function(){var t=this;this.buyFlag||(this.buyFlag=!0,void 0!=this.balancePrice&&""!==this.balancePrice||e.getDiscount(t.currentChapter).then(function(e){switch(e.status){case 0:var i=e.result.discount;t.isGetPrice=!0,t.balancePrice=e.result.balances,t.redPacket=e.result.ticket,$.each(i,function(e,i){t.btnList[e].costPrice=i[0],t.btnList[e].discountPrice=i[1]});var c=t.selectedIndex;t.costPrice=t.btnList[c].costPrice,t.discountPrice=t.btnList[c].discountPrice,t.unBuyCount=e.result.unBuyCount,t.$emit("changeBuyText"),t.buyFlag=!1;break;case 1:location.href=e.url;break;case-1:alert("啊哦,出错了");break;default:alert("啊哦,出错了")}}))},changeBuyText:function(){this.balancePrice<this.discountPrice&&this.redPacket<this.costPrice&&(this.buyText="余额不足"),(this.balancePrice>=this.discountPrice||this.redPacket>=this.costPrice)&&(this.buyText="确认购买"),this.unBuyCount<this.selectedChapters?this.buyText="剩余章节不足":this.buyText="确认购买"}},methods:{hideDialog:function(){this.hide()},purchase:function(t){var r=this,a=this.currentChapter;i.show(),c.isZindex=!0,e.purchaseChapter(t,a,r.isAutoSub).then(function(t){switch(i.hide(),r.hideDialog(),c.isZindex=!1,t.status){case 1:location.href=n.wap_DOMAIN+t.url;break;case-1:s.show(),s.setContent("抱歉,购买失败,请重新购买!",!1),setTimeout(function(){location.reload()},1e3);break;default:alert("啊哦,出错了")}})},select:function(t){switch(this.selectedIndex=t,t){case 0:this.selectedChapters=20;break;case 1:this.selectedChapters=50;break;case 2:this.selectedChapters=100;break;case 3:this.selectedChapters=200;break;default:this.selectedChapters=20}this.costPrice=this.btnList[t].costPrice,this.discountPrice=this.btnList[t].discountPrice,this.$emit("changeBuyText")},isCheck:function(t){return t==this.selectedIndex},isVoid:function(t){}}});return function(t,e){return r.currentChapter=t,r.autoSub=e||!1,r}});
//# sourceMappingURL=../../maps/wxV2/components/purchaseDialog.js.map
