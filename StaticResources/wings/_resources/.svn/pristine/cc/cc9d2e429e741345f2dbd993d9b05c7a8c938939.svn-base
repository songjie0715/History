"use strict";$.fn.extend({popOver:function(t){function e(t){var e=h.innerHeight(),o=(h.innerWidth(),t.offset().top,t.offset().left),s=0,n=0,i=$(window).height();"up"==r.direction&&(s=i-t.innerHeight()-e-30,h.addClass("up"),n=o),"down"==r.direction&&(h.addClass("down"),n=o),a.addClass("show")}var a=$(this),o=$(this).data("prop"),s=$("#"+o),n=$(this).attr("showPop");if("true"===n)return s.hide(),a.removeClass("showPop"),$(this).attr("showPop","false"),void $(this).removeClass("chapterFontSize-on");if("false"===n)return s.show(),a.addClass("showPop"),$(this).attr("showPop","true"),void $(this).addClass("chapterFontSize-on");var i={tpl:"<a>哈哈,我是popOver</a>",layout:'<div class="popOver" data-show=true></div>',direction:"up"},r=$.extend(i,t),u=$(this).data("prop"),c=$(r.tpl),h=$(r.layout);h.attr("id",u),h.append(c),a.append(h),e(a),h.show(),h.on("touchend",function(t){t.preventDefault(),t.stopPropagation()}),$(this).attr("showPop",!0)}}),$.fn.scrollEnd=function(t,e){$(this).scroll(function(){var a=$(this);a.data("scrollTimeout")&&clearTimeout(a.data("scrollTimeout")),a.data("scrollTimeout",setTimeout(t,e))})},$(function(){function t(t){var e=t.data("show");e?($(".popOver").hide(),u.removeClass("show").hide(),c.removeClass("show").hide(),p.removeClass("showPop"),d.removeClass("showPop"),$("#chapterFontSize").attr("showPop",!1),c.find("li").removeClass("chapterFontSize-on"),t.data("show",!1),$("#chapterFontSize, #chapterAutoBuy").data("show",!1)):(u.addClass("show").show(),c.addClass("show").show(),t.data("show",!0))}function e(){function e(e){var e=e||window.event,h=new Date;switch(e.type){case"touchstart":var l=$(e.target.parentNode);if(!l.hasClass("intro"))return;a=e.touches[0].clientX,o=e.touches[0].clientY;var m=h.getTime(),f=m-i;f<300&&f>0&&(clearTimeout(r),$(document).data("show")&&($(".popOver").hide(),u.removeClass("show").hide(),c.removeClass("show").hide(),p.removeClass("showPop"),d.removeClass("showPop"),c.find("li").removeClass("chapterFontSize-on"),$(document).data("show",!1),$("#chapterFontSize").data("show","no"),$("#chapterAutoBuy").data("show","no")),e.preventDefault()),i=m;break;case"touchend":s=e.changedTouches[0].clientX,n=e.changedTouches[0].clientY,s==a&&n==o?r=setTimeout(function(){t($(document))},300):$(document).data("show")&&t($(document));break;case"touchmove":$(document).data("show")&&e.preventDefault()}}document.addEventListener("touchstart",e,!1),document.addEventListener("touchmove",e,!1),document.addEventListener("touchend",e,!1)}$("#fontBulb").on("touchend",function(t){var e=$(this),a=$(".wrapper"),o=e.find("img"),s=e.find("span"),n=$(".fontBulb"),i=n.find("img"),r=$(".fontSizePlus img"),u=$(".fontSizeMinus img");e.data("status")?(localStorage.setItem("readStatus","day"),$.cookie("fontBulb"," ",{path:"/",expires:7}),a.removeClass("night-status").addClass("day-status"),o.attr("src",window.GLOBAL_PATH+"/_resources/img/wx/laikan/chapter-menu_status.png"),i.attr("src",GLOBAL_PATH+"/_resources/img/wx/laikan/chapter_day_ico.png"),r.attr("src",GLOBAL_PATH+"/_resources/img/wx/laikan/chapter_day_aplus_ico.png"),u.attr("src",GLOBAL_PATH+"/_resources/img/wx/laikan/chapter_day_asub_ico.png"),s.html("白天"),e.data("status",!1),n.data("status",!1),t.stopPropagation(),t.preventDefault()):(localStorage.setItem("readStatus","night"),$.cookie("fontBulb","changBg",{path:"/",expires:7}),a.removeClass("day-status").addClass("night-status"),o.attr("src",window.GLOBAL_PATH+"/_resources/img/wx/laikan/chapter-menu_status-on-new.png"),i.attr("src",GLOBAL_PATH+"/_resources/img/mobile/chapter_nightn_ico.png"),r.attr("src",GLOBAL_PATH+"/_resources/img/mobile/chapter_night_aplus_ico.png"),u.attr("src",GLOBAL_PATH+"/_resources/img/mobile/chapter_night_asub_ico.png"),s.html("黑夜"),e.data("status",!0),n.data("status",!0),t.stopPropagation(),t.preventDefault())}),$(".fontBulb").on("touchend",function(t){var e=$(this),a=e.find("img"),o=e.closest(".font-change"),s=o.find(".fontSizePlus img"),n=o.find(".fontSizeMinus img"),i=$("#fontBulb"),r=i.find("img"),u=i.find("span"),c=$(".wrapper");e.data("status")?(c.removeClass("night-status").addClass("day-status"),a.attr("src",GLOBAL_PATH+"/_resources/img/wx/laikan/chapter_day_ico.png"),s.attr("src",GLOBAL_PATH+"/_resources/img/wx/laikan/chapter_day_aplus_ico.png"),n.attr("src",GLOBAL_PATH+"/_resources/img/wx/laikan/chapter_day_asub_ico.png"),r.attr("src",GLOBAL_PATH+"/_resources/img/wx/laikan/chapter-menu_status.png"),u.html("白天"),e.data("status",!1),i.data("status",!1),localStorage.setItem("readStatus","day"),$.cookie("fontBulb"," ",{path:"/",expires:7}),t.stopPropagation(),t.preventDefault()):(c.removeClass("day-status").addClass("night-status"),a.attr("src",GLOBAL_PATH+"/_resources/img/mobile/chapter_nightn_ico.png"),s.attr("src",GLOBAL_PATH+"/_resources/img/mobile/chapter_night_aplus_ico.png"),n.attr("src",GLOBAL_PATH+"/_resources/img/mobile/chapter_night_asub_ico.png"),r.attr("src",GLOBAL_PATH+"/_resources/img/wx/laikan/chapter-menu_status-on-new.png"),u.html("黑夜"),e.data("status",!0),i.data("status",!0),localStorage.setItem("readStatus","night"),$.cookie("fontBulb","changBg",{path:"/",expires:7}),e.data("status",!0),t.stopPropagation(),t.preventDefault())});var a,o,s,n,i,r,u=$(".chapter-menu-top"),c=$(".chapter-menu-bottom"),h=$(".chapter-menu-top, .chapter-menu-bottom"),p=($(window).height(),c.find("#chapterFontSize")),d=u.find("#chapterAutoBuy");window.addEventListener("load",e,!1),$(".chapter-menu a").on("touchend",function(t){var e=$(this);location.href=e.attr("href"),t.preventDefault()}),h.on("touchend",function(t){t.stopPropagation(),t.preventDefault()}),$(".chapter-menu .status").on("touchend",function(t){var e=$(this),a=e.data("status");_hmt.push(["_trackEvent","menu","menu_"+a,bookId+"/"+chapterId]),t.preventDefault()});var l=1.2,m=2.8,f=$(".intro"),g=$.cookie("fontSize"),v=1.6;g&&(g=Number(g),v=g,$(".intro").css({"font-size":g+"rem","line-height":1.8*g+"rem"})),$("#chapterFontSize").on("touchend",function(t){var e=$(this);e.addClass("chapterFontSize-on"),e.addClass("showPop"),e.popOver({tpl:$("#template-dialog-font").html(),direction:"up"}),$(".fontSizePlus, .fontSizeMinus").unbind("touchend"),$(".fontSizePlus").on("touchend",function(t){v<=m&&(v+=.2,f.css({fontSize:v+"rem","line-height":1.8*v+"rem"}),$.cookie("fontSize",v,{path:"/",expires:7})),t.preventDefault(),t.stopPropagation()}),$(".fontSizeMinus").on("touchend",function(t){v>=l&&(v-=.2,f.css({fontSize:v+"rem","line-height":1.8*v+"rem"}),$.cookie("fontSize",v,{path:"/",expires:7})),t.preventDefault(),t.stopPropagation()}),t.preventDefault(),t.stopPropagation()}),$(".fontSizePlus").on("touchend",function(t){v<=m&&(v+=.2,f.css({fontSize:v+"rem","line-height":1.8*v+"rem"}),$.cookie("fontSize",v,{path:"/",expires:7})),t.preventDefault(),t.stopPropagation()}),$(".fontSizeMinus").on("touchend",function(t){v>=l&&(v-=.2,f.css({fontSize:v+"rem","line-height":1.8*v+"rem"}),$.cookie("fontSize",v,{path:"/",expires:7})),t.preventDefault(),t.stopPropagation()}),$("#chapterAutoBuy").on("touchend",function(t){var e=$(this);e.addClass("showPop"),e.popOver({tpl:$("#template-dialog-buy").html(),direction:"down"}),$(".chapterAuto").on("touchend",function(t){var e=$(this),a=e.find('input[name="bookId"]').val();$.ajax({type:"POST",url:"/ajax/i/autofeed",data:{bookId:a,backUrl:"/book/"+a+"/"+window.chapterId},dataType:"json",success:function(t){return 1==t.status?void(location.href=t.url):void(0==t.status&&(e.data("auto")?(e.removeClass("on"),e.data("auto",!1)):(e.addClass("on"),e.data("auto",!0))))}}),t.stopPropagation(),t.preventDefault()}),t.stopPropagation(),t.preventDefault()})});
//# sourceMappingURL=../maps/wxV2/popOver.js.map
