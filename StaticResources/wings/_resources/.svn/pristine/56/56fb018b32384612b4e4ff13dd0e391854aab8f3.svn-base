define(["jquery","components/dialog","service/bookDetailService","components/loading","components/overlay","components/resultTipDialog","core"],function(e,t,i,c,s,n,a){var r=new t({template:"#template-buy-dialog",data:{selectedIndex:0,selectedChapters:20,btnList:[{text:"后20章",discount:"九折",active:!1,costPrice:0,discountPrice:0},{text:"后50章",discount:"八折",active:!1,costPrice:0,discountPrice:0},{text:"后100章",discount:"七折",active:!1,costPrice:0,discountPrice:0},{text:"后200章",discount:"六折",active:!1,costPrice:0,discountPrice:0}],isActive:!1,balancePrice:"",costPrice:0,discountPrice:0,buyVoid:!0,isGetPrice:!1,unBuyCount:0,buyText:"确认购买",buyFlag:!1},computed:{buyVoid:function(){return!(this.balancePrice&&0!=this.balancePrice&&this.balancePrice>=this.discountPrice&&this.unBuyCount>=this.selectedChapters)}},events:{show:function(){var t=this;this.buyFlag||(this.buyFlag=!0,void 0!=this.balancePrice&&""!==this.balancePrice||i.getDiscount(t.currentChapter).then(function(i){switch(i.status){case 0:var c=i.result.discount;t.isGetPrice=!0,t.balancePrice=i.result.balances,e.each(c,function(e,i){t.btnList[e].costPrice=i[0],t.btnList[e].discountPrice=i[1]});var s=t.selectedIndex;t.costPrice=t.btnList[s].costPrice,t.discountPrice=t.btnList[s].discountPrice,t.unBuyCount=i.result.unBuyCount,t.$emit("changeBuyText"),t.buyFlag=!1;break;case 1:location.href=i.url;break;case-1:alert("啊哦,出错了");break;default:alert("啊哦,出错了")}}))},changeBuyText:function(){return this.balancePrice<this.discountPrice?void(this.buyText="余额不足"):void(this.unBuyCount<this.selectedChapters?this.buyText="剩余章节不足":this.buyText="确认购买")}},methods:{hideDialog:function(){this.hide()},purchase:function(e){var t=this,r=this.currentChapter;c.show(),s.isZindex=!0,i.purchaseChapter(e,r,t.isAutoSub).then(function(e){switch(c.hide(),t.hideDialog(),s.isZindex=!1,e.status){case 1:location.href=a.wap_DOMAIN+e.url;break;case-1:n.show(),n.setContent("抱歉,购买失败,请重新购买!",!1),setTimeout(function(){location.reload()},1e3);break;default:alert("啊哦,出错了")}})},select:function(e){switch(this.selectedIndex=e,e){case 0:this.selectedChapters=20;break;case 1:this.selectedChapters=50;break;case 2:this.selectedChapters=100;break;case 3:this.selectedChapters=200;break;default:this.selectedChapters=20}this.costPrice=this.btnList[e].costPrice,this.discountPrice=this.btnList[e].discountPrice,this.$emit("changeBuyText")},isCheck:function(e){return e==this.selectedIndex},isVoid:function(e){}}});return function(e,t){return r.currentChapter=e,r.autoSub=t||!1,r}});
//# sourceMappingURL=../../maps/wx/components/purchaseDialog.js.map
