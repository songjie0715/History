//mo.core
var ImgMotie="",MotieHost="",$IE=$.browser.msie,$win=$(window),$html=$("html"),$IE6=$IE&&$.browser.version=="6.0",$IE7=$IE&&$.browser.version=="7.0",$IE8=$IE&&$.browser.version=="8.0",proxy={$:$},$OLDIE=$IE6||$IE7||$IE8;$.fn.xresize=function(fn,type,before){var timer,isEnd=false,before=before||$.noop;type=type||"scroll resize";return this.bind(type,function(e){var t=this;if(timer){clearTimeout(timer);timer=null}if(isEnd==false){isEnd=true;before.call(t,e)}timer=setTimeout(function(){isEnd=false;fn.call(t,e)},100)})};
/*!
 * jQuery Cookie Plugin v1.3.1
 * https://github.com/carhartl/jquery-cookie
 *
 * Copyright 2013 Klaus Hartl
 * Released under the MIT license
 */
(function(factory){if(typeof define==="function"&&define.amd){define(["jquery"],factory)}else{factory(jQuery)}}(function($){var pluses=/\+/g;function raw(s){return s}function decoded(s){return decodeURIComponent(s.replace(pluses," "))}function converted(s){if(s.indexOf('"')===0){s=s.slice(1,-1).replace(/\\"/g,'"').replace(/\\\\/g,"\\")}try{return config.json?JSON.parse(s):s}catch(er){}}var config=$.cookie=function(key,value,options){if(value!==undefined){options=$.extend({},config.defaults,options);if(typeof options.expires==="number"){var days=options.expires,t=options.expires=new Date();t.setDate(t.getDate()+days)}value=config.json?JSON.stringify(value):String(value);return(document.cookie=[encodeURIComponent(key),"=",config.raw?value:encodeURIComponent(value),options.expires?"; expires="+options.expires.toUTCString():"",options.path?"; path="+options.path:"",options.domain?"; domain="+options.domain:"",options.secure?"; secure":""].join(""))}var decode=config.raw?raw:decoded;var cookies=document.cookie.split("; ");var result=key?undefined:{};for(var i=0,l=cookies.length;i<l;i++){var parts=cookies[i].split("=");var name=decode(parts.shift());var cookie=decode(parts.join("="));if(key&&key===name){result=converted(cookie);break}if(!key){result[name]=converted(cookie)}}return result};config.defaults={};$.removeCookie=function(key,options){if($.cookie(key)!==undefined){$.cookie(key,"",$.extend(options,{expires:-1}));return true}return false}}));Date.prototype.format=function(format){var o={"M+":this.getMonth()+1,"d+":this.getDate(),"h+":this.getHours(),"m+":this.getMinutes(),"s+":this.getSeconds(),"q+":Math.floor((this.getMonth()+3)/3),"S":this.getMilliseconds()};if(/(y+)/.test(format)){format=format.replace(RegExp.$1,(this.getFullYear()+"").substr(4-RegExp.$1.length))}for(var k in o){if(new RegExp("("+k+")").test(format)){format=format.replace(RegExp.$1,RegExp.$1.length==1?o[k]:("00"+o[k]).substr((""+o[k]).length))}}return format};Date.prototype.getDiffTime=function(date){if(typeof date==="object"){var diff=this.getTime()-date.getTime();return diff>0?diff:-diff}return 0};Date.prototype.addTime=function(time){this.setTime(this.getTime()+time)};Date.prototype.getShowTime=function(date){var dawn=new Date();dawn.setHours(0);dawn.setMinutes(0);dawn.setSeconds(0);if(this.getTime()>dawn.getTime()){var diffSecond=this.getDiffTime(date)/1000;if(diffSecond<=10){return 10+"秒前"}else{if(diffSecond<=50){return Math.ceil(diffSecond/10)*10+"秒前"}else{if(diffSecond<3600){return Math.ceil(diffSecond/60)+"分钟前"}else{if(diffSecond<60*60*24){return"今天"+this.format("hh:mm")}}}}}};Date.getDate=function(dateString){var strDate=dateString;if(strDate.length==0){return false}var reg=/^(\d{1,4})(-|\/)(\d{1,2})\2(\d{1,2})/;var r=strDate.match(reg);if(r!=null){strDate=strDate+" 00:00:00"}reg=/^(\d{1,4})(-|\/)(\d{1,2})\2(\d{1,2}) (\d{1,2}):(\d{1,2}):(\d{1,2})/;r=strDate.match(reg);if(r==null){console.log("你输入的日期格式有误，正确格式为：2004-12-01 或 2004-12-01 12:23:45");return false}var d=new Date(r[1],r[3]-1,r[4],r[5],r[6],r[7]);if(d.getFullYear()==r[1]&&(d.getMonth()+1)==r[3]&&d.getDate()==r[4]&&d.getHours()==r[5]&&d.getMinutes()==r[6]&&d.getSeconds()==r[7]){return d}else{console.log("你输入的日期或时间超出有效范围，请仔细检查！");return false}};Array.prototype.in_array=function(e){for(i=0;i<this.length;i++){if(this[i]==e){return true}}return false};(function(){Motie=Mo={};$(function(){$body=oBody=$("body");$main=$("#main")});Motie.config={domain:"http://www.motie.com",ImageServer:"http://img.motieimg.com"};ImgMotie=Motie.config.ImageServer;Motie.init={UserMenu:function(){var menu=$("#user-slide-menu"),per=$("#person-status"),hideme=function(){per.removeClass("person-status-active");menu.hide();$(document).unbind("click",hideme)};per.click(function(){menu.width(per.outerWidth());if(!menu.is(":visible")){per.addClass("person-status-active");menu.show();setTimeout(function(){$(document).bind("click",hideme)},100)}else{per.removeClass("person-status-active");menu.hide()}}).hover(function(){per.addClass("person-status-hover")},function(){per.removeClass("person-status-hover")});return this},ReturnTop:function(options){var localTop=$(".mo-ui-top-bar");options=$.extend({where:"body",bottom:localTop.data("ie6-bottom")||36,alwaysShow:localTop.length?!!localTop.data("always-show"):false,html:localTop.length?localTop:'<div class="fixed-rb"><a class="goTop" href="javascript:;" title="返回顶端"></a></div>',onRendered:$.noop});var element=$(options.html),gotop=element.find(".goTop"),height=0,ieScroll=false;if(!$("body").hasClass("no-top")){gotop.click(function(){$win.scrollTop(0)});if($IE6){element.css("bottom","auto")}$(window).xresize(function(){var t=$win.scrollTop(),h=$win.height(),over=0,newHeight=element.height()+options.bottom;if($IE6){if(t>0){over=t+h-newHeight}else{over=h-newHeight}element.show().css("top",over);ieScroll=false}if(t>0||options.alwaysShow){element.show().stop().animate({opacity:"1"},"fast")}else{if(!options.alwaysShow&&t==0){element.stop().animate({opacity:"0"},"fast",function(){element.hide()})}}},"resize.gotop scroll.gotop",function(){if($IE6){element.hide()}});$(options.where).append(element);$win.trigger("scroll.gotop")}return this},RepeatedSubmission:function(){$("form").length&&$("form").each(function(){var $form=$(this).data("submiting",false),btn=$form.find(":submit, :image");$form.submit(function(){if(!$(this).validate){$form.data("submiting",true)}});btn.click(function(){if(!$(this).validate){if($form.data("submiting")===true){return false}}})});return this},HeaderBubble:function(h){if(_config==""){return this}var fixedTop=$(".new_header").length?35:55;var bubble=$(".bubbleFixed"),showed=false,$win=$(window),timer=null,h=h===undefined?fixedTop:h,close=bubble.find(".close-layer"),position=function(){if(showed){if($win.scrollTop()>h){if($IE6){bubble.css("top",$win.scrollTop()+"px")}else{bubble.css("top",0)}}else{bubble.css("top",h+"px")}}else{bubble.css("top","-999999px")}},checkNewestNotice=function(){var layer=$("#layer-remind"),refreshDiv=$("#refreshDiv"),twitterPage=$("#twitter-page"),ul=layer.find("ul"),li=ul.find("li"),html="",sdata=typeof timestamp=="undefined"&&!twitterPage.length?{t:Math.random()}:{timestamp:timestamp,t:Math.random(),currentEventId:twitterPage.find(".mod-all-message .mod-basic-txtbox-layout .txtbox-item:not(.removme):first").data("event-id")};$.getJSON("/ajax/bubble?callback=?",sdata,function(data){if(data==undefined){clearInterval(timer);timer=null;layer.hide();showed=false;return}var noticeCount={follower:0,notice:0,sys_msg:0,msg:0,atme_twitter:0,atme_reply:0,invite_count:0,custom_answer_count:0};data=$.extend({},noticeCount,data);$("#layer-remind li").each(function(){$(this).remove()});var html=[data.follower==0?"":"<li>"+data.follower+"\u4F4D\u65B0\u7C89\u4E1D,<a href='/contact/follower'>\u70B9\u51FB\u67E5\u770B</a></li>",data.notice==0?"":"<li>"+data.notice+"\u6761\u65B0\u63D0\u9192,<a href='/msg/notice'>\u70B9\u51FB\u67E5\u770B</a></li>",data.sys_msg==0?"":"<li>"+data.sys_msg+"\u6761\u65B0\u901A\u77E5,<a href='/msg/system'>\u70B9\u51FB\u67E5\u770B</a></li>",data.msg==0?"":"<li>"+data.msg+"\u6761\u65B0\u79C1\u4FE1,<a href='/msg'>\u70B9\u51FB\u67E5\u770B</a></li>",data.atme_twitter==0?"":"<li>"+data.atme_twitter+"\u6761@\u6211\u7684\u5FAE\u535A,<a href='/msg/atme'>\u70B9\u51FB\u67E5\u770B</a></li>",data.atme_reply==0?"":"<li>"+data.atme_reply+"\u6761@\u6211\u7684\u56DE\u5E94,<a href='/msg/atme/?type=7'>\u70B9\u51FB\u67E5\u770B</a></li>",data.invite_count==0?"":"<li>"+data.invite_count+"条待处理的邀请,<a href='/group/invite/accept'>\u70B9\u51FB\u67E5\u770B</a></li>",data.custom_answer_count==0?"":"<li>"+data.custom_answer_count+"条客服留言,<a href='/msg/kefu'>\u70B9\u51FB\u67E5\u770B</a></li>"].join("");ul.append(html);if(ul.find("li").length){showed=true;layer.show();position()}else{showed=false}if(data.event_count>0){if(window.NEW_TWITTER!=undefined){refreshDiv.is(":hidden")&&$(".mod-update").show()}else{var currentIndex=$(".mod-all-message .mod-tabs li[class=current]").attr("data-index"),href;if(ALL_INDEX!=currentIndex){href="/?index="+ALL_INDEX;refreshDiv.find("a").removeAttr("onclick").attr("href",href)}refreshDiv.is(":hidden")&&$(".mod-update").show()}}})};close.click(function(){showed=false;position();window.clearInterval(timer)});$win.xresize(position);window.setTimeout(checkNewestNotice,3000);timer=window.setInterval(checkNewestNotice,60000);return this},BindNameCard:function(){Motie.nameCard&&Motie.nameCard.bind("body");return this},BindMediaPlayer:function(){Motie.MediaPlayer.bind("body");return this},TextareaAutoHeight:function(){$.fn.elastic&&$("textarea.autoHeight").length&&$("textarea.autoHeight").elastic();return this},LazyLoad:function(){Mo.lazyload({defObj:"#main"});return this},CustomSelect:function(){Motie.customSelect&&$(".custom-select").length&&$(".custom-select").each(function(){if(this.name){new Motie.customSelect(this)}});return this},TextDefaultValue:function(){$.fn.inputDefault&&$("input[placeholder], input[default-value]").each(function(){($.browser.msie||this.placeholder=="")&&$(this).inputDefault()});return this},MedalCard:function(){Motie.medalCard&&$(".mod-author-info .ico-area a.medal[id]").length&&$(".mod-author-info .ico-area a.medal[id]").each(function(){new Motie.medalCard(this)});return this},Search:function(){$(".search-top").length&&Mo.ui.search&&Mo.ui.search(".search-top","/ajax/rest/");return this},CreateMessage:function(){Motie.createMessage&&$(".mod-dk").length&&$(".mod-dk").each(function(index){var $this=$(this),id=this.id,obj;obj=new Motie.createMessage({max:140,ele:this});if(this.id){Motie.createMessage.cache[id]=obj}});return this},bindDelegate:function(){Mo.core.delegate&&Mo.core.delegate();return this},bindCommentSend:function(){Mo.core.action.comment&&$("div[role=data-comment],ul[role=data-comment]").each(function(){$(this).data("comment-init")!=false&&Mo.core.action.comment().bind($(this))});return this},TwoConfirmations:function(){$(".delete").live("click",function(){return confirm("\u786E\u5B9A\u8981\u5220\u9664\u5417\uFF1F")});$(".confim").live("click",function(){var msg=$(this).attr("msg");if(msg==""){msg="确认删除？"}return confirm(msg)});return this},getProxy:function(){proxy.ele=$("#proxy");if(proxy.ele.length){proxy.ele.on("load",function(){proxy.$=proxy.ele[0].contentWindow.$})}return this},InitAll:function(){this.BindNameCard().getProxy().CreateMessage().CustomSelect().HeaderBubble().LazyLoad().MedalCard().ReturnTop().RepeatedSubmission().BindMediaPlayer().TextDefaultValue().bindDelegate().bindCommentSend().Search();$("#bastard").length&&(new Motie.subNav({ele:$("#bastard"),subnav:$("#layer-more")}))}};Motie.error=[];Motie.bindAtTo=function(ele){var tpl='<ul>{{#users}}<li id="{{uid}}">{{{username}}}</li>{{/users}}</ul>';$(ele).textbox({dataUrl:"/ajax/atme/follow/list?callback=?",listTmpl:tpl})};Motie.delay=function(fn,delay){return setTimeout(fn,delay||1)};Motie.register=function(e,c){var g=e.split(".");var f=Motie;var b=Motie.error;var d=null;while(d=g.shift()){if(g.length){if(f[d]===undefined){f[d]={}}f=f[d]}else{if(f[d]===undefined){try{f[d]=c(Motie)}catch(h){b.push(h)}}}}};Motie.CheckLogin=(function(){return function(show,options){options=$.extend({reload:true,onClose:$.noop,onSuccess:$.noop,html:""},options);if(_config==""){if(show){new Mo.openAjaxDialog({destroy:true,width:580,layerClass:"mo-login-dialog",url:"/ajax/login/showLayer",onload:function(_self){var layer=_self.layer,both=layer.find("input[type=email]"),submitBtn=layer.find(".M-button-submit"),form=layer.find("form"),authCode=layer.find(".authCode"),ico=Mo.ui.ico,status=Mo.core.ajaxStatus,codeImg,codet,codechange,chodeInput;function createImage(){var t=Math.ceil(Math.random()*1000000000000);codeImg.attr("src","/ajax/auth/code?t="+t);codet.val(t)}function createCode(){authCode.html(authCode.find("script").html());codeImg=authCode.find("img");codet=authCode.find("input[name=t]");codechange=authCode.find("a");codeInput=authCode.find("input[name=code]");codechange.click(function(){createImage();return false})}if(authCode.data("need-code")){createCode();createImage();$(".itemc label").inFieldLabels();}_self.validate=form.validate({submitHandler:function(xform){$(xform).ajaxSubmit({beforeSubmit:function(){status.processing(submitBtn);submitBtn.addClass("M-button-disabled").html(ico.loading+ico.sp+" 登录中")},success:function(data){status.done(submitBtn);submitBtn.removeClass("M-button-disabled");if(data.code=="success"){submitBtn.addClass("M-button-green").html(ico.loading+ico.sp+" 登录成功");if(options.reload){location.href=location.href}options.onSuccess.call(_self,data,false)}else{if(!layer.find("input[name=code]").length){$(".itemc label").inFieldLabels();createCode()}createImage();submitBtn.html("登录");$(".alert-error-p").addClass("alert-error").html(data.message);options.onSuccess.call(_self,data,true)}}})},rules:{both:{required:true,email:true},password:{required:true},code:{required:!!layer.find("input[name=code]").length}},messages:{both:{required:"",email:""},password:{required:" "},code:{required:" "}},errorPlacement:function(err,ele){ele.parent().parent().parent().append(err)}});both.blur(function(){both.valid()});submitBtn.click(function(){if(status.inProcess(submitBtn)){return}form.submit()})},onHide:function(_self){options.onClose.call(_self)}}).render()}return false}return true}})();Motie.ResponseType=function(str){if(str.substring(0,1)=="{"){return"json"}else{return"html"}};Motie.ResponseCheck=function(data){var params={html:"",refresh:false,success:$.noop,error:$.noop};$.extend(params,data);var html=$.trim(params.html),code=false,msg,data,type=Motie.ResponseType(html);if(type=="json"){data=eval("("+html+")");msg=data.message;code=data.code}if(type=="html"||code=="ok"||params.html===true){params.success(html)}else{if(type=="json"||params.html===false){if(code=="refresh"||code=="error"){new Mo.alert({type:"error","data":{html:msg},onRendered:function(that){params.error(code,msg,that);if(params.refresh){setTimeout(function(){that.change({type:"loading",html:msg})},2000)}setTimeout(function(){that.hideLayer()},3000)}}).render()}}}};var layerClass=Base.extend({constructor:function(params){var defaults={handle:"",closeHandle:"",destroy:true,renderShow:true,onRender:$.noop,onRendered:$.noop,onShow:$.noop,onHide:$.noop,tpl:layerClass.tplStore.basicTpl,data:{},layerClass:"",layerId:"",overlay:true,fixed:false,fixCenter:true,eventType:"click",effectShow:false,effectHide:false,effectShowOption:{},effectHideOption:{},effectShowCallback:$.noop,effectHideCallback:$.noop,showDuration:800,hideDuration:800,toggleShow:false,draggable:false,width:"auto",height:"auto",position:"middle",offset:{x:0,y:0},insertType:"append",where:"body",html:"",tplUrl:"",tplData:"",onLoadTpl:$.noop,dataUrl:"",dataData:{},onLoadData:$.noop,partials:null};var _self=this;if(params){$.extend(defaults,params)}this.defaults=defaults;this.rendered=false;this.onShow=defaults.onShow;this.onHide=defaults.onHide;this.onRender=defaults.onRender;this.onRendered=defaults.onRendered;this.handle=defaults.handle.jquery?defaults.handle:$(defaults.handle);this.layer={};this.handle.live(defaults.eventType,function(e){_self.bindHandle(_self,e)})},bindHandle:function(_self,e){var defaults=_self.defaults;if(defaults.toggleShow){if(_self.layer.showed){_self.hideLayer(_self)}else{_self.render()}}else{_self.render()}return false},position:function(pams){var _self=this,o=_self.defaults,layer=_self.layer,handle=_self.handle,pos,k={p:o.position,o:o.offset};if(pams){$.extend(k,pams)}if(k.p===false){return}if(typeof k.p==="string"){switch(k.p){case"middle":pos={left:"50%",marginLeft:-layer.width()/2,top:$win.scrollTop()+($win.height()-layer.height())/2};break;case"handle-lb":pos={left:handle.offset().left+offset.x,top:handle.offset().top+handle.height()+k.o.y};break;case"handle-rb":pos={left:handle.offset().left-layer.width()+handle.width()+k.o.x,top:handle.offset().top+handle.height()+k.o.y};break;case"handle-lt":pos={left:handle.offset().left+k.o.x,top:handle.offset().top-layer.height()+k.o.y};break;case"handle-rt":pos={left:handle.offset().left-layer.width()+handle.width()+k.o.x,top:handle.offset().top-layer.height()+k.o.y};break;case"custom":pos={left:k.o.x,top:k.o.y};break}}else{if(k.p.jquery){pos={left:k.p.offset().left+k.o.x,top:k.p.offset().top+k.p.outerHeight()+k.o.y}}}layer.css(pos);if(o.fixCenter&&layer.isFixed===undefined){if($IE6){$(window).xresize(function(){layer.isFixed=true;_self.position()})}else{layer.css({position:"fixed",top:"50%",marginTop:-layer.height()/2})}}return _self},hideLayer:function(_self){var _self=_self||this,defaults=_self.defaults;var hide=function(){_self.layer.hide();_self.onHide(_self);_self.layer.showed=false;if(defaults.destroy==true){_self.handle.unbind(defaults.eventType,_self.bindHandle);_self.layer.remove();_self.rendered=false;_self.layer={}}if(defaults.overlay){_self.overlay("hide")}};if(_self.rendered&&_self.layer.is(":visible")){if(defaults.effectHide){if(defaults.effectHide=="slideUp"){_self.layer.slideUp(defaults.hideDuration,function(){defaults.effectHideCallback(_self);hide()})}else{_self.layer.hide(defaults.effectHide,defaults.effectHideOption,defaults.hideDuration,function(){defaults.effectHideCallback(_self);hide()})}}else{hide()}}return _self},showLayer:function(_self){var _self=_self||this,lay=_self.layer,defaults=_self.defaults;try{if(!_self.rendered){throw" Mo.layer Error: The Layer has not been rendered! \n\n primaryId:"+layerClass.primaryId}}catch(e){console.log(e);return false}lay.attr({fullWidth:lay.width(),fullHeight:lay.height()});var show=function(){if(defaults.overlay){_self.overlay()}if(defaults.effectShow){if(defaults.effectShow=="slideDown"){_self.layer.slideDown(defaults.showDuration,function(){defaults.effectShowCallback(_self);_self.position();_self.layer.showed=true})}else{_self.layer.show(defaults.effectShow,defaults.effectShowOption,defaults.showDuration,function(){defaults.effectShowCallback(_self);_self.position();_self.layer.showed=true})}}else{lay.css({width:defaults.width,height:defaults.height}).show();_self.onShow(_self);_self.position();_self.layer.showed=true}};show();return _self},basicTpl:"{{{html}}}",render:function(params){var _self=this,defaults=_self.defaults,tmps={tpl:defaults.tpl,html:defaults.html,data:defaults.data,width:defaults.width,onRender:_self.onRender,onRendered:_self.onRendered,partials:defaults.partials};if(params){$.extend(tmps,params)}var render=function(){var renderM=function(d){_self.layer=$(Mustache.to_html(Mustache.to_html(tmps.tpl,d),d,tmps.partials)).css("width",tmps.width).data("layer",_self);_self.data=d;$(defaults.where)[defaults.insertType](_self.layer);_self.rendered=true;tmps.onRendered(_self);if(defaults.layerClass!=""){_self.layer.addClass(defaults.layerClass)}if(defaults.layerId!=""){_self.layer.attr("id",defaults.layerId)}if(defaults.renderShow){_self.showLayer(_self,defaults)}_self.layer.data("primaryId",_self.primaryId=++layerClass.primaryId);if(_self.layer.find("[role=drag-handle]").length){_self.layer.draggable({handle:_self.layer.find("[role=drag-handle]"),containment:"body"})}_self.closeBind()};if(defaults.dataUrl){$.getJSON(defaults.dataUrl,defaults.dataData,function(data){renderM(data);defaults.onLoadData(_self,data)})}else{renderM(tmps.data)}};tmps.onRender(_self);if(!_self.rendered){if(defaults.tplUrl){$.ajax({url:defaults.tplUrl,data:defaults.tplData,cache:false,success:function(html){defaults.tpl=html;defaults.onLoadTpl(_self,html);render()}})}else{render()}}else{_self.showLayer(_self,defaults)}return _self},closeBind:function(){var _self=this,defaults=this.defaults;if(defaults.closeHandle){$(defaults.closeHandle).live("click",function(e){_self.hideLayer(_self);return false})}_self.layer.find(".pop-close").click(function(){_self.hideLayer(_self);return false});return _self},overlay:function(type){var _self=this;if(this.defaults.overlay){overlayer()}if(this.defaults.fixed){}if(type!="hide"){overlayer("show")}else{overlayer("hide")}return _self}},{primaryId:0,tplStore:{basicTpl:'<div defaultTemplate="defaultTemplate" style="display: none; position: absolute;z-index: 500">				<div style="position:relative">					<table style="width: 100%;height: 100%;" class="pop-dialog-table">						<tbody>							<tr>								<td class="pop-tl"></td>								<td class="pop-border"></td>								<td class="pop-tr"></td>							</tr>							<tr>								<td class="pop-border"></td>								<td class="pop-content"><div class="pop-insert-here">{{{html}}}</div></td>								<td class="pop-border"></td>							</tr>							<tr>								<td class="pop-bl"></td>								<td class="pop-border"></td>								<td class="pop-br"></td>							</tr>						</tbody>					</table>				</div>			</div>',SiteBasicTpl:'<div class="popLayerTpl">'+'<div class="hd">					<span title="关闭" class="pop-close-rt pop-close"></span>					<h3>{{{title}}}</h3> 				</div>				<div class="bd configure">					{{{html}}}				</div>			</div>'}});Mo.layer=layerClass;Mo.alert=Mo.layer.extend({constructor:function(params){var defaults={type:"ok",tpl:'<div style="position: absolute; z-index: 500;" class="alert-{{type}} alert">{{{html}}}</div>',data:{html:""},width:200};$.extend(defaults,params);defaults.tpl=defaults.tpl.replace("{{type}}",defaults.type);this.base(defaults)},change:function(params){this.layer.attr("class","alert-"+params.type+" alert").html(params.html)}});var openAjaxDialog=layerClass.extend({constructor:function(params){var defaults={onload:function(){},onerror:function(){},tpl:this.basicTpl};try{if(!params||!$.isPlainObject(params)){throw"Mo.openAjaxDialog Error: params must exists and must be a PlainObject"}}catch(e){console.log(e)}$.extend(defaults,params);this.base(defaults)},basicTpl:'<div defaultTemplate="defaultTemplate" style="display: none; position: absolute; z-index: 100">				<div style="position:relative">					<table style="width: 100%;height: 100%;" class="pop-dialog-table">						<tbody>							<tr>								<td class="pop-tl"></td>								<td class="pop-border"></td>								<td class="pop-tr"></td>							</tr>							<tr>								<td class="pop-border"></td>								<td class="pop-content"><div class="loading-html" style="margin:50px auto 30px auto;width:150px;line-height:30px;"><img alt="loading.." class="vm" src="'+ImgMotie+'/_assets/ajaxLoadingDialog.gif"><span class="vm fz-16" style="margin-left:20px;">\u8F7D\u5165\u4E2D..</span></div><div class="pop-insert-here"></div></td>								<td class="pop-border"></td>							</tr>							<tr>								<td class="pop-bl"></td>								<td class="pop-border"></td>								<td class="pop-br"></td>							</tr>						</tbody>					</table>				</div>			</div>',render:function(){var defaults=this.defaults,_self=this;if(!_self.rendered){_self.layer=$(defaults.tpl).css("width",defaults.width);$(defaults.where)[defaults.insertType](_self.layer);_self.rendered=true;_self.layer.loadingHtml=_self.layer.find(".loading-html");_self.showLayer(_self);if(defaults.draggable){_self.layer.draggable({containment:"body"})}$.ajax({url:defaults.url,cache:false,data:defaults.data,success:function(html){try{if($.trim(html)==""){throw"Mo.openAjaxDialog Error: responseText is empty, check send data or jsp code"}else{_self.layer.loadingHtml.hide();if(defaults.layerClass!=""){_self.layer.addClass(defaults.layerClass)}if(defaults.layerId!=""){_self.layer.attr("id",defaults.layerId)}_self.layer.find(".pop-insert-here").html(html);_self.position();_self.closeBind();defaults.onload(_self)}}catch(e){throw e}},error:function(){_self.layer.find(".pop-insert-here").html('<a href="javascript:;" class="pop-close fr"></a><div class="cl"></div><div style="margin:50px auto 30px auto;width:200px;line-height:30px;"><img src="'+ImgMotie+'/_assets/ErrorIco.gif" class="vm" /><span class="vm fz-16" style="margin-left: 20px;">\u8F7D\u5165\u5931\u8D25:(</span></div>');_self.layer.loadingHtml.hide();_self.closeBind();defaults.onerror(_self)}})}else{_self.showLayer(_self)}return _self}});Mo.openAjaxDialog=openAjaxDialog;var overlayer=(function(){var it,o,h,layer;it={create:function(){layer=$('<div id="overlay"></div>').css({width:"100%"});it.fixed();overlayer.layer=layer;$("body").append(layer);$win.bind("scroll resize",it.fixed)},fixed:function(){var bh=$(document).height();if($win.height()>=bh){h=$win.height()}else{h=bh}layer.css("height",h+"px")},show:function(){it.fixed();layer.show()},hide:function(){layer.hide()},destroy:function(){$win.unbind("scroll resize",it.fixed);layer.remove();layer=null}};return function(type){overlayer.layer===undefined&&it.create();switch(type){case"show":it.show();break;case"hide":it.hide();break;case"destroy":it.destroy();break}}})();Mo.overlayer=overlayer;Motie.tools={RandomCache:function(){return Math.ceil(Math.random()*100000000)},FormatText:function(content){var lines=content.split("(\n\r)|(\n)"),line=null,i=0,allLine=[];for(var len=lines.length;i<len;i++){var line=lines[i];if(line==""){allLine.push("\n\r")}else{allLine.push(replaceSpace(line))}}function replaceSpace(str){var links=str.match(/(<a\b[^>]+>(.*?)<\/a>)/ig),links2=[];str="\u3000\u3000"+str.replace(/[ \u3000\t\r]/g,"").replace(/[\n]+/g,"\r\n\r\n\u3000\u3000");if(links&&links.length){links2=str.match(/(<a[^>]+>(.*?)<\/a>)/ig);for(var i=0,len=links2.length;i<len;i++){str=str.replace(links2[i],links[i])}}return str}return allLine.join("")}};Motie.ProcessUrl=function(url,params){var str=url;for(var i=0,len=params.length;i<len;i++){str=str.replace("$"+(i+1),params[i])}return str};Motie.TextareaUtils=(function(){var it={},ds=document.selection;it.selectionStart=function(oElement){if(!ds){return oElement.selectionStart}var er=ds.createRange(),value,len,s=0;var er1=document.body.createTextRange();er1.moveToElementText(oElement);for(s;er1.compareEndPoints("StartToStart",er)<0;s++){er1.moveStart("character",1)}return s};it.selectionBefore=function(oElement){return oElement.value.slice(0,it.selectionStart(oElement))};it.selectText=function(oElement,nStart,nEnd){oElement.focus();if(!ds){oElement.setSelectionRange(nStart,nEnd);return}var c=oElement.createTextRange();c.collapse(1);c.moveStart("character",nStart);c.moveEnd("character",nEnd-nStart);c.select()};it.insertText=function(oElement,sInsertText,nStart,nLen){oElement.focus();nLen=nLen||0;if(!ds){var text=oElement.value,start=nStart-nLen,end=start+sInsertText.length;oElement.value=text.slice(0,start)+sInsertText+text.slice(nStart,text.length);it.selectText(oElement,end,end);return}var c=ds.createRange();c.moveStart("character",-nLen);c.text=sInsertText};it.getCursorPos=function(obj){if(typeof obj=="undefined"){return}var CaretPos=0;if($IE){obj.focus();var range=null;range=ds.createRange();var stored_range=range.duplicate();stored_range.moveToElementText(obj);stored_range.setEndPoint("EndToEnd",range);obj.selectionStart=stored_range.text.length-range.text.length;obj.selectionEnd=obj.selectionStart+range.text.length;CaretPos=obj.selectionStart}else{if(obj.selectionStart||obj.selectionStart=="0"){CaretPos=obj.selectionStart}}return CaretPos};it.getSelectedText=function(obj){var selectedText="";var getSelection=function(e){if(e.selectionStart!=undefined&&e.selectionEnd!=undefined){return e.value.substring(e.selectionStart,e.selectionEnd)}else{return""}};if(window.getSelection){selectedText=getSelection(obj)}else{selectedText=ds.createRange().text}return selectedText};it.setCursor=function(obj,pos,coverlen){if(typeof obj=="undefined"){return}pos=pos==null?obj.value.length:pos;coverlen=coverlen==null?0:coverlen;obj.focus();if(obj.createTextRange){var range=obj.createTextRange();range.move("character",pos);range.moveEnd("character",coverlen);range.select()}else{obj.setSelectionRange(pos,pos+coverlen)}};it.unCoverInsertText=function(obj,str,pars){pars=(pars==null)?{}:pars;pars.rcs=pars.rcs==null?obj.value.length:pars.rcs*1;pars.rccl=pars.rccl==null?0:pars.rccl*1;var text=obj.value,fstr=text.slice(0,pars.rcs),lstr=text.slice(pars.rcs+pars.rccl,text==""?0:text.length);obj.value=fstr+str+lstr;this.setCursor(obj,pars.rcs+(str==null?0:str.length))};return it})();Motie.nameCard=function(params){var _self=this;if(Motie.nameCard.layer===null){_self.createCard()}this.handle=$(params.ele);this.handle.data("nameCard",true);this.type=params.type;this.xid=params.xid;this.atname=params.atname||"";this.getCard=null;this.getSuccess=false;this.cacheId=this.type+(this.atname?this.atname:this.xid);var layer=Motie.nameCard.layer,setPos=Motie.nameCard.setPosition,loading=layer.loading,bd=layer.bd;var card=new Motie.openLayer(this.handle,layer,{duration:100,showTime:300,onShow:function(card){loading.show();bd.empty();var cache=Motie.nameCard.checkCache(_self.cacheId);if(cache&&!$IE){loading.hide();bd.html(cache);setPos(card)}else{_self.getCard=proxy.$.ajax({url:"/ajax/namecard/show",cache:false,data:{type:_self.type,id:_self.xid,atname:_self.atname},success:function(html){if($.trim(html)!=""){html=$(html);_self.getSuccess=true;Motie.nameCard.cache[_self.cacheId]=html;bd.html(html);loading.hide();setPos(card)}else{loading.hide();bd.html(['<div class="load-error ac" style="padding: 20px;">',(_self.type=="people"?"\u6CA1\u6709\u8FD9\u4E2A\u94C1\u7C89\u54DF :(":"\u8FD9\u672C\u4E66\u4E0D\u5B58\u5728\u54DF:("),"</div>"].join(""));setPos(card)}},error:function(){card.hideLayer();setPos(card)}})}},onHide:function(card){if(_self.getCard){_self.getCard.abort()}}});card.processShow();this.card=card;card.showLayer=function(){}};Motie.nameCard.setPosition=function(card){var handle=card.handle,scrollTop=$html.scrollTop(),wheight=$win.height(),mainLeft=$main.offset().left,mainWidth=$main.width(),handleHeight=handle.height(),handleWidth=handle.width(),handleTop=handle.offset().top,handleLeft=handle.offset().left,layer=Motie.nameCard.layer,arrow=Motie.nameCard.layer.arrow,bd=Motie.nameCard.layer.bd,newTop=0,newLeft=0;var switchClass=function(){};var t=(function(){var rk=scrollTop+wheight-handleTop,ck=rk-handleHeight;if(scrollTop==0&&handleTop<layer.height()){return false}if(ck>0){if(ck>=layer.height()){return false}return true}else{if(rk>=layer.height()){return false}else{if(ck<0){return true}else{return false}}}})(),l=(mainWidth-(handleLeft-mainLeft))<355;newTop=handleTop+handleHeight+5;newLeft=handleLeft-20;arrow.removeClass("pos-bl pos-rt pos-br");if(t&&!l){newTop=handleTop-layer.height()-10;arrow.addClass("pos-bl")}else{if(!t&&l){newTop=handleTop+handleHeight-30;newLeft=handleLeft-layer.width()-15;arrow.addClass("pos-rt")}else{if(t&&l){newTop=handleTop-layer.height()-10;newLeft=handleLeft-layer.width()+38;arrow.addClass("pos-br")}}}card.left=newLeft;card.top=newTop;layer.css({top:newTop,left:newLeft}).show()};Motie.nameCard.prototype.createCard=function(){this.layer=$('<div class="namecard" visible="display" style="display: none; position: absolute;"><div style="position:relative"><div class="namecard-arrow"></div><table width="100%"><tbody><tr><td class="pop-tl"></td><td class="pop-border"></td><td class="pop-tr"></td></tr><tr><td class="pop-border"></td><td class="pop-content"><div class="mod-author-info mod"><div class="loading-card ac fz-14" style="background: url('+ImgMotie+'/_assets/ajax-loader.gif) no-repeat 100px center; line-height: 200px; height: 200px;">\u52A0\u8F7D\u4E2D..</div><div class="bd"></div></div></td><td class="pop-border"></td></tr><tr><td class="pop-bl"></td><td class="pop-border"></td><td class="pop-br"></td></tr></tbody></table></div></div>');Motie.nameCard.layer=this.layer;Motie.nameCard.layer.bd=this.layer.find(".bd");Motie.nameCard.layer.loading=this.layer.find(".loading-card");Motie.nameCard.layer.arrow=this.layer.find(".namecard-arrow");$body.append(this.layer)};Motie.nameCard.layer=null;Motie.nameCard.cache={};Motie.nameCard.checkCache=function(id){return Motie.nameCard.cache[id]||false};Motie.nameCard.bind=function(area){var str="http://www.motie.com",timer,bind=function(t){var $this=t,href=$this.attr("href").replace(str,""),lp=href.lastIndexOf("/")+1;lp=href.substring(lp,href.length);if((/^\/group\/\d+$/).test(href)){new Mo.nameCard({ele:t[0],type:"group",xid:lp})}else{if((/^\/people\/\d+$/).test(href)){new Mo.nameCard({ele:t[0],type:"people",xid:lp})}else{if(href.match(/^\/book\/\d+$/)){new Mo.nameCard({ele:t[0],type:"book",xid:lp})}else{if(href.match(/^\/name\/\S*[^\/]$/)){new Mo.nameCard({ele:t[0],type:"people",xid:0,atname:lp})}}}}};$(area).delegate("a[href]","mouseenter",function(){var t=$(this);if($(this).data("namecard")===false){return}if(timer){clearTimeout(timer)}timer=setTimeout(function(){if(!t.data("nameCard")){bind(t)}},200)}).delegate("a[href]","mouseout",function(){if($(this).data("namecard")===false){return}if(timer){clearTimeout(timer)}})};Motie.medalCard=function(ele){var _self=this;this.handle=$(ele);this.id=this.handle.attr("id");if(!Motie.medalCard.layer){_self.createCard()}this.getCard=null;this.getSuccess=false;this.cacheId="medal-"+this.id;var layer=Motie.medalCard.layer,loading=layer.loading,bd=layer.bd;var card=new Motie.openLayer(this.handle,layer,{showTime:500,onShow:function(card){loading.show();bd.empty();Motie.medalCard.setPosition(card);var cache=Motie.medalCard.checkCache(_self.cacheId);if(cache&&!$IE){loading.hide();bd.html(cache);Motie.medalCard.setPosition(card)}else{_self.getCard=$.ajax({url:"/ajax/medal/show",cache:false,data:{id:_self.id},success:function(html){if($.trim(html)!=""){html=$(html);_self.getSuccess=true;Motie.medalCard.cache[_self.cacheId]=html;bd.html(html);loading.hide();Motie.medalCard.setPosition(card)}},error:function(){loading.hide();bd.html('<div class="load-error ac" style="padding: 20px;">\u52CB\u7AE0\u8BFB\u53D6\u9519\u8BEF</div>')}})}},onHide:function(card){if(_self.getCard){_self.getCard.abort()}}})};Motie.medalCard.setPosition=function(card){var handle=card.handle,scrollTop=$html.scrollTop(),wheight=$win.height(),handleHeight=handle.height(),handleWidth=handle.width(),handleTop=handle.offset().top,handleLeft=handle.offset().left,layer=Motie.medalCard.layer;layer.css({left:handleLeft-110})};Motie.medalCard.cache={};Motie.medalCard.checkCache=function(id){return Motie.medalCard.cache[id]||false};Motie.medalCard.prototype.createCard=function(){this.layer=$('<div class="mod-medal-card" visible="display" style="display: none;width: 253px;" x="-110" y="8"><table><tr><td colspan="3"><div class="pop-tt"></div></td></tr><tr><td class="pop-border"></td><td class="mc"><div class="loading-card ac fz-14" style="background: url("'+ImgMotie+'/_assets/ajax-loader.gif") no-repeat scroll 70px center transparent;  padding-left: 120px; line-height: 150px; height: 150px;">\u52A0\u8F7D\u4E2D..</div><div class="bd" style="width: 197px"></div></td><td class="pop-border"></td></tr><tr><td colspan="3"><div class="pop-bb"></div></td></tr></table></div>');Motie.medalCard.layer=this.layer;Motie.medalCard.layer.bd=this.layer.find(".bd");Motie.medalCard.layer.loading=this.layer.find(".loading-card");$body.append(this.layer)};Motie.medalCard.layer=null;Motie.subNav=function(o){var _self=this,ol,ot;this.ele=$(o.ele);this.subnav=o.subnav;ol=this.subnav.attr("left");ot=this.subnav.attr("top");this.ele.hover(function(){_self.ele.addClass("active");_self.subnav.css({left:ol+"px",top:ot+"px"})},function(){_self.ele.removeClass("active");_self.subnav.css({left:"-9999px",top:"-9999px"})})};Motie.setItemsPosition=function(ele,str){if(ele.size()==1){ele.first().addClass(str+"-first current only-one-"+str)}else{ele.first().addClass(str+"-first");ele.last().addClass(str+"-last")}};Motie.reSetItemsPosition=function(ele,str){ele.removeClass(str+"-first"+" "+str+"-last current only-one-"+str);Motie.setItemsPosition(ele,str)};Motie.GroupControal=function(obj,id,ftype,url,fn){var $obj=$(obj),ftype=ftype!==undefined?ftype:parseInt($obj.attr("ftype")),fn=fn||function(){},groupClass=Motie.GroupControal.GroupClass;if(ftype==2){return false}if(ftype==1){url=url?url:MotieHost+"/ajax/group/"+id+"/apply"}if(ftype==3){if(!confirm("退出小组","是否要退出小组？")){return false}url=url?url:MotieHost+"/ajax/group/"+id+"/out"}$.ajax({url:url,cache:false,success:function(data){var html=data.code,message=data.message;if(html=="inspect"){new Mo.layer({destroy:true,tpl:Mo.layer.tplStore.basicTpl,draggable:false,width:510,data:{html:$("#ask-form").html()},onRendered:function(_self){var form=_self.layer.find("form");form.ajaxForm({cache:false,success:function(data){text=data.code;if(text=="wait"){groupClass($obj.css("cursor","default"),"2")}else{if(text=="fail"){}else{if(text=="enough"){groupClass($obj,"4")}}}_self.hideLayer(_self)}})}}).render()}else{if(html=="wait"){groupClass($obj,"2")}else{if(html=="ok"){if(ftype==3){if(joinType=="2"){$obj.remove();return}else{groupClass($obj,"1")}$(".btn-wantto-speak").click(function(){alert("请先加入小组");return false})}else{$(".btn-wantto-speak").unbind("click");groupClass($obj,"3")}}else{alert(message)}}}}})};window.groupControal=Motie.GroupControal;Motie.GroupControal.GroupClass=function(obj,str){var groupClassStore={"1":"group-add","2":"group-processing","3":"group-exit","4":"group-full"};obj.removeClass("group-add group-processing group-exit").addClass(groupClassStore[str]);obj.attr("ftype",str)};Motie.wordsCalculation=function(ele,status){var _self=this;this.status=status===undefined?false:$(status);this.textarea=$(ele);this.ele=this.textarea[0];this.onspace=this.textarea.attr("onspace");this.onspace=!this.onspace?false:(this.onspace=="false")?false:true;this.Cal=function(str){var n=str.replace(/\t|\|n|\|r|\|v|\s|\u3000/g,"").length;_self.status&&_self.status.text(n);return n};this.textarea.bind("keyup",function(){_self.Cal(_self.textarea.val())});return this.Cal($.trim(this.textarea.text())!==""?this.textarea.text():this.textarea.val())};Motie.createMessage=function(o){var _self=this;this.ele=$(o.ele);this.max=this.ele.attr("max")||o.max;this.textarea=this.ele.find("textarea");this.state=this.ele.find(".limit-number:first");this.emotionHandle=this.ele.find(".emotionHandle:first");this.uploadImgHandle=this.ele.find(".uploadImgHandle:first");this.submitBtn=this.ele.find(".submit:first");this.submitType=this.ele.find('input[name="submitType"]').val()||"ajax";this.onSubmit=o.onSubmit||function(){};this.onSuccess=o.onSuccess||function(){};this.submiting=false;this.limit();this.imageTempFile=this.ele.find("input[name='imageTempFile']");this.form=this.textarea.parentsUntil("form").parent();this.formAction=this.form.attr("action");Mo.ui.at&&Mo.ui.at(this.textarea);var comment=Mo.core.action.comment();if(this.emotionHandle.length){_self.setEmotionValue(_self)}if(this.uploadImgHandle.length){_self.uploadImage(_self)}$("#upload-img .close").click(function(){$("input[name='imageTempFile']").val("")});$("#uploadImgLayer a").click(function(){$("input[name='imageTempFile']").val("")});$(document).click(function(){if(_self.currentLayer&&_self.currentLayer.attr("id")=="emotion"&&_self.currentLayer.is(":visible")){_self.currentLayer.hide()}});this.textarea.keyup(function(e){_self.limit();if(e.ctrlKey&&e.which==13||e.which==10){_self.submit(_self);_self.textarea.val("")}});this.submitBtn.click(function(){comment.isAllowReply(_self.submitBtn,0,8,function(){if(!_self.submiting&&_self.canbisubmit){_self.submit(_self)}});return false})};Motie.createMessage.messageCache="";Motie.createMessage.prototype.limit=function(){var _self=this;_self.canbisubmit=Motie.limitTextarea(_self.textarea,_self.max,_self.state);if(_self.canbisubmit){_self.canbisubmit=true;_self.submitBtn.removeClass("disable")}else{_self.canbisubmit=false;_self.submitBtn.addClass("disable")}};Motie.createMessage.prototype.submit=function(_self){var cache=Motie.createMessage.messageCache;Mo.ui.emotion().hide();if(cache&&cache==_self.textarea.val()&&$.trim(cache)!=""){alert("\u5DF2\u7ECF\u53D1\u8FC7\u4E86\uFF0C\u4E0D\u8981\u592A\u8D2A\u5FC3\u54DF\uFF01");return false}cache=_self.textarea.val();if($.trim(cache)==""){alert("内容不能为空！");return false}if(_self.textarea.hasClass("disabled")){return false}if(this.submitType=="ajax"){_self.onSubmit(_self);_self.ajax=$.ajax({type:"post",cache:false,url:_self.formAction,data:{content:_self.textarea.val(),imageTempFile:_self.imageTempFile.val()},success:function(html){_self.textarea.val("");_self.submiting=false;$("input[name='imageTempFile']").val("");$("#uploadDiv").show();$("#uploadImgLayer").hide();$("#upload-img").hide();_self.limit();_self.onSuccess(html)}})}else{_self.form.submit()}_self.submiting=true};Motie.createMessage.cache={};Motie.createMessage.prototype.currentLayer=null;Motie.createMessage.prototype.setEmotionValue=function(_self){_self.emotionHandle.click(function(){$("#upload-img").hide();Mo.ui.emotion($(this),_self.textarea);return false})};Motie.createMessage.prototype.uploadImage=function(_self){var uimg=$("#upload-img");this.uploadImage=uimg;_self.uploadImgHandle.click(function(){Mo.ui.emotion().hide();uimg.css({top:_self.uploadImgHandle.offset().top+_self.uploadImgHandle.height()+10,left:_self.uploadImgHandle.offset().left}).show();return false});uimg.find(".close").click(function(){uimg.hide();return false});var btnUpload=$("#upload"),binded=false;var status=$("#uploadStatus");var imageFile=$("#imageFile");var uploadObject=new AjaxUpload(btnUpload,{action:"/ajax/icon/twitter/upload",name:"uploadfile",onSubmit:function(file,ext){if(!(ext&&/^(jpg|jpeg|gif|png)$/i.test(ext))){status.addClass("error").text("\u53EA\u5141\u8BB8  JPG\u3001jpeg\u3001 GIF\u3001 PNG \u7684\u6587\u4EF6\u683C\u5F0F");return false}status.addClass("uploading");status.text("\u56FE\u7247\u4E0A\u4F20\u4E2D...")},onComplete:function(file,response){var index=response.indexOf("<");if(index!=-1){response=response.substring(0,index)}uploadImg.attr("src",response);filename.text(file);uploadDiv.hide();uploadImgLayer.show();status.text("").removeClass("uploading").removeClass("error");imageFile.val(response);$("input[name='imageTempFile']").val(response);if($("textarea[name='content']").val()==""){$("textarea[name='content']").val("\u5206\u4EAB\u56FE\u7247")}}});btnUpload.mouseover(function(){$(uploadObject._input).click(function(e){e.stopPropagation()})});var uploadImgLayer=$("#uploadImgLayer"),uploadDiv=$("#uploadDiv"),uploadImg=uploadImgLayer.find("img"),filename=uploadImgLayer.find("h3"),del=uploadImgLayer.find("a");del.click(function(){uploadImg.attr("src","");filename.text("");uploadImgLayer.hide();uploadDiv.show();uimg.hide();return false})};Motie.customSelect=function(ele){var _self=this;this.ele=$(ele);this.name=ele.name;this.options=this.ele.find("option");this.defaultValue=this.ele.attr("default")||false;this.className=ele.className;this.onChange=this.ele.attr("onchange")||this.ele.attr("changeSelect")||function(){};this.style=this.ele.attr("style")||"";_self.changed=false;this.data=[];this.items=null;this.selectList=$('<div class="custom-select-list" id="'+this.name+'-select-list">'+'<div class="select-list-bd"><ul></ul></div>'+"</div>");this.transition(_self);this.selectElement=$('<div style="'+this.style+'" class="input-wrap '+this.className+'" id="'+this.name+'-select">'+'<div class="input-bd"><a class="handle" item:value="'+this.defaultValue[0]+'" href="#">'+this.defaultValue[1]+"</a></div>"+'<input type="hidden" value="'+this.defaultValue[0]+'" name="'+this.name+'" />'+"</div>");this.handle=this.selectElement.find(".handle");this.hiddenInput=this.selectElement.find("input:hidden");this.ele.replaceWith(this.selectElement);this.selectList.appendTo($body);this.handle.click(function(){if(_self.selectList.is(":visible")){_self.hideList(_self)}else{_self.hideList().setPosition().selectList.show();Motie.customSelect.currentSelect=_self.selectList}return false});this.max=null;$(document).click(function(){_self.hideList(_self)});$(window).bind("resize",function(){_self.setPosition()})};Motie.customSelect.currentSelect=null;Motie.customSelect.prototype.transition=function(_self){var ul=this.selectList.find("ul");for(var i=0;i<this.options.size();i++){var tmp=this.options.eq(i);if(this.defaultValue==tmp.val()){this.defaultValue=[tmp.val(),tmp.text()];ul.append('<li><a href="#" class="active" item:value="'+tmp.val()+'">'+tmp.text()+"</a></li>")}else{ul.append('<li><a href="#" item:value="'+tmp.val()+'">'+tmp.text()+"</a></li>")}_self.data.push({text:tmp.text(),value:tmp.val()})}if(this.defaultValue===false){this.defaultValue=[this.data[0]["value"],this.data[0]["text"]]}this.items=ul.find("a");this.items.click(function(){var $this=$(this);_self.items.removeClass("active");$this.addClass("active");_self.handle.text($this.text());_self.hiddenInput.val($this.attr("item:value"));_self.hideList();if(typeof _self.onChange=="string"){if(!_self.changed){_self.changed=true;_self.onChange=_self.onChange.replace("value",'$this.attr("item:value")')}eval("("+_self.onChange+")")}else{_self.onChange($this.attr("item:value"))}return false});return this};Motie.customSelect.prototype.setPosition=function(_self){var height=this.selectList.height();if(this.max===null&&height>144){this.max=true;height=144}this.selectList.css({width:this.selectElement.width(),left:this.selectElement.offset().left,top:this.selectElement.offset().top+this.selectElement.outerHeight()-1,height:height,overflowY:this.max?"scroll":"hidden"});return this};Motie.customSelect.prototype.hideList=function(_self){if(Motie.customSelect.currentSelect){Motie.customSelect.currentSelect.hide()}return this};Motie.openLayer=function(handle,layer,options){if(!handle[0]||!layer[0]){return false}var _self=this;this.options=options||{};this.onHide=this.options.onHide||function(){};this.onShow=this.options.onShow||function(){};this.handle=handle;this.handleTop=this.handle.offset().top;this.handleLeft=this.handle.offset().left;this.layer=layer;this.icant=this.layer.attr("icant")||true;this.visible=this.layer.attr("visible")||"position";if(this.icant!="true"){if(!layer.parent().is("body")){this.layer=layer.clone();layer.remove();$("body").append(this.layer)}}this.x=this.layer.attr("x")||0;this.x=this.x*1;this.y=this.layer.attr("y")||0;this.y=this.y*1;this.left=function(){return _self.handle.offset().left+_self.x};this.top=function(){return _self.handle.offset().top+_self.handle.height()+_self.y};this.duration=this.options.duration!==undefined?this.options.duration:1000;this.showTime=this.options.showTime!==undefined?this.options.showTime:0;this.close=this.layer.find(".close-layer:first");this.eventType=this.options.eventType||"mouseenter";var show=function(){_self.layer.hover(function(){if(_self.timer){clearTimeout(_self.timer)}_self.showLayer(_self)},function(){_self.lazyHide(_self)});_self.onShow(_self);_self.showLayer(_self)};_self.processShow=function(){_self.layer.unbind("hover");_self.timer=_self.layer.data("timer");_self.showTimer=_self.layer.data("showTimer");if(_self.timer){clearTimeout(_self.timer)}if(_self.showTimer){clearTimeout(_self.showTimer)}if(_self.showTime){_self.showTimer=setTimeout(function(){show();_self.layer.data("showTimer",_self.showTimer)},_self.showTime)}else{show()}};this.handle.bind(this.eventType,function(e){_self.processShow()});this.handle.bind("mouseout",function(){_self.lazyHide(_self)});this.layer.css("zIndex","1000");this.close.click(function(){_self.hideLayer(_self);return false})};Motie.openLayer.currentLayer=null;Motie.openLayer.prototype.lazyHide=function(_self,hide){if(_self.showTimer){clearTimeout(_self.showTimer)}if(_self.duration==0){_self.hideLayer(_self);return _self}if(this.timer){clearTimeout(this.timer)}this.timer=setTimeout(function(){_self.hideLayer(_self)},this.duration);_self.layer.data("timer",this.timer)};Motie.openLayer.prototype.showLayer=function(_self){this.layer.css({left:_self.left(),top:_self.top()}).show()};Motie.openLayer.prototype.hideLayer=function(_self,fn){_self=_self||this;if(this.timer){clearTimeout(this.timer)}if(this.visible=="position"){this.layer.css({left:"-9999px",top:"-9999px"})}else{this.layer.hide()}_self.layer.unbind("hover");_self.onHide(_self)};Motie.popLayer=function(handle,layer,options){var _self=this;_self.defaults={onHide:function(){},onShow:function(){},hideByEsc:true};if(options){$.extend(_self.defaults,options)}this.handle=handle;this.layer=layer;if(!this.layer[0]||!this.handle[0]){return false}this.close=layer.find(".pop-close");Motie.popLayer.createOverlay();this.handle.data("pop",this);this.handle.click(function(){_self.show()});this.close.click(function(){_self.hide(_self);return false});if(_self.defaults.hideByEsc==true){$(document).keyup(function(e){if(_self.layer.is(":visible")){if(e.keyCode==27){_self.hide(_self)}}})}};Motie.popLayer.cache={};Motie.overlay=$("#overlay")[0];Motie.popLayer.createOverlay=function(){if(!Motie.overlay){Motie.overlay=$("<div></div>",{id:"overlay",display:"none"}).appendTo($("body"))}};Motie.popLayer.prototype.show=function(_self){_self=_self||this;if(!Motie.CheckLogin(true)){return false}Motie.overlay.show().css({"height":$("body").height()});_self.layer.css({opacity:0,top:$win.scrollTop()+200}).stop().show().animate({opacity:1},"fast");_self.defaults.onShow(_self);Motie.overlay.unbind("click").click(function(){_self.hide(_self)})};Motie.popLayer.prototype.hide=function(_self){var _self=_self||this;this.defaults.onHide(this);Motie.overlay.hide();this.layer.stop().animate({opacity:"0"},"fast",function(){_self.layer.hide()})};Motie.loadImg=function(url,fn){var img=new Image();img.src=url;if(img.complete){fn.call(img)}else{img.onload=function(){fn.call(img)};img.src=img.src}};Motie.lazyload=function(option){var settings={defObj:null,defHeight:0};
settings=$.extend(settings,option||{});var defHeight=settings.defHeight,defObj=(typeof settings.defObj=="object")?settings.defObj.find("img"):$(settings.defObj).find("img");var pageTop=function(){return document.documentElement.clientHeight+Math.max(document.documentElement.scrollTop,document.body.scrollTop)-settings.defHeight};var imgLoad=function(){defObj.each(function(){if($(this).offset().top<=pageTop()){var orgSrc=$(this).attr("orgSrc");if(orgSrc){$(this).attr("src",orgSrc).removeAttr("orgSrc")}}})};imgLoad();var timer=null;$(window).bind("scroll",function(){if(timer){clearTimeout(timer)}timer=setTimeout(function(){imgLoad()},100)})};Motie.MediaPlayer=Base.extend({id:0,ownerPage:false,type:"",body:null,reality:null,tumb:null,loadIco:null,constructor:function(handle,smallImage,imageWrap,mediaType){var _self=this;this.element=handle;this.smallImage=smallImage;this.imageWrap=imageWrap;this.tumb=smallImage.find(".tumb-image");this.tumbPic=this.tumb.find("img");this.element.data("media",this);this.type=this.element.attr("data-media-type");this.TypeObject=mediaType;if(!this.TypeObject){return}this.id=Motie.MediaPlayer.primary++;Motie.MediaPlayer.cache[this.id]=this;this.maxWidth=smallImage.width()-30;this.isForward=smallImage.parent().parent().hasClass("m-c");this.shirt=Motie.MediaPlayer.basicTemplate;if(!this.isForward){this.shirt=['<div class="image-maskup"><div class="m-t"></div><div class="m-c">',this.shirt,"</div></div>"].join("")}if(this.element.hasClass("big-image")){this.ownerPage=true;this.TypeObject.controal.call(this);return}this.setup()},setup:function(){var recreate=this.recreate===undefined?this.TypeObject.recreate:this.recreate,ref=this.tumbPic[0]?this.tumbPic:this.smallImage;if(this.TypeObject.onCreate){if(this.loadIco==null){this.loadIco=$('<span class="loadIco" style="position: absolute"></span>').css({left:ref.width()/2-8,top:ref.height()/2-8});if(ref[0].tagName=="IMG"){ref.after(this.loadIco)}else{ref.append(this.loadIco)}}switch(recreate){case"recreate":!this.loadIco.is(":visible")&&this.loadIco.show()&&(delete this.body)&&!this.TypeObject.onCreate.call(this);break;case false:this.ShowMedia();break;case true:this.recreate="recreate";this.TypeObject.onCreate.call(this);break;case undefined:this.recreate=false;this.TypeObject.onCreate.call(this);break}}else{this.ShowMedia()}},ShowMedia:function(){var _self=this;if(this.body){this.body.render()}else{this.TypeObject.create.call(this)}this.TypeObject.hideElement&&this.element.hide();this.loadIco&&this.loadIco.hide()},CreateControal:function(){var _self=this,len,t,ele,ctl=this.TypeObject.controal?this.TypeObject.controal.slice(""):[],controal=this.body.layer.find(".controal");ctl.unshift({text:"收起","class":"slide-up fl",click:function(){_self.HideMedia()}});this.buttons=[];if(len=ctl.length){for(var i=0;i<len;i++){t=ctl[i];if(!t.href){t.href="javascript:;"}ele=$("<a>",t);ele.data("boss",this);this.buttons.push(ele);controal.append(ele);if(i!=len-1){controal.append('<span class="sp fl">|</span>')}}}},HideMedia:function(){this.body.hideLayer();this.element.show()},GetMaxWidth:function(){this.maxWidth=this.smallImage.width()-30;if(this.smallImage.hasClass("big-image")){this.maxWidth=this.smallImage.width()}return this.maxWidth}},{cache:{},primary:0,basicTemplate:'<div class="big-image"><div class="controal clear"></div><div class="maskup-content">{{{html}}}</div></div>',type:{},bind:function(context){$(context).delegate(".tumb-image","click",function(){var $t=$(this);if(!$t.data("media")){var $p=$t.parentsUntil(".txtbox-image-wrap").parent().first(),$s=$p.find(".small-image"),mediaType=Motie.MediaPlayer.type[$s.attr("data-media-type")];if(!mediaType){return false}new Motie.MediaPlayer($t,$s,$p,mediaType)}else{if($t.data("media")&&$t.data("media").body){$t.data("media").setup()}}return false})}});$.extend(Motie.MediaPlayer.type,{image:{hideElement:true,controal:[{text:"查看大图",target:"_blank","class":"show-big fl",href:"",click:function(){var _self=$(this).data("boss")}},{text:"向左转","class":"turn-left fl",click:function(){var _self=$(this).data("boss");_self.TypeObject.rotate.apply(_self.body.pic,[_self,"right"])}},{text:"向右转","class":"turn-right fl",click:function(){var _self=$(this).data("boss");_self.TypeObject.rotate.apply(_self.body.pic,[_self,"left"])}}],rotate:function(_self,name){var img=this[0],step=img.getAttribute("step"),larger=null,maxWidth=_self.maxWidth;if(!this.data("width")&&!$(this).data("height")){this.data("width",img.width);this.data("height",img.height)}if(step==null){step=0}if(name==="left"){(step==3)?step=0:step++}else{if(name==="right"){(step==0)?step=3:step--}}img.setAttribute("step",step);var show_width=this.data("width"),show_height=this.data("height");if((step==1||step==3)&&this.data("width")<this.data("height")&&this.data("height")>maxWidth){show_height=maxWidth;show_width=this.data("width")*maxWidth/this.data("height")}if(document.all){img.style.filter="progid:DXImageTransform.Microsoft.BasicImage(rotation="+step+")";img.width=show_width;img.height=show_height;larger=this}else{var c=this.next("canvas")[0];if(this.next("canvas").length==0){this.css({"visibility":"hidden","position":"absolute"});c=document.createElement("canvas");c.setAttribute("class","maxImg canvas");img.parentNode.appendChild(c)}larger=$(c);var canvasContext=c.getContext("2d");var resizefactor=1;show_height=img.raw_height=$(img).attr("raw_height");show_width=img.raw_width=$(img).attr("raw_width");if((step==1||step==3)&&img.raw_height>maxWidth){resizefactor=maxWidth/img.raw_height;show_height=maxWidth;show_width=resizefactor*img.raw_width}if((step==0||step==2)&&img.raw_width>maxWidth){resizefactor=maxWidth/img.raw_width;show_height=resizefactor*img.raw_height;show_width=maxWidth}switch(step){default:case 0:c.setAttribute("width",show_width);c.setAttribute("height",show_height);canvasContext.rotate(0*Math.PI/180);canvasContext.scale(resizefactor,resizefactor);canvasContext.drawImage(img,0,0);break;case 1:c.setAttribute("width",show_height);c.setAttribute("height",show_width);canvasContext.rotate(90*Math.PI/180);canvasContext.scale(resizefactor,resizefactor);canvasContext.drawImage(img,0,-img.raw_height);break;case 2:c.setAttribute("width",show_width);c.setAttribute("height",show_height);canvasContext.rotate(180*Math.PI/180);canvasContext.scale(resizefactor,resizefactor);canvasContext.drawImage(img,-img.raw_width,-img.raw_height);break;case 3:c.setAttribute("width",show_height);c.setAttribute("height",show_width);canvasContext.rotate(270*Math.PI/180);canvasContext.scale(resizefactor,resizefactor);canvasContext.drawImage(img,-img.raw_width,0);break}}},onCreate:function(){var _self=this,src=this.element.find("img").attr("src");this.path={small:src,large:src.replace(/(.*)s(\d*\..*)/,"$1l$2"),big:src.replace(/(.*)s(\d*\..*)/,"$1d$2")};this.largePic=new Image();this.largePic.src=this.path.large;Motie.loadImg(this.path.large,function(){_self.largePic=this;_self.ShowMedia()})},create:function(){var _self=this,width=this.largePic.width,height=this.largePic.height,raw_height=this.largePic.height,raw_width=this.largePic.width,maxWidth=this.GetMaxWidth(),tpl="";if(width>maxWidth){height=maxWidth/width*height;width=maxWidth-10}new Motie.layer({tpl:this.shirt,overlay:false,destroy:true,data:{bigSrc:this.path.big,largeSrc:this.path.large,width:width,height:height,raw_width:raw_width,raw_height:raw_height,maxWidth:maxWidth,html:this.TypeObject.html},onShow:function(){_self.imageWrap.prev(".message-noline").toggleClass("message-noline message")},onHide:function(){_self.imageWrap.prev(".message").toggleClass("message-noline message")},where:this.element,insertType:"after",position:false,onRendered:function(that){_self.body=that;_self.body.content=that.layer.find(".maskup-content");_self.CreateControal();_self.buttons[1].attr("href",_self.path.big);_self.body.content.find("img").click(function(){_self.buttons[0].click()});_self.body.content.delegate("canvas","click",function(){_self.buttons[0].click()});_self.body.pic=that.layer.find(".image")}}).render()},html:'<img alt="" src="{{largeSrc}}" width="{{width}}" height="{{height}}" maxWidth="{{maxWidth}}" raw_width="{{raw_width}}" raw_height="{{raw_height}}" class="image" />'},video:{hideElement:true,create:function(){var _self=this,maxWidth=this.GetMaxWidth(),src=this.tumbPic.attr("videosrc");new Motie.layer({tpl:this.shirt,overlay:false,destroy:true,data:{width:maxWidth,height:Math.ceil(maxWidth*0.8),src:src,html:this.TypeObject.html},where:this.element,insertType:"after",position:false,onRendered:function(that){_self.body=that;_self.body.content=that.layer.find(".maskup-content");_self.CreateControal()}}).render()},html:'<embed height="{{height}}" width="{{width}}" src="{{src}}" wmode="transparent" type="application/x-shockwave-flash" />'},poll:{recreate:true,loadVote:function(){var _self=this,layer=this.body.layer,max=layer.find("input[name=maxofchoice]").val(),loadIco=layer.find(".loadIco"),lis=layer.find("li"),count=0,onlyone=max==="1",voteSelect=layer.find(".vote-select"),submiting=false,result=layer.find(".vote-result").length,total,pWidth,btnSubmit;var disall=function(n){if(n){lis.not(".selected").addClass("disabled").find("input").attr("disabled","disabled")}else{lis.removeClass("disabled").find("input").removeAttr("disabled")}};total=voteSelect.attr("data-value");if(result){pWidth=layer.find(".progess").eq(0).width();pWidth-=80}else{var form=layer.find("form");btnSubmit=layer.find(".btn-submit");form.ajaxForm({beforeSubmit:function(){if(submiting){return false}if(count==0){alert("不能一个也不选哦！");return false}submiting=true;loadIco.fadeIn("fast")},success:function(html){_self.body.hideLayer().render({data:{html:html,voted:true}});submiting=false;loadIco.attr("class","okIco fr").delay(1000).fadeOut()}});if(voteSelect.hasClass("allow-result")){voteSelect.find("span.result").each(function(){var value=$(this).attr("data-value"),len=total==0?0:value/total,percent=Math.round(len*100);$(this).text(value+"("+percent+"%)")})}}lis.each(function(){var $t=$(this),btn=$t.find("input"),sel=function(box,type){var ck=box?!btn.is(":checked"):btn.is(":checked");if(ck){btn.removeAttr("checked");count--;$t.removeClass("selected");disall(false)}else{if(count<max){btn.attr("checked","checked");count++;$t.addClass("selected");if(count==max&&type!="radio"){disall(true)}}}};if(!result){btn.click(function(e){sel(true,e.target.type);e.stopPropagation()});$t.click(function(){if(!onlyone){sel(false)}else{++count;lis.removeClass("selected");$t.addClass("selected");btn.attr("checked","checked")}})}else{var progess=$t.find(".progess em"),w=progess.width(),per=$t.find(".percent"),value=per.attr("data-value"),len=total==0?0:value/total,percent=Math.round(len*100);per.text(value+"("+percent+"%)");if(!$IE6){setTimeout(function(){progess.animate({width:len*pWidth+w},{easing:"easeOutExpo"})},100)}else{progess.css({width:len*pWidth+w})}}})},onCreate:function(){var _self=this,url=this.smallImage.attr("data-poll-url");$.ajax({url:url,cache:false,success:function(html){_self.voteHtml=html;_self.ShowMedia()}})},create:function(){var _self=this;new Mo.layer({tpl:"{{{html}}}",overlay:false,position:false,data:{html:'<div class="poll-form clear">'+this.voteHtml+"</div>"},where:this.smallImage.find(".talk-inner"),insertType:"append",onRendered:function(that){var layer=that.layer,close=_self.smallImage.find(".close");_self.body=that;_self.element.hide();if(!that.data.voted){close.toggleClass("must-hide").click(function(){_self.HideMedia();close.addClass("must-hide")})}_self.TypeObject.loadVote.call(_self);Mo.utils.dom.centerImage.call(layer)}}).render()}},talk:{recreate:true,hideElement:false,onCreate:function(){var _self=this;_self.ShowMedia()},create:function(){var _self=this,text=this.smallImage.attr("data-talk-text"),action=this.smallImage.attr("data-action");new Mo.layer({tpl:"{{{html}}}",overlay:false,position:false,data:{html:this.TypeObject.html,text:text,random:Mo.tools.RandomCache()},where:this.smallImage.find(".talk-inner"),insertType:"append",onShow:function(that){var layer=that.layer,txt=layer.find("textarea");setTimeout(function(){Motie.TextareaUtils.setCursor(txt[0],txt.val().length,0)},1)},onRendered:function(that){var layer=that.layer,txt=layer.find("textarea"),status=layer.find(".status"),vaild,posted=false,submit=layer.find("a[role=submit]"),emotionBtn=layer.find("a[role=emotion]"),close=_self.smallImage.find(".close"),loadIco=_self.smallImage.find("span.loadStatus");_self.body=that;_self.CreateControal();_self.element.hide();emotionBtn.click(function(){Mo.ui.emotion(emotionBtn,txt);return false});close.toggleClass("must-hide").click(function(){_self.HideMedia();close.addClass("must-hide")});txt.width(layer.width()-22);Mo.app.weibo(txt,submit,action,null,null,{},status,loadIco,{onSuccess:function(data){if(data){loadIco.toggleClass("lodeIco okIco");close.toggleClass("must-hide");layer.slideUp("fast",function(){_self.HideMedia()});setTimeout(function(){loadIco.toggleClass("lodeIco must-hide okIco")},500)}}})}}).render()},html:['<div class="ask-form clear" style="clear:both">',"<div>",'<textarea name="content" id="txt{{random}}">{{text}}</textarea>',"</div>",'<p class="ar">','<a class="show-emotion vm fl" role="emotion" href="javascript:;"></a>','<span class="loadStatus" style="vertical-align:middle;margin: 5px"></span>','<span class="vm desc status" style="margin-right: 15px;"></span>','<a role="submit" href="javascript:;" class="M-button-s">向嘉宾提问</a>',"</p>","</div>"].join("")}});Motie.EventAgency=Base.extend({contructor:function(){}});Motie.limitTextarea=function(textarea,max,status,space){if(typeof textarea=="undefined"||textarea.length==0){return}space=space===undefined?false:space;var len=space?textarea.val().length:textarea.val().replace(/[\r|\n| |\u3000]/g,"").length,s=max-len*1;if(status){if(s<0){status.addClass("length-error");status.html('已超过<b class="limit-number">'+Math.abs(s)+"</b>个字")}else{status.removeClass("length-error");status.html('您还可输入<b class="num">'+s+"</b>字")}}return s>=0};Mo.tags=Base.extend({constructor:function(params){var _self=this,options,defaults={input:"",ul:"",className:"",max:1000,disableEnter:false,onAdd:function(){},onRemove:function(){},onOver:function(){},onEmpty:function(){},addAccordingTo:function(){return true},defaultText:"输入标签",same:false};this.options=options=$.extend(defaults,params);this.number=0;this.input=$(options.input);this.value=$.trim(this.input.val()).split(" ");this.ul=$(options.ul);this.hidden=$('<input type="hidden" name='+(this.input.attr("name")||"tags")+" />");this.input.after(this.hidden).attr("name","");if(this.value[0]!=""){this.input.val("");$.each(this.value,function(i,v){_self.add(v)})}this.input.bind("keydown blur",function(e){var $this=$(this),tags=_self.ul,value=$.trim(this.value);if(options.disableEnter){if(e.keyCode==8){_self.remove(e)}else{return false}}else{if(_self.number<=_self.options.max&&value!=""&&!value.match(/[' '|\u3000]+/)){if(e.type=="blur"||(e.type=="keydown"&&(e.keyCode==9||e.keyCode==32))){_self.add(value);this.value="";return false}}else{if(_self.number>0&&this.value==""&&e.keyCode==8&&tags.find("li").size()){_self.remove(e)}}}});this.input.inputDefault({value:options.defaultText}).parent().click(function(){_self.input.focus()}).end();this.ul.find("li .rm").live("click",function(e){_self.remove(e)})},add:function(value,data){var _self=this,opt=_self.options,c=opt.className,ul=_self.ul,data=data||{};if(_self.number>=opt.max){opt.onOver(_self);return false}if((!opt.same&&this.search(value)[0]===true)||!opt.addAccordingTo(value)){return false}_self.number++;var li=$('<li class="'+c+'"><a><em title="'+value+'" class="name">'+value+'</em><span title="删除" class="rm"></span></a></li>').data(data);ul.append(li);_self.options.onAdd(_self,li);_self.hidden.val(_self.getAll().join(" "));return _self},remove:function(e){var _self=this,ul=_self.ul,ele,txt;if(_self.number==0){opt.onEmpty(_self);return false}switch(typeof e){case"object":switch(e.type){case"click":ele=$(e.target).parent().parent();break;case"keydown":ele=ul.find("li:last");break}break;case"number":ele=ul.find("li").eq(i);break;case"string":ele=_self.search(e)[2];break}ele&&ele.remove();_self.options.onRemove(_self,ele);_self.hidden.val(_self.getAll().join(" "));if(_self.number>0){_self.number--}return _self},search:function(str){var all=this.getAll(),result=[false,0,null];for(var i=0;i<all.length;i++){if(str==all[i]){result=[true,i,this.ul.find("li").eq(i)];break}}return result},getNumber:function(){return this.number},isMax:function(){return this.number>=this.options.max},getAll:function(){return $.map(this.ul.find("li"),function(a){return $(a).text()})}});Motie.changeCity=function(params){var cityData=null;$.ajax({url:MotieHost+"/ajax/province/list",success:function(data){cityData=data}});var layer=Motie.changeCity.layer=new Mo.layer({width:500,handle:$(params.handle),data:{html:['<a class="fr pop-close" href="#"></a>',"<h3>",'<img class="fl" src="'+ImgMotie+'/_assets/title-do-comment.gif"> 选择城市',"</h3>",'<div class="sp-20"></div>','<table class="for-table">',"<tbody>",'<tr height="100px">','<td class="col2">','<ul id="province"> </ul>',"</td>","</tr>","<tr><td><hr/></td> </tr>",'<tr height="60px;">','<td class="col2">','<ul id="city" class="tag-list"> </ul>',"</td>","</tr>","</tbody>","</table>"].join("")},onRendered:function(_self){if(cityData){var arr=[];$.each(cityData,function(i,item){arr.push('<li onclick="Motie.changeCity.showCity('+item.id+')">'+item.name+"</li>")});$("#province").html(arr.join(""))}}})};Motie.changeCity.showCity=function(pid){$.ajax({url:MotieHost+"/ajax/city/"+pid+"/list",cache:false,success:function(data){if(data.length==1){$("#selCity").val(data[0].name);$("#cityId").val(data[0].id);$("#do-select").toggle("fast")}var arr=[];$.each(data,function(i,item){arr.push('<li id="c'+item.id+'" onclick="Motie.changeCity.selectCity('+item.id+')">'+item.name+"</li>")});$("#city").html(arr.join(""))}});return false};Motie.changeCity.selectCity=function(cid){$("#selCity").val($("#c"+cid).text());$("#cityId").val(cid);Motie.changeCity.layer.hideLayer(Motie.changeCity.layer)};Motie.addNewClass=function(ul){var nowDate=Date.getDate(serverTime);var compare=function(createDate){if(nowDate.getTime()>createDate.getTime()+7*24*60*60*1000){return false}return true};ul.find("li").each(function(){var $this=$(this),cDate=$this.attr("createdate");var createDate=Date.getDate(cDate);if(compare(createDate)){$this.addClass("new")}})};Motie.IsEmptyReply=function(id){var t=$.trim($("#"+id).val());if(!t||/^回复@[^:]+:{1}$/i.test(t)){alert("请输出回应内容！");return false}return true}})();

//mo.core.delegate
Mo.register("core.delegate",function(e){return function(t,n){var r=e.core.action;$("body").delegate("a[action-type], button[action-type]","click",function(e){var t=this.getAttribute("action-type"),n=this.getAttribute("action-params")||"";if(t)if(r[t])r[t].call($(this),n);else{if(window.console==undefined)throw"action-type\u4e0d\u5b58\u5728\uff1a"+t;console.log('action-type\u4e0d\u5b58\u5728\uff1a"'+t+'",Element is:"',this,'"')}if($IE)return!1})}});

//mo.core.ajaxStatus
Mo.register("core.ajaxStatus",function(e){return{inProcess:function(e){return e.attr("data-ajax-status")=="processing"},done:function(e){return e.attr("data-ajax-status","done")},processing:function(e){return e.attr("data-ajax-status","processing")}}});

//mo.core.callback
Mo.register("core.callback",function(e){return function(e,t,n){if(arguments.length==2)n=t,t=e;else{if(arguments.length!=3||!e.jquery)return $.noop;t=e.attr("data-custom-"+t)}return n[t]&&typeof n[t]=="function"?n[t]:$.noop}});

//mo.core.unique
Mo.register("core.unique",function(){return function(e){var t=[],n={};for(var r=0,i;(i=e[r])!=null;r++)n[i]||(t.push(i),n[i]=!0);return t}});

//mo.app.weibo
Motie.register("app.weibo",function(a){return function(b,c,d,e,f,g,h,i,j){function p(){if(k&&!l)if(d){i&&i.attr("class","loadIco").fadeIn("fast"),l=!0,b.addClass("disabled").attr("disabled","disabled");try{m[n]=b.val(),m[o]=f.val()}catch(c){a.error.push(c)}$.ajax({url:d,data:$.extend(m,g),type:"post",timeout:2e4,success:function(a){a?(i&&i.attr("class","okIco").delay(500).fadeOut(1e3),l=!1,b.removeClass("disabled").removeAttr("disabled"),j.onSuccess(a)):i&&i.attr("class","errorIco")},error:function(){i&&i.attr("class","errorIco"),j.onError()}})}else j()}var k=!1,l=!1,m={},n=b.attr("name"),o=f&&f.attr("name");j=$.extend({onSuccess:$.noop,onError:$.noop},j);if(e){var q=$.extend({},{url:"/ajax/icon/twitter/upload"},e);a.utils.upload(q)}b.keyup(function(d){k=a.limitTextarea(b,140,h),k?c.removeClass("disabled"):c.addClass("disabled"),(d.ctrlKey&&d.which==13||d.which==10)&&p()}).keyup(),a.ui.at&&a.ui.at(b),c.click(function(){p()})}});

//mo.utils.randomKey
Mo.register("utils.randomKey",function(a){return function(a){return Math.ceil(Math.random()*Math.pow(10,a||10))}});

//mo.utils.getFeedData
Mo.register("utils.getFeedData",function(e){return function(e){var t=e.parent("[role=data-feed]").length?e.parent("[role=data-feed]"):e.parentsUntil("[role=data-feed]").last().parent();t[0]==document&&(t=e);var n={feedId:t.attr("data-feed-id")||0,typeId:t.attr("data-feed-type")||0,eventId:t.attr("data-event-id")||0};return!n.feedId||!n.typeId?(window.console!=undefined&&console.log("action-type: "+e.attr("action-type")+" -- \u4e0d\u5b58\u5728\u5bf9\u8c61id\u6216\u7c7b\u578bid\uff0c\u6570\u636e\u7ed1\u5b9a\u5bf9\u8c61\uff1a",t),null):n}});

//mo.utils.upload
Motie.register("utils.upload",function(a){var b={handle:"",status:"",name:"uploadfile",appendTo:"body",url:"",ext:"^(jpg|jpeg|gif|png)$",id:"",onSubmit:$.noop,onComplete:$.noop,onError:$.noop};return function(c){try{var d=$.extend({},b,c)}catch(e){a.error.push(e)}return new AjaxUpload(d.handle,{id:d.id,appendTo:d.appendTo,action:d.url,name:d.name,onSubmit:function(a,b){var c=RegExp(b,"i");return b&&c.test(b)?(d.status&&(d.status.attr("class","loadIco").fadeIn("fast"),d.handle.hide()),d.onSubmit(a,b),void 0):(d.onError(a,b),!1)},onComplete:function(a,b){d.status&&d.status.attr("class","okIco").delay(500).fadeOut(700,function(){d.handle.show()}),d.onComplete(a,b)}})}});

//mo.utils.string
Mo.register("utils.string",function(){var b={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;"},c={"&amp;":"&","&lt;":"<","&gt;":">","&quot;":'"',"&#39;":"'"};return{escapeHtml:function(a){return a.replace(/&(?!\w+;)|[<>"']/g,function(a){return b[a]||a})},reverseHtml:function(a){return a.replace(/&(amp|lt|gt|quot|#39);/g,function(a){return c[a]||a})},peelHtml:function(a){return a.replace(/<(.[^>]*)>/g,"").replace(/</g,"&lt").replace(/>/g,"&gt")},maxString:function(a,b){return a.length>b?a.substring(0,b)+"..":a},trim:function(a){return a.replace(/(^[\s\u3000]*)|([\s\u3000]*$)/g,"")},rtrim:function(a){return a.replace(/([\s\u3000]*$)/g,"")},ltrim:function(a){return a.replace(/(^[\s\u3000]*)/g,"")}}});

//mo.utils.array
Mo.register("utils.array",function(){return{search:function(e,t){if($IE){for(var n=0,r=e.length;n<r;n++)if(e[n]===t)return!0;return!1}return e.indexOf(t)!=-1},unique:function(e){var t=[],n={};for(var r=0,i;(i=e[r])!=null;r++)n[i]||(t.push(i),n[i]=!0);return t}}});

//mo.utils.cache
Mo.register("utils.cache",function(e){var t=Base.extend({constructor:function(e){this.setting=$.extend({}),this.count=0,this.store={},this.array=[]},save:function(e,t){return e!=undefined?(this.count++,arguments.length==2?(this.store[e]=t,t):(t=e,this.array.push(t),t)):null},get:function(e){return e in this.store?this.store[e]:null},empty:function(){this.store={},this.array=[]}});return t});

//mo.utils.dom.centerImage
;(function(){Mo.register("utils.dom.centerImage",function(){return function(a){a=a==undefined?this:a;var b=$(a).find("ul img"),c=b.eq(0).parent().width(),d=b.size();b.length&&b.each(function(a){var b=$(this),d=b.attr("src"),e=c,f=new Image;f.src=d,Motie.loadImg(d,function(){var a=this.width,c=this.height,d=1;a>c?(c>e&&(d=e/c,b.height(e)),(a=b.width())>e&&b.css({"margin-left":-(a-e)/2})):a<c?(a>e&&(d=e/a,b.width(e)),c*d>e&&b.css({"margin-top":-(c*d-e)/2*.618})):a==c&&a>e&&b.width(e),b.height()<e&&c!=a&&$OLDIE&&($IE6||$IE7)&&b.css({"margin-top":(e-c)/2}),$IE6?b.show():b.fadeIn()})})}})})();

//mo.utils.dom.elementScroll
;(function(){Motie.register("utils.dom.elementScroll",function(a){var b={onScroll:$.noop,onBottom:$.noop,onTop:$.noop};return function(c,d){try{var e=$.extend({},b,d)}catch(f){a.error.push(f)}$(c).xresize(function(a){var b=$(this),c=b.scrollTop(),d=b.height(),f=b.children().first().outerHeight(),g={fullheight:f,pos:"top",current:0,height:d};c==0?(e.onTop(g),g.pos="top"):c+d==f?(e.onBottom(g),g.pos="bottom"):g.pos="fly",g.current=c,e.onScroll(g)})}})})()

//mo.utils.dom.delayKeyup
;(function(){Mo.register("utils.dom.delayKeyup",function(a){return function(b){var c={element:"",duration:0,process:$.noop};b&&$.extend(c,b);var d=null,e=$(c.element),f=function(){if(!e.val())return!1;typeof c.process=="function"?c.process(c.element,a):typeof c.process=="object"&&(c.process.start(),$.ajax(c.process))};e.keyup(function(){c.duration>0?(d&&(clearTimeout(d),d=null),d=setTimeout(f,c.duration)):f()})}})})()

//mo.ui.overlay
Mo.register("ui.overlay",function(){var c,b=$(window),d={layer:null,create:function(){c=$("body"),this.layer=$('<div class="mo-ui-overlay" />').appendTo("body")},hide:function(){this.layer.hide()},show:function(){this.layer===null&&this.create();var a=b.height(),d=c.outerHeight(),e=0;return e=a>=d?a:d,this.layer.css({height:e,opacity:.4}).show(),this.layer}};return d});

//mo.ui.flyout
Mo.register("ui.flyout",function(){return function(a,b){var c=null,d=Mo._Constructor.flyout;return void 0===a?d:("string"==typeof a&&((c=d.template[a])?(a=$(c.element),b=b?$.extend(c.options,b):c.options):a=$(a),$("body").append(a)),a.data("flyout")||a.data("flyout",new d(a,b)),a.data("flyout"))}}),Mo.register("_Constructor.flyout",function(a){var b=$(window),c=$(document),d=Base.extend({constructor:function(b,c){this._baseFlyoutConstructor(b,c),this.element.on("keydown",function(){}).on("click",function(a){a.stopPropagation()}),this._primayId=a.utils.randomKey(),this.element.attr("data-flyout-primayId","M-flyout-"+this._primayId),d.cache[this.primayId]=this},_element:null,_anchor:null,_where:{},parasitic:{},_baseFlyoutConstructor:function(a,b){this.setting={onRendered:$.noop,onShow:$.noop,onHide:$.noop,destroy:!1,ruleOutMe:!1,sameAnchorHide:!0,hideDirect:"default",stayTime:0,anchorStay:!1,hideOffset:10,showOffset:10,showDuration:150,easing:"swing",classStyle:""},this.element=a,this._originalHTML=a.html(),this._placement="top",this._alignment="center",this.element.addClass("mo-ui-flyout").css({position:"absolute"}),b&&($.extend(this.setting,b),b.anchor&&(this._anchor=b.anchor),this.element.addClass(this.setting.classStyle)),this.setting.onRendered.call(this,a)},show:function(a,b,c){this._baseFlyoutShow(a,b,c)},hide:function(){this._baseFlyoutHide(),c.unbind("click",this.hide)},_createStayTimer:function(){var a=this;this.setting.stayTime&&(this._clearStay(),this._stayTimer=setTimeout(function(){a.hide()},this.setting.stayTime+this.setting.showDuration))},_clearStay:function(){this._stayTimer&&(clearTimeout(this._stayTimer),this._stayTimer=null)},_fixed:function(){d.currentShowFlyout},destroy:function(){return this.element.remove(),d.cache[this.primayId]=null,null},recover:function(){this.element.html(this._originalHTML)},_baseFlyoutShow:function(a,b,e){var f=this,g=this.element,h=!1;if(a?a.jquery||(a=$(a)):a=this._anchor,b||(b=this._placement),e||(e=this._alignment),!a)throw"\u6ca1\u6709\u6807\u8bb0\u951a\u70b9";this._currentAnchor&&this._currentAnchor[0]==a[0]&&(h=!0),this._currentAnchor=a,this._currentPlacement=b,this._currentAlignment=e,d.currentShowFlyout=this,a&&this._getTopLeft(),this._hideAllVisibleFlyout(this),h&&this.setting.sameAnchorHide&&g.is(":visible")?this.hide():(!h||h&&!this.setting.sameAnchorHide||h&&this.setting.sameAnchorHide&&g.is(":hidden"))&&(c.unbind("click",$.proxy(this.hide,this)),f._createStayTimer(),g.show().css("z-index",this._getZIndex(a)).css(this._startPosition).animate(this._endPosition,{easing:this.setting.easing,duration:this.setting.showDuration,complete:function(){c.one("click",$.proxy(f.hide,f))}}),f.setting.onShow.call(f,g,a))},_baseFlyoutHide:function(){this._clearStay();var a=this,b={opacity:0},c=this.setting.hideOffset;switch(this.setting.hideDirect){case"top":b.top=this.element.offset().top-c;break;case"bottom":b.top=this.element.offset().top+c;break;case"left":b.left=this.element.offset().left-c;break;case"right":b.left=this.element.offset().left+c;break;default:}this.element.animate(b,{easing:this.setting.easing,duration:100,complete:function(){$(this).hide(),a.setting.destroy&&a.destroy()}}),this.setting.onHide.call(this,this.element,this._currentAnchor)},_hideAllVisibleFlyout:function(a){$(".mo-ui-flyout").each(function(){var b=$(this),c=b.data("flyout");c===a&&a.element.is(":visible")&&a.setting.onHide.call(a,a.element,a._currentAnchor),c&&b.is(":visible")&&c!==a&&!c.setting.ruleOutMe&&c.hide()})},_getZIndex:function(a){var b=2e3,c=a.parentsUntil("body").last().css("z-index");return"auto"!=c&&c>=b&&(b=c+1),b},_getTopLeft:function(){var a=this._currentAnchor,c={left:a.offset().left,right:a.offset().left+a.outerWidth(),top:a.offset().top,bottom:a.offset().top+a.outerHeight(),width:a.outerWidth(),height:a.outerHeight()},d={width:this.element.outerWidth(),height:this.element.outerHeight()};switch(this._currentScrollTop=b.scrollTop(),this._startPosition={opacity:0},this._endPosition={opacity:1},this._currentPlacement){case"top":this._where.at="top",this._fitTop(c,d)||(this._fitBottom(c,d),this._where.at="bottom"),this._centerHorizontally(c,d,this._currentAlignment);break;case"bottom":this._where.at="bottom",this._fitBottom(c,d)||(this._fitTop(c,d),this._where.at="top"),this._centerHorizontally(c,d,this._currentAlignment);break;case"left":this._where.at="left",this._fitLeft(c,d)||(this._fitRight(c,d),this._where.at="right"),this._centerVertically(c,d);break;case"right":this._where.at="right",this._fitRight(c,d)||(this._fitLeft(c,d),this._where.at="left"),this._centerVertically(c,d);break;case"auto":}},_fitTop:function(a,b){return this._nextTop=a.top-b.height,this._nextAnimTop=this._nextTop-this.setting.showOffset,this._nextTop>=0&&this._nextAnimTop>this._currentScrollTop&&this._nextAnimTop+b.height<a.top},_fitBottom:function(a,c){return this._nextTop=a.bottom,this._nextAnimTop=a.bottom+this.setting.showOffset,this._nextTop>=0&&this._nextAnimTop-this._currentScrollTop+c.height<b.height()},_fitLeft:function(a,c){return this._nextLeft=a.left-c.width+this.setting.showOffset,this._nextAnimLeft=this._nextLeft-2*this.setting.showOffset,this._nextLeft>=0&&this._nextLeft+c.width<b.width()},_fitRight:function(a,c){return this._nextLeft=a.right-this.setting.showOffset,this._nextAnimLeft=this._nextLeft+2*this.setting.showOffset,this._nextLeft>=0&&this._nextLeft+c.width<b.width()},_centerVertically:function(a,c){this._nextTop=a.top+a.height/2-c.height/2,0>this._nextTop?this._nextTop=a.top:this._nextTop+c.height>b.height()+b.scrollTop()&&(this._nextTop=a.bottom),this._startPosition.top=this._nextTop,this._startPosition.left=this._nextLeft,this._endPosition.left=this._nextAnimLeft},_centerHorizontally:function(a,b,c){"center"==c?this._nextLeft=a.left+a.width/2-b.width/2:"left"==c?this._nextLeft=a.left:"right"==c&&(this._nextLeft=a.right-b.width),this._startPosition.left=this._nextLeft,this._startPosition.top=this._nextTop,this._endPosition.top=this._nextAnimTop}},{cache:{},currentShowFlyout:null,hideAllFlyout:function(){$(".mo-ui-flyout:visible").each(function(){var a=$(this),b=a.data("flyout");b&&a.is(":visible")&&b.hide()})},template:{confirm:{element:'<div>            				<p class="text"></p>            				<a href="javascript:;" role="ok" class="M-button-s">\u786e\u8ba4</a>            				<a href="javascript:;" role="cancel" class="M-button-s M-button-grey">\u53d6\u6d88</a>            				<span class="mo-ui-arrow-bottom"></span>            			</div>',options:{classStyle:"mo-ui-flyout-confirm"}},info:{element:"<div></div>",options:{stayTime:800,sameAnchorHide:!1,hideDirect:"top"}},prompt:""}});return b.xresize(function(){d.hideAllFlyout()},"resize"),d});

//mo.ui.confirm
Mo.register("ui.confirm",function(a){var b=null,c=null,d=null;return function(a,e,f,g,h,i){i=i===undefined?!1:!0,i==1&&(d=b,b=null),e=e||$.noop,f=f||"",b==null&&(b=Mo.ui.flyout("confirm",{destroy:i,onRendered:function(a){var b=this;a.delegate("a[role]","click",function(){b.hide();var a=$(this).attr("role"),c=b._currentAnchor;return a=="ok"&&b.parasitic.ok(c,b),!1})}}),c=b.element.find("p.text")),b.parasitic={ok:e},f?(c.css("width","auto").show().html(f),b.element.outerWidth()>300&&c.width("250")):c.hide().html(""),b.show(a,g||"top",h||"center"),i&&(b=d)}});

//mo.ui.info
Mo.register("ui.info",function(){var b=null;return function(a,c,d,e,f,g){b=a.data("flyout"),b||(b=Mo.ui.flyout("info",{destroy:!0,stayTime:e||800,classStyle:d||"mo-ui-info-ok",onHide:function(){a.data("flyout",null)},onRendered:function(){a.data("flyout",this)}}),b.element.html(c).mouseenter(function(){b._clearStay()}).mouseleave(function(){b._createStayTimer()}),b.show(a,f||"top",g||"center"))}});

//mo.ui.emotion
;(function(){Mo.register("ui.emotion",function(){var a=!1,b=null,c=Motie.TextareaUtils,d,e,f,g={show:function(){g.get(function(b){b.css({top:f.offset().top+f.height()+10,left:f.offset().left}).show()})},hide:function(){b&&b.hide()},get:function(c){if(b===null){if(a)return;a=!0,$.ajax({url:"/ajax/emotion/all",success:function(d){a=!1,b=$(d).hide(),$("body").append(b),c(b),g.bind()}})}else c(b)},bind:function(){$(document).on("click",g.hide),b.find(".close").click(function(){g.hide()}),b.find("li").click(function(a){var b=e.val(),f=e[0],h=this.title,i=0,j=c.getCursorPos(f);if(c.getSelectedText(f)!=""){var k=Motie.TextareaUtils.getSelectedText(f).length;e.val([b.substring(0,j),"["+this.title+"]",b.substring(j+k,b.length)].join(""))}else e.val([b.substring(0,j),"["+this.title+"]",b.substring(j,b.length)].join(""));return i=j+h.length+2,c.setCursor(f,i,0),g.hide(),d(),!1})}};return function(a,b,c){if(a!==undefined){f=a.jquery?a:$(a),e=b.jquery?b:$(b),d=c||$.noop;if(!a.length){window.console!=undefined&&console.log("Mo.ui.emotion\uff1aanchor\u4e0d\u5b58\u5728\uff0c\u65e0\u6cd5\u5b9a\u4f4d\u8868\u60c5\u5c42\u7684\u663e\u793a\u4f4d\u7f6e");return}if(!b.length){window.console!=undefined&&console.log("Mo.ui.emotion\uff1atextarea\u4e0d\u5b58\u5728\uff0c\u65e0\u6cd5\u63d2\u5165\u8868\u60c5");return}g.show()}return g}})})()

//mo.ui.ico
Mo.register("ui.ico",function(e){var t={check:'<img src="http://img.motieimg.com/_resources/css/img/field.gif" class="ico-rela-check">',checked:'<img src="http://img.motieimg.com/_resources/css/img/field.gif" class="ico-rela-checked">',del:'<img src="http://img.motieimg.com/_resources/css/img/field.gif" class="ico-rela-del">',add:'<img src="http://img.motieimg.com/_resources/css/img/field.gif" class="ico-rela-add">',each:'<img src="http://img.motieimg.com/_resources/css/img/field.gif" class="ico-rela-each">',loading:'<img src="http://img.motieimg.com/_resources/css/img/field.gif" class="ico-load-hor">',sp:'<em class="sp"></em>',close:"\u2716"};return t});

//mo.ui.at
Mo.register("ui.at",function(){return function(){}});

//mo.ui.search
Mo.register("ui.search",function(){function i(a){return $('<li class="clear '+a.className+'"></li>').data("item.autocomplete",a).append(Mustache.to_html(h,a))}function j(a){return a.length>4?a.substring(0,4)+"..":a}function k(a){return a.replace(/(<(.[^>]*)>)|( )/g,"").replace(/</g,"&lt").replace(/>/g,"&gt")}function l(a){var b={book:{storage:[],text:"\u4f5c\u54c1",objectType:2,desc:"\u4f5c\u8005\uff1a"},people:{storage:[],text:"\u4eba",objectType:1,desc:"\u7c89\u4e1d\uff1a"},article:{storage:[],text:"\u6587\u7ae0",objectType:5,desc:"\u4f5c\u8005\uff1a"},group:{storage:[],text:"\u5c0f\u7ec4",objectType:18,desc:"\u6210\u5458\uff1a"}};for(var c in a){var k,d=c,e=a[c],g=b[d],h=g.storage,l={className:"term-link term-is-"+d,itemType:"link",label:"\u641c\u201c<b>"+j(f)+"</b>\u201d\u76f8\u5173"+g.text+">>",value:f,desc:"",link:"/rest/?queryString="+f+"&objectType="+g.objectType};l.element=i(l),h.push(l);for(var m=0,n=e.length;n>m;m++)k=e[m],$.extend(k,{className:"item item-"+d,itemType:"item",label:k.label.replace(RegExp("("+f+")","ig"),"<b>$1</b>"),desc:g.desc+(/people|group/.test(d)?k.count:k.author),value:f}),k.element=i(k),h.push(k)}return[].concat(b.book.storage,b.people.storage,b.article.storage,b.group.storage,[{}])}var c,b={},d=null,e=null,f="",g={book:[],people:[],article:[],group:[]},h=['{{#icon}}<div class="lpic"><img width="36" src="{{icon}}" /></div>{{/icon}}','<div class="rtext"><a class="must-hide"></a><h3>{{{label}}}</h3>','<p class="desc">{{desc}}</p>',"</div>"].join("");return function(a,h){function p(){j.toggleClass("must-hide"),m.toggleClass("must-hide")}var i=$(a),j=i.find(".loadIco"),m=i.find("input[type=submit]"),n=i.find("input.lst").autocomplete({select:function(a,b){window.location.href=b.item.link},open:function(){e=d.find("li")},focus:function(a,b){var c=b.item,d=c.element;e.removeClass("item-current"),d.addClass("item-current"),"item"==c.itemType&&n.val(c.label)},source:function(a,d){if(f=k(a.term),""!=f){if(f in b)return d(l(b[f])),void 0;p(),c=$.ajax({url:h,cache:!1,data:{queryString:f},error:function(){p(),d(l(g))},success:function(a,e,h){p(),b[f]=$.isEmptyObject(a)?g:a,h===c&&d(l(b[f]))}})}}}),o=n.data("autocomplete");d=o.widget().toggleClass("search-result"),d.delegate("li","click",function(){window.location=$(this).data("item.autocomplete").link}).delegate("li","mouseover",function(){e.removeClass("item-current"),$(this).addClass("item-current")}),o._renderItem=function(a,b){return a.append(b.element)},o._move=function(a,b){return this.menu.element.is(":visible")?(this.menu[a](b),void 0):(this.search(null,b),void 0)}}});

//mo.ui.autocomplete
Mo.register("ui.autocomplete",function(e){var t=e.utils.string,n=Base.extend({constructor:function(e,t){this.input=e,this.setting=$.extend({url:"",dataType:"",select:$.noop,open:$.noop,focus:$.noop,classStyle:"",selectFirst:!0},t),this._baseCreateUIAutoComplete()},cache:{},lastXhr:null,list:null,allItem:null,term:"",_baseCreateUIAutoComplete:function(){var e=this;this.input.autocomplete({select:function(t,n){e.setting.select.call(e,t,n)},open:function(t,n){e.allItem=e.list.find("li"),$(this).removeClass("ui-corner-all"),e.setting.open.call(e,t,n),e.setting.selectFirst&&e.list.find("li:first a").trigger("mouseenter")},focus:function(t,n){e.setting.focus.call(e,t,n)},source:function(n,r){e.term=t.peelHtml(n.term);if(e.term=="")return;if(e.term in e.cache){r(e.cache[e.term]);return}e.lastXhr=$.ajax({url:e.setting.url,dataType:"jsonp",data:{word:e.term,count:10},success:function(t,n,i){e.cache[e.term]=$.isEmptyObject(t)?emptyObject:$.map(t.users,function(e){return{label:e.username,value:e.username}}),i===e.lastXhr&&r(e.cache[e.term])}})}}),e.list=this.input.data("autocomplete").widget().toggleClass("mo-ui-autocomplete-result "+this.setting.classStyle)}},{cache:{}});return function(e,t){var r,i,s;return e=e.jquery?e:$(e),e[0]?(r=t.input||e.find("[role=input]"),i=t.submit||e.find("[role=submit]"),s=t.load||e.find("[role=load]"),r[0]?new n(r,t):!1):!1}});

//mo.ui.tags
Mo.register("ui.tags",function(e){var t=Base.extend({constructor:function(e){var t=this,n;this.options=n=$.extend({input:"",ul:"",className:"",max:1e3,disableEnter:!1,onAdd:$.noop,onRemove:$.noop,onOver:$.noop,onRendered:$.noop,onEmpty:$.noop,addAccordingTo:function(){return!0},defaultText:"\u8f93\u5165\u6807\u7b7e",same:!1},e),this.number=0,this.enableAdd=!0,this.input=$(n.input),this.value=$.trim(this.input.val()).split(" "),this.ul=$(n.ul),this.hidden=$('<input type="hidden" name='+(this.input.attr("name")||"tags")+" />"),this.input.after(this.hidden).attr("name",""),this.value[0]!=""&&(this.input.val(""),$.each(this.value,function(e,n){t.add(n)})),this.input.bind("keydown blur",function(e){var r=$(this),i=t.ul,s=$.trim(this.value);if(n.disableEnter){if(e.keyCode!=8)return!1;t.remove(e)}else if(t.number<=t.options.max&&s!=""&&!s.match(/[' '|\u3000]+/)){if(e.type=="blur"&&t.enableAdd||e.type=="keydown"&&(e.keyCode==9||e.keyCode==32)||e.keyCode==13)return t.add(s),this.value="",!1}else t.number>0&&this.value==""&&e.keyCode==8&&i.find("li").size()&&t.remove(e)}),this.input.parent().click(function(){t.input.focus()}).end(),this.ul.delegate("li .rm","click",function(e){t.remove(e)}),this.options.onRendered.call(this)},add:function(e,t){var n=this,r=n.options,i=r.className,s=n.ul,t=t||{},o=this.search(e);if(n.number>=r.max)return r.onOver(n),!1;if(!r.same&&o[0]===!0||!r.addAccordingTo(e))return o[2].find("a").effect("highlight"),!1;n.number++;var u=$('<li class="'+i+'"><a><em title="'+e+'" class="name">'+e+'</em><span title="\u5220\u9664" class="rm"></span></a></li>').data(t);return s.append(u),n.options.onAdd(n,u),n.hidden.val(n.getAll().join(" ")),n},addMore:function(e){var t=this;e=typeof e=="string"?$.trim(e).split(" "):e;if(e==undefined||e[0]=="")return;$.map(e,function(e,n){t.add(e)})},remove:function(e){var t=this,n=t.ul,r,s;if(t.number==0)return opt.onEmpty(t),!1;switch(typeof e){case"object":switch(e.type){case"click":r=$(e.target).parent().parent();break;case"keydown":r=n.find("li:last")}break;case"number":r=n.find("li").eq(i);break;case"string":r=t.search(e)[2]}return r.length&&r.remove(),t.options.onRemove(t,r),t.hidden.val(t.getAll().join(" ")),t.number>0&&t.number--,t},empty:function(){this.ul.empty(),this.hidden.val(""),this.options.onEmpty(this)},search:function(e){var t=this.getAll(),n=[!1,0,null];for(var r=0;r<t.length;r++)if(e==t[r]){n=[!0,r,this.ul.find("li").eq(r)];break}return n},getNumber:function(){return this.number},isMax:function(){return this.number>=this.options.max},getAll:function(){return $.map(this.ul.find("li"),function(e){return $(e).text()})},getValue:function(){return this.hidden.val()}});return function(e){return e?new t(e):t}});

//mo.fx.tab
;(function(){Mo.register("fx.tab",function(a){var b=function(a){var b=this,c=a||{},d=this.handles=$(c.handle),e=this.items=$(c.toggleItem),f=e.size(),g=eventType=c.eventType||"mouseenter",h=c.callback||$.noop,i=(c.show||1)-1,j=c.tabUrl||"",k=c.onSuccess||$.noop,l=c.cache===!0?!0:!1,m=$(c.loading),n=c.hoverStop===undefined?!0:c.hoverStop,o=this.tabsCache=[],p=c.handleClass,q=c.handleCurrentClass,r=c.animate||!1,s=a.auto||!1,t,u=this.duration=a.duration||3e3;n&&e.mouseenter(function(){t&&clearTimeout(t)}).mouseleave(function(){s&&(t=setTimeout(function(){x(w(i))},u))});var v=function(a,c){function f(){e.css("display","none"),c.is("tbody")||c.is("tr")||c.is("td")?c.css("display",""):c.css("display","block")}b.show=a;var d=e.filter(":visible");if(r){if(typeof r=="function")r(b,d,c);else if(typeof r=="string")switch(r){case"opacity":d.stop().animate({opacity:0},function(){$(this).hide()}),c.show().stop().animate({opacity:1});break;case"translation":d.stop().animate({marginLeft:50,marginTop:50,opacity:0},function(){d.hide()}),c.show().stop().css({marginLeft:-50,marginTop:-50,opacity:0}).animate({marginLeft:0,marginTop:0,opacity:1})}}else f()};v(i,e.hide().eq(i)),h(i,d.eq(i),e.eq(i));var w=function(a){if(a>=f-1)return i=0;if(a>=0)return++i},x=function(a){var b=a===undefined?i:a,c=d.eq(b),f=e.eq(b),g=o[b];i=b,c.hasClass(q)||(d.removeClass(q).addClass(p),c.addClass(q),g===undefined&&(g=!1),j!==""&&g==0?(m.stop().animate({opacity:1},"fast"),$.ajax({url:j,cache:!1,data:{name:c.attr("id")},success:function(a){f.html(a).show(),k(b,c,f),l&&(g=!0),m.stop().animate({opacity:0},"fast")}})):v(b,f),h(b,c,f),t&&clearTimeout(t),s&&(t=setTimeout(function(){x(w(b))},u)))};d.removeClass(q).eq(i).addClass(q).end().each(function(a){var b=$(this);eventType.push&&(g=eventType[a]),b[g](function(){t&&clearTimeout(t),x(a)})}),s&&(t=setTimeout(function(){x(w(i))},u)),j!==""&&d.eq(i).removeClass(q).click()};return b}),Motie.Tab=Mo.fx.tab})()

//mo.core.action.confirmToLink
Mo.register("core.action.confirmToLink",function(e){return function(){return Mo.ui.confirm(this,function(t,n){var r=t.data("link"),i=t.data("anchor-text");i&&t.html(i),window.location=r},this.data("confirm-text")||""),!1}});

//mo.core.action.report
Mo.register("core.action.report",function(e){var t="/ajax/exposure/add";return function(e){if(!Mo.CheckLogin(!0))return;var n=this;if(e)try{e=JSON.parse(e)}catch(r){throw"\u5bf9\u8c61\u53c2\u6570\u9519\u8bef"}else{var i=Mo.utils.getFeedData(n);e={objectId:i.feedId,objectType:i.typeId}}var s=(screen.height-700)/2,o=(screen.width-600)/2;window.open(t+"?objectId="+e.objectId+"&objectType="+e.objectType,"\u4e3e\u62a5","height=700,innerHeight=700,width=600,innerWidth=600,top="+s+",left="+o+",toolbar=no,menubar=no,scrollbars=auto,resizeable=no,location=no,status=no")}});

//mo.core.action.follow
Mo.register("core.action.follow",function(a){var b=Mo.ui.ico,c=Mo.core.ajaxStatus,d=Mo.core.callback,e={people:1,book:2,site:21,blog:54},f={add:function(a,b,c,d,g){f.send("/ajax/contact/follow/add/"+b+"/"+e[c],a,g||function(){f.changeBtnStatus(a,c,d,a.attr("data-read-status"))})},del:function(a,b,c,g,h){f.send("/ajax/contact/follow/"+b+"/"+e[c]+"/del",a,h||function(){f.changeBtnStatus(a,c,g,"-1"),d(a,"callback-delFollow",Mo.core.action.follow)(a),d("callback_delFollow",Mo.core.action.follow)(a)})},dontFollowMe:function(a,c,d,g,h){var i=$("a.M-button-s[action-type=follow][data-follow-id="+c+"][data-follow-status="+g+"]");f.send("/ajax/contact/follower/"+c+"/"+e[d]+"/del",a,h||function(){f.status.set(i,5),"1"==g?f.status.set(i,5).html(b.add+b.sp+"\u52a0\u5173\u6ce8"):"3"==g&&f.status.set(i,2).html(b.checked+"\u5df2\u5173\u6ce8"+b.sp+"\u53d6\u6d88"),a.remove()})},outBlacklist:function(a,b,c,d,e){f.send("/ajax/contact/bastard/"+b+"/del",a,"function"==typeof e?e:function(){f.changeBtnStatus(a,c,d)})},removeToBlacklist:function(a,b){var e=a.parentsUntil("div.mod").last().find("a[data-follow-id="+b+"].M-button-b");f.outBlacklist(e,e.data("follow-id"),e.data("follow-type"),""+e.data("follow-status")),f.addToBlacklistStatus(!1)},addToBlacklist:function(a,c,d,e){f.send("/ajax/contact/bastard/add/"+c,a,"function"==typeof e?e:function(){f.addToBlacklistStatus(!0);var e=a.parentsUntil("div.mod").last().find("a[data-follow-id="+c+"].M-button-b");f.status.set(e,4).addClass("M-button-grey").html(b.del+"\u5df2\u52a0\u5165\u9ed1\u540d\u5355"+b.sp+"\u89e3\u9664")})},addToBlacklistStatus:function(a){var b=$("#addFollowOrNot");b.length&&(a?b.html("\u53d6\u6d88\u9ed1\u540d\u5355").attr("data-follow-status","remove-out-blacklist"):b.html("\u52a0\u5165\u9ed1\u540d\u5355").attr("data-follow-status","add-to-blacklist"))},status:{set:function(a,b){return a.attr("data-follow-status",b)}},send:function(e,g,h){if(!c.inProcess(g)){g.timer=setTimeout(function(){c.processing(g).html(b.loading+b.sp+"\u5904\u7406\u4e2d")},1e3);var i=g.clone();$.ajax({url:e,cache:!1,success:function(b){function m(){f.addToBlacklistStatus(!1),h(b)}function n(){a.ui.info(g,b.message)}g.timer&&(clearTimeout(g.timer),g.timer=null),c.done(g).trigger("done");var e=Mo.core.action.follow,j=typeof b,k="",l="";if("boolean"==j&&j||"string"==j&&""!=j)if(d("followSuccess",e)(g,i,b),k=g.attr("data-custom-success")){if(!e[k])throw m(),'\u81ea\u5b9a\u4e49\u65b9\u6cd5\u4e0d\u5b58\u5728\uff1adata-custom-success="'+k+'"\u6ca1\u6709\u6ce8\u518c\u5230mo.core.action.follow';e[k](g,i,m)}else m();else if("object"==j&&"error"==b.code)if(l=g.attr("data-custom-error")){if(!e[l])throw n(),'\u81ea\u5b9a\u4e49\u65b9\u6cd5\u4e0d\u5b58\u5728\uff1adata-custom-error="'+k+'"\u6ca1\u6709\u6ce8\u518c\u5230mo.core.action.follow';e[l](g,n)}else n()}})}},editReadFlyoutElement:'<div class="mo-ui-flyout-box"><a role="change" class="M-button-s M-button-grey" data-read-status="0">\u5728\u8bfb</a> <a role="change" class="M-button-s M-button-grey" data-read-status="2">\u5df2\u8bfb\u5b8c</a>&nbsp; <a href="javascript:;" style="font-size:12px;color:#666" class="cancel-follow">\u53d6\u6d88\u6536\u85cf</a></div>',editReadStatus:null,editBook:function(a,b,c){null==f.editReadStatus&&(f.editReadStatus=Mo.ui.flyout(f.editReadFlyoutElement,{onRendered:function(a){var b=this;this.buttons=a.find("a[role=change]").click(function(){b.buttons.removeClass("M-button-orange"),$(this).addClass("M-button-orange"),$.ajax({url:"/ajax/contact/follow/edit/"+b.parasitic.id,type:"post",data:{status:$(this).data("read-status")},success:function(a){"success"==a.code&&d(b._currentAnchor,"callback-editSuccess",Mo.core.action.follow)(b._currentAnchor,a.message),b.hide()}})}),a.find("a.cancel-follow").click(function(){f.del(b._currentAnchor,b.parasitic.id,"book","2"),b.hide()})},onShow:function(){this.buttons.removeClass("M-button-orange").filter("[data-read-status="+this.parasitic.read+"]").addClass("M-button-orange")}})),f.editReadStatus.parasitic={id:b,type:c,read:a.attr("data-read-status")},f.editReadStatus.show(a,"top","center")},changeBtnStatus:function(c,e,g,h){if("people"==e)switch(g){case"5":f.status.set(c,"2").html(b.checked+"\u5df2\u5173\u6ce8"+b.sp+"\u53d6\u6d88").addClass("M-button-grey");break;case"4":f.status.set(c,"5").html(b.add+b.sp+"\u52a0\u5173\u6ce8").removeClass("M-button-grey");break;case"2":f.status.set(c,"5").html(b.add+b.sp+"\u52a0\u5173\u6ce8").removeClass("M-button-grey");break;case"3":f.status.set(c,"1").html(b.check+b.sp+b.add+"\u52a0\u5173\u6ce8").removeClass("M-button-grey");break;case"1":f.status.set(c,"3").html(b.each+"\u4e92\u76f8\u5173\u6ce8"+b.sp+"\u53d6\u6d88").addClass("M-button-grey")}else if("book"==e)switch(g){case"5":f.status.set(c,"2"),c.attr("data-read-status",0),"bookDetail"!=c.data("belong")?c.addClass("M-button-grey").html(b.checked+"\u5728\u8bfb"+a.ui.ico.sp+"\u53d6\u6d88"):d(c,"callback-followThisBook",Mo.core.action.follow)(c,2);break;case"2":switch(f.status.set(c,"2").attr("data-read-status",h),h){case"-1":f.status.set(c,"5").html(b.add+b.sp+"\u6536\u85cf").removeClass("M-button-grey");break;case"0":"edit"==c.attr("control-type")?c.html(b.checked+"\u5728\u8bfb"+b.sp+"\u4fee\u6539").addClass("M-button-grey"):c.html(b.checked+"\u5728\u8bfb"+b.sp+"\u53d6\u6d88").addClass("M-button-grey");break;case"1":c.html(b.checked+"\u5728\u8bfb"+b.sp+"\u4fee\u6539").addClass("M-button-grey");break;case"2":c.html(b.checked+"\u5df2\u8bfb\u5b8c"+b.sp+"\u4fee\u6539").addClass("M-button-grey")}}return c}};return function(){if(this.jquery){if(!Motie.CheckLogin(!0))return;var b=this,c=b.attr("data-follow-type"),d=b.attr("data-follow-id"),e=b.attr("data-follow-status"),g=b.attr("control-type");if("dontFollowMe"==g)return f.dontFollowMe(b,d,c,e),void 0;if("edit"==b.attr("control-type")&&"book"==c&&"2"==e)return f.editBook(b,d,c,e,b.data("read-status")),void 0;switch(e){case"1":f.add(b,d,c,e);break;case"5":f.add(b,d,c,e);break;case"2":f.del(b,d,c,e);break;case"3":f.del(b,d,c,e);break;case"4":f.outBlacklist(b,d,c,e);break;case"add-to-blacklist":f.addToBlacklist(b,d,c,e);break;case"remove-out-blacklist":f.removeToBlacklist(b,d,c,e)}}return f}});

//mo.core.action.comment
Mo.register("core.action.comment",function(a){var c=(a.core.action.comment,Motie.TextareaUtils);Mo.core.ajaxStatus,Mo.ui.ico;var g={show:function(b){function k(a){if($.trim(a)){var c=$(a).hide();if(b.data("comment",c).data("open-status","open").attr("data-ajax-status","done"),customSuccess=b.attr("data-custom-success")){if(!j[customSuccess])throw'\u81ea\u5b9a\u4e49\u65b9\u6cd5\u4e0d\u5b58\u5728\uff1adata-custom-success="'+customSuccess+'"\u6ca1\u6709\u6ce8\u518c\u5230mo.core.action.comment';b.html(i),j[customSuccess](b,g,a)}else b.parentsUntil(".txtbox-item").last().parent().append(c),c.attr({"data-reply-id":e,"data-reply-name":f}),g.bind(c),c.slideDown("fast",function(){c.find("textarea[role=input-comment]").focus(),b.html(i)})}}function l(a){if(h=b.attr("data-custom-error")){if(!j[h])throw'\u81ea\u5b9a\u4e49\u65b9\u6cd5\u4e0d\u5b58\u5728\uff1adata-custom-error="'+h+'"\u6ca1\u6709\u6ce8\u518c\u5230mo.core.action.comment';j[h](b,a)}}var c=a.utils.getFeedData(b),d=b.data("get-count")||10,e=b.attr("data-reply-id")||0,f=b.data("reply-name")||"",h=customSuccess="",i=b.html(),j=a.core.action.comment;b.attr("data-ajax-status","processing").html(a.ui.ico.loading+"\u52a0\u8f7d\u4e2d"),g.get(c.feedId,c.typeId,c.eventId,d,k,l)},hide:function(b){var c=b.data("comment"),d=a.utils.getFeedData(b),e=b.find(".num");c&&(g.getCommentCount(d.feedId,d.typeId,function(a){e.text(a.reply)}),c.slideUp("fast",function(){c.remove(),b.data("comment",null)}))},allowReply:function(a,b,c,d){d=d||$.noop,$.ajax({url:"/ajax/reply/allowReply",data:{type:b,id:c},success:function(a){var b="";if("success"==a.code)d(!0,b,a);else if("error"==a.code){switch(a.message){case"too_fast":b="\u53d1\u7684\u592a\u5feb\u5566\uff0c\u8bf710\u79d2\u540e\u518d\u53d1";break;case"no_login":b="\u60a8\u8fd8\u6ca1\u6709\u767b\u5f55";break;case"no_active":b="\u60a8\u7684\u5e10\u6237\u8fd8\u6ca1\u6709\u9a8c\u8bc1\u90ae\u7bb1";break;case"shutup":b="\u60a8\u7684\u8d26\u53f7\u5df2\u88ab\u7981\u8a00";break;case"not_allow":b='\u53ea\u6709<em class="blue">'+a.name+"</em>\u5173\u6ce8\u7684\u7528\u6237\u624d\u53ef\u4ee5\u56de\u5e94";break;case"book_not_allow":b=a.name}d(!1,b,a)}}})},getCommentCount:function(a,b,c){$.getJSON("/ajax/info/"+a+"/"+b+"?callback=?",function(a){c(a)})},get:function(a,b,c,d,e,f){e=e||$.noop,f=f||$.noop,$.ajax({url:"/ajax/reply/list/"+a+"/"+b+"/"+d,cache:!1,data:{eventId:c},timeout:1e4,error:function(){f()},success:function(a){e(a)}})},send:function(a,b,c,d,e,f,g,h,i,j){$.ajax({url:"/ajax/reply/add/"+a+"_"+b,type:"post",data:{content:f,eventId:c,replyId:d,retwitter:g,replyOriginal:h},error:j,success:function(a){i(a)}})},del:function(b){a.ui.confirm(b,function(a){a.html(Mo.ui.ico.loading+"\u5220\u9664\u4e2d..").attr("data-ajax-status","processing"),$.ajax({url:"/ajax/object/del",type:"post",data:{id:a.attr("data-comment-id"),type:7},success:function(b){b&&(a.html("\u5df2\u5220\u9664").attr("data-ajax-status","done"),a.parentsUntil("div[role=item-comment],li[role=item-comment]").parent().slideUp("fast",function(){$(this).remove()}))}})})},reply:function(a){if(!Motie.CheckLogin(!0))return!1;var b=a.parentsUntil("div[role=data-comment]").last().parent(),d=b.find("form[role=form-comment]"),e=d.find("textarea[role=input-comment]"),f=a.data("reply-name"),h=a.data("comment-id"),i=e.val(),j=e[0],k=i.length,n=(c.getCursorPos(j),"\u56de\u590d@"+f+":"),o=i.indexOf(":"),p=i.substring(0,o+1),q="";g.isAllowReply(a,h,7,function(){/^\u56de\u590d@.*:$/.test(p)?(q=i.replace(p,""),n+=q):""!=$.trim(i)&&(n+=i),e.val(n),k=e.val().length,c.setCursor(j,k,0),d.find("input[role=reply-id]").val(h),b.attr("data-reply-id",h)})},isAllowReply:function(a,b,c,d){g.allowReply(_config,c,b,function(b,c){return b?(d(),void 0):(Mo.ui.info(a,c,"mo-ui-info-warning"),void 0)})},quick:function(b){var j,d=a.utils.getFeedData(b),e=b.data("comment-id"),f=b.data("reply-name"),h=b.data("append-direct")||"bottom",i=b.data("comment-form");g.isAllowReply(b,e,7,function(){function a(){var a=i.find("textarea[role=input-comment]"),b="\u56de\u590d@"+f+":";a.val(b),i.show(),setTimeout(function(){c.setCursor(a[0],b.length,0),a.focus()},1)}function k(){var a=i.find("textarea[role=input-comment]");i.slideUp("fast"),a.val("")}if(i)i.is(":visible")?k():a();else{if(!$("#template-comment").length)throw'Mo.core.action.comment -> action-type="quick-reply"\uff0c\u65e0\u6cd5\u8c03\u7528reply\u6a21\u677f\uff0c\u6a21\u677f\u540d\u79f0\u5fc5\u987b\u662f#template-comment';if(!$("#template-reply").length)throw'Mo.core.action.comment -> action-type="quick-reply"\uff0c\u65e0\u6cd5\u8c03\u7528item\u6a21\u677f\uff0c\u6a21\u677f\u540d\u79f0\u5fc5\u987b\u662f#template-reply';var l=b.parentsUntil("[role=item-comment]").last().parent(),m=b.parentsUntil("[role=data-comment]").last().parent(),n=$(Mustache.to_html($("#template-comment").html(),{replyId:e,feedId:d.feedId,typeId:d.typeId,eventId:d.eventId})).hide();i=n,j=i.find("a[role=submit]"),l.append(n),g.bind(n,function(a){if(j.attr("data-ajax-status","done").html("\u56de\u5e94"),i.find("textarea[role=input-comment]").val("").removeClass("M-textarea-disabled").removeAttr("disabled"),a.code||a.message)"error"==a.code&&Mo.ui.info(b,"\u53d1\u9001\u5931\u8d25","mo-ui-info-warning");else{var c=$(Mustache.to_html($("#template-reply").html(),{data:a}));"bottom"==h?m.find("[role=item-comment]:last").after(c):(c.hide(),m.find("[role=item-comment]:first").before(c),c.slideDown())}k()}),b.data("comment-form",n),a()}})},bind:function(b,d,e){function y(){var c=$.trim(h.val()),d=b.data("feed-id"),i=b.data("feed-type"),l=b.data("event-id")||0,n=b.attr("data-reply-id")||0;return"processing"==h.attr("data-ajax-status")?!1:""==c?(h.focus(),!1):("ajax"==o?g.isAllowReply(u,d,i,function(){u.html(a.ui.ico.loading+a.ui.ico.sp+"\u7a0d\u7b49"),h.addClass("M-textarea-disabled").attr("disabled","disabled"),g.send(d,i,l,n,m,c,k.is(":checked"),j.is(":checked"),w,e)}):f.submit(),void 0)}if(!b.data("binded")){var r,s,f=b.find("form[role=form-comment]"),h=f.find("textarea[role=input-comment]"),i=$(b.data("use-template")),j=f.find("input[name=replyOriginal]"),k=f.find("input[name=forwardMyComment]"),l=b.data("reply-name"),m=b.data("comment-type")||"people",n=f.find("a[role=emotion]"),o=f.data("submit-type")||"ajax",p=f.find("a[role=uploadImageBtn]"),q=f.find("div[role=showUploadImage]"),t=f.find("input[name=imageTempFile]"),u=f.find("a[role=submit], input[role=submit]");if(b.data("old-reply-id",b.data("reply-id")||0),f.length){if(b.data("binded",!0),b.data("feed-type")&&b.data("feed-id")&&f.length&&!/52|51/.test(b.data("feed-type").toString())&&g.allowReply(_config,b.data("feed-type"),b.data("feed-id"),function(a,b){a||f.hide().after('<div class="allow-reply">'+b+"</div>")}),f.data("commentFormBind"))return!1;f.data("commentFormBind",!0),b.attr("role","data-comment"),i=i.length?i.html():['<div role="item-comment" class="txtbox-cc-items item-comment">','<a href="{{data.userVO.url}}">{{data.userVO.name}}\uff1a</a>{{{data.summary}}}<span class="time">({{data.showTime}})</span>','<p class="ar ctl">','<a href="javascript:;" class="action-report color-999" action-type="report" action-params=\'{"objectId":"{{data.id}}","objectType":"7"}\'>\u4e3e\u62a5</a>&nbsp;&nbsp;&nbsp;','<a class="delete" href="javascript:;" action-type="comment" control-type="del" data-comment-id="{{data.id}}">\u5220\u9664</a>',"</p>","</div>"].join("");var v=function(a,c){if(c=c||"prepend",a){h.val("").removeClass("M-textarea-disabled").removeAttr("disabled").focus(),u.attr("data-ajax-status","done").html("\u56de\u5e94");var d=$(Mustache.to_html(i,{data:a})).hide();b.find("[role=list-comment]")[c](d),d.slideDown("fast"),b.find(".txtbox-no-comment").hide(),b.attr("data-reply-id",b.data("old-reply-id")),j.removeAttr("checked"),k.removeAttr("checked")}},w=d?function(a){d(a,v)}:v;if(e=e||function(){u.attr("data-ajax-status","done").html("\u56de\u5e94"),Mo.ui.info(u,"\u7cfb\u7edf\u9519\u8bef\uff0c\u8bf7\u7a0d\u540e\u518d\u8bd5","mo-ui-info-warning")},l){var x="\u56de\u590d@"+l+":";h.val(x),setTimeout(function(){c.setCursor(h[0],x.length,0)},1)}p.length&&t.length&&(q.length&&(r=q.find("img"),s=q.find("a.del-img"),s.click(function(){r.attr("src",""),t.val(""),q.hide()})),Mo.utils.upload({handle:p,append:p,name:"uploadfile",url:"/ajax/icon/twitter/upload",onError:function(){Mo.ui.info(thisFlyout._currentAnchor,"\u56fe\u7247\u683c\u5f0f\u53ea\u80fd\u662fjpg\u3001jpeg\u3001gif\u3001png","mo-ui-info-warning")},onSubmit:function(){p.toggleClass("uploadimgIco loadIco")},onComplete:function(a,b){p.toggleClass("uploadimgIco loadIco").data("hasResource",b);var c=b.indexOf("<");-1!=c&&(b=b.substring(0,c)),t.val(b),q.length&&(q.show(),r.attr("src",b))}})),u.click(function(){return y(),!1}),h.elastic().keyup(function(a){""==$.trim(h.val())&&b.attr("data-reply-id",b.data("old-reply-id")),(a.ctrlKey&&13==a.which||10==a.which)&&y()}),a.ui.at&&a.ui.at(h),n.click(function(){return a.ui.emotion(n,h),!1})}}},status:function(a){return"processing"!=a.attr("data-ajax-status")}};return $(function(){var a=$(".focus-comment textarea");$(".focus-to-comment").click(function(){return a.focus(),!1})}),function(){if(this.jquery){var b=this.attr("control-type");switch(b){case"get":if(g.status(this)&&null==this.data("comment")){if(!Motie.CheckLogin(!0))return;g.show(this)}else g.hide(this);break;case"quick-reply":g.quick(this);break;case"reply":g.reply(this);break;case"del":g.status(this)&&g.del(this)}}return g}});

//mo.core.action.forward
Mo.register("core.action.forward",function(a){var b=!1,c=a.ui.ico,d=a.core.action.comment(),e={dialog:null,validate:function(a,b,c){return Motie.limitTextarea(a,140,b,!0)?(b.hasClass("text-wrong")&&b.removeClass("text-wrong"),c.hasClass("M-button-disabled")&&c.removeClass("M-button-disabled"),!0):(!b.hasClass("text-wrong")&&b.addClass("text-wrong"),!c.hasClass("M-button-disabled")&&c.addClass("M-button-disabled"),!1)},get:function(d,f,g,h){e.dialog=new a.openAjaxDialog({url:"/ajax/object/"+g+"/"+f,layerId:"twitterDiv",effectHide:"fade",hideDuration:200,width:550,onHide:function(b){e.dialog=null,a.ui.emotion().hide(),b.posting=!1},onload:function(i){function o(){var l=$.trim(k.val()),m="",o=a.core.action.forward,p=$.noop,q=d.find(".num");return b||n.hasClass("M-button-disabled")||l.length>140?!1:(b=!0,n.html(c.loading+c.sp+"\u8f6c\u53d1\u4e2d"),e.send(f,g,h,l,function(a){if(b=!1,m=d.attr("data-custom-success")){if(!o[m])throw'\u81ea\u5b9a\u4e49\u65b9\u6cd5\u4e0d\u5b58\u5728\uff1adata-custom-success="'+m+'"\u6ca1\u6709\u6ce8\u518c\u5230mo.core.action.forward';p=o[m]}q.length&&q.text(parseInt(q.text())+1),n.addClass("M-button-green").html(c.check+c.sp+"\u8f6c\u53d1\u6210\u529f\uff01"),$("input[name='twitterPage']").val()&&(location.href=location.href),p(a,j),setTimeout(function(){i.hideLayer()},500)},function(){setTimeout(function(){i.hideLayer()},500)}),void 0)}var j=i.layer,k=j.find("textarea"),l=j.find(".status"),m=j.find("a[role=emotion]"),n=j.find("a[role=submit]");return j.find("#loginForm").length?(_config=0,i.layer.remove(),Mo.CheckLogin(!0),void 0):(n.click(function(){return o(),!1}),k.keyup(function(){e.validate(k,l,n)}).trigger("keyup"),a.ui.at&&a.ui.at(k),m.click(function(){return a.ui.emotion(m,k,function(){e.validate(k,l,n)}),!1}),Motie.TextareaUtils.setCursor(k[0],0,0),k.keypress(function(a){(a.ctrlKey&&13==a.which||10==a.which)&&o()}),void 0)}}),e.dialog.render()},send:function(a,b,c,d,f,g){var h=e.dialog.layer,i=h.find("input[name=specialUrl]").val()||"/ajax/twitter/$1/$2/rt";$.ajax({url:Motie.ProcessUrl(i,[a,b]),cache:!1,type:"post",data:{content:d},success:function(a){f(a)},timeout:1e4,error:function(a,b,c){g(a,b,c)}})}};return function(){if(Motie.CheckLogin(!0)){var c=this,i=a.utils.getFeedData(c);null===e.dialog&&d.allowReply(_config,i.typeId,i.feedId,function(b,d){return b?(e.get(c,i.feedId,i.typeId,i.eventId),void 0):(a.ui.info(c,d,"mo-ui-info-warning"),void 0)})}}});

//mo.core.action.twitter
;(function(){Mo.register("core.action.twitter",function(a){var b={del:function(b){b.attr("data-ajax-stauts")!="processing"&&a.ui.confirm(b,function(c){c.attr("data-ajax-status","processing").html(a.ui.ico.loading+"\u5220\u9664\u4e2d..");var d=a.utils.getFeedData(c),e=c.parentsUntil("div.txtbox-item").last().parent();$.ajax({url:"/ajax/object/del",type:"post",data:{id:d.feedId,type:d.typeId},success:function(a){a&&(c.attr("data-ajax-status","done").html("\u5df2\u5220\u9664"),!e.prev().length&&e.next().addClass("txtbox-item-first"),e.slideUp("fast",function(){$(this).remove()}))}})})}};return function(){if(this.jquery){var a=this.attr("control-type");a=="del"&&b.del(this)}return b}})})()

//mo.core.action.favorite
Mo.register("core.action.favorite",function(e){var t=Mo.core.ajaxStatus,n={set:function(r,i,s,o){if(r.length){var u=r.find(".num"),a=r.attr("data-custom-success"),f=r.find("img[role=status]"),l=e.utils.getFeedData(r);l!==null&&(i=l.feedId,s=l.typeId)}n.send("/ajax/favorite/"+i+"/"+s+"/set",r,o||function(n){t.done(r),n.succ?r.attr("title","\u53d6\u6d88\u559c\u6b22").addClass("favorited"):r.attr("title","\u559c\u6b22").removeClass("favorited"),u.length&&u.text(n.favor),f.length&&f.toggleClass("ico-heart-grey ico-heart-red"),e.ui.info(r,n.succ?"\u8bbe\u7f6e\u559c\u6b22\u6210\u529f":"\u5df2\u53d6\u6d88\u559c\u6b22","mo-ui-info-ok"),a&&e.core.action.favorite[a]&&e.core.action.favorite[a](r,n)})},send:function(e,t,n){$.ajax({url:e,cache:!1,success:function(e){n(e)}})}};return function(r){if(this.jquery){if(!Motie.CheckLogin(!0))return!1;var i=this,s=this.find(".num"),o=i.attr("data-custom-success"),u=this.find("img[role=status]"),a=e.utils.getFeedData(i);if(t.inProcess(i))return;t.processing(i),n.set(i)}return n}});

//mo.core.action.owner
Mo.register("core.action.owner",function(a){var b={2:"\u4f5c\u54c1",19:"\u5c0f\u7ec4",6:"\u8bc4\u8bba",26:"\u5c0f\u7ad9",29:"\u5c0f\u7ad9"},c={layer:null,createReason:function(a){var c=["\u542b\u6709\u5e7f\u544a\u6216\u5783\u573e\u4fe1\u606f","\u542b\u6709\u8272\u60c5\u3001\u6deb\u79fd\u6216\u4f4e\u4fd7\u5185\u5bb9","\u542b\u6709\u6fc0\u8fdb\u65f6\u653f\u6216\u610f\u8bc6\u5f62\u6001\u8bdd\u9898","\u542b\u6709\u4eba\u8eab\u653b\u51fb\u6216\u8005\u6076\u610f\u8a00\u8bba","\u8fdd\u53cd"+b[a]+"\u53d1\u8a00\u89c4\u5219","\u4e0e"+b[a]+"\u4e3b\u9898\u65e0\u5173"],d=[];for(var e=0,f=c.length;e<f;e++)d.push('<label><input type="radio" class="radio" name="rs" /> '+c[e]+"</label><br />");return d.join("")},deleteReason:function(b){var e=b.parentsUntil("[role=item-comment]").parent(),f=b.attr("role"),g=b.attr("data-node-id"),h=b.attr("data-feed-type"),i=b.attr("data-action-url");(new Mo.layer({width:500,layerId:"deleteReason",destroy:!0,data:{action:i,nodeId:g,html:d.reason,reason:c.createReason(h),title:h=="6"?"\u5c4f\u853d":"\u5220\u9664"},onRendered:function(b){var c=b.layer,d=c.find("form"),g=$("#id7"),h=c.find("textarea"),i=c.find("input[name=reason]"),j=c.find("a[role=submit]"),k=c.find("a[role=close]");g.click(function(){h.focus()});var l=c.find(".radio:lt(6)").click(function(){$("#reason-message").empty()});h.click(function(){g.attr("checked","checked")}),j.click(function(){return d.submit(),!1}),k.click(function(){return b.hideLayer(),!1}),d.validate({submitHandler:function(c){var d=!1;l.each(function(a){if(this.checked)return i.val($.trim($(this).parent().text())),d=!0,!1}),!d&&g.is(":checked")&&i.val($.trim(h.val()));if(j.attr("data-ajax-status")=="processing")return;j.attr("data-ajax-status","processing"),j.html(a.ui.ico.loading+a.ui.ico.sp+"\u7a0d\u7b49.."),$(c).ajaxSubmit({success:function(c){j.attr("data-ajax-status","done"),j.addClass("M-button-green").html(a.ui.ico.check+a.ui.ico.sp+"\u63d0\u4ea4\u6210\u529f"),f?(b.hideLayer(),e.slideUp(function(){e.remove()})):$.trim(c)!=""&&(window.location.href=c)}})},rules:{rs:{minlength:1,required:!0},text:{required:"#id7:checked"}},messages:{rs:{required:"\u81f3\u5c11\u9009\u4e00\u9879"},reason:{required:"\u7406\u7531\u4e0d\u80fd\u4e3a\u7a7a\uff01"}},errorClass:"is-error",errorPlacement:function(a,b){$("#reason-message").html(a)}})}})).render()}},d={reason:'<a class="fr pop-close" href="javascript:;"></a><h3>{{title}}\u7406\u7531</h3><div class="sp-20"></div><form action="{{action}}" method="post"><div style="line-height:2em;">{{{reason}}}</div><input type="hidden" name="replyId" value="{{nodeId}}" /><input type="hidden" name="reason" /><div class="sp-20"></div><label for="id7"><input type="radio" class="radio" name="rs" id="id7" />\u5176\u4ed6\u539f\u56e0 (\u586b\u5199\u6846\uff09</label><div class="sp-10"></div><textarea name="text" style="width: 100%; height: 150px; padding: 0;" class="textarea-single" name="reasontext"></textarea><div class="sp-10"></div><p id="reason-message"></p><div class="sp-10"></div><p class="ar"><a href="javascript:;" role="submit" class="M-button-s">\u786e\u5b9a</a> <a href="javascript:;" role="close" class="M-button-s M-button-grey">\u53d6\u6d88</a></p></form>'};return function(a){var b=this;return c.deleteReason(this),!1}});

//mo.core.collect
Mo.register("core.collect",function(){return function(e){$(e||"body").delegate("[data-collect-id]","click",function(e){var t=$(this),n=$(e.target),r=t.data("collect-id"),i=n.data("collect-index")||n.parent().data("collect-index");if(i){var s=new Image;s.src="http://click.motieimg.com/m.gif?id="+r+"&index="+i+"&_="+Math.ceil(Math.random()*1e5);var o=n.is("a")?n:n.parent();if(o.is("a")&&o.attr("target")!="_blank")return setTimeout(function(){window.location.href=o.attr("href")},20),!1}})}});