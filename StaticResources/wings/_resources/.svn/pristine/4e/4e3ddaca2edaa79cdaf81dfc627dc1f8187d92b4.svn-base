Mo.register("staff.update",function(){return Mo.register("ui.xinfo",function(){return function(t,a,e){var s={placement:"top",alignment:"center",destroy:!0,stayTime:800,classStyle:"mo-ui-info-ok"};"string"==typeof e?"error"==e&&(s.classStyle="mo-ui-info-warning"):"object"==typeof e&&(s=$.extend(s,e));var i=Mo.ui.flyout("info",s);return i.element.html(a).mouseenter(function(){i._clearStay()}).mouseleave(function(){i._createStayTimer()}),i.show(t),i}}),function(){function t(t){var a="";if(!t.data("info")){var e=t.attr("boxid"),s=t.data("control-type"),i=reload="";"shelf"==s?(i="/manage/shelf/edit?id="+e,reload="/manage/shelf/reload?id="+e):(i="/manage/box/"+e+"/edit",reload="/manage/ajax/box/"+e+"/reload"),t.data("info",{url:i,reload:reload,id:e}),t.data("status","normal")}var l=t.data("info"),o=t.data("status"),n=$.trim(t.text());return""==n?a+='<a href="'+l.url+'" target="_blank" class="vm"><img src="'+t.find("img:first").attr("src")+'" height="40"></a>':(n=n.substring(0,10),a+='<a href="'+l.url+'" target="_blank" class="text vm">'+t.text()+"</a>"),"normal"==o?a+='<a href="javascript:;" title="点击刷新" class="status vm"></a>':"refreshing"==o&&(a+='<a href="javascript:;" title="正在刷新" class="status refresh vm"></a>'),a+='<span class="arrow"><em class="back">◆</em><em class="front">◆</em></span>'}var a=Mo.ui.xinfo,e=null;$("body").delegate("a[boxid]","mouseenter",function(){var s=$(this),i=s;""==$.trim(s.text())&&(i=s.find("img:first")),null!=e&&e._currentAnchor[0]==this||(e=a(i,t(s),{alignment:"left",stayTime:1500,classStyle:"mo-ui-info-boxid",showOffset:0,onShow:function(t){t.find(".arrow").addClass("at-"+this._where.at),t.delegate(".status","click",function(){if("refreshing"!=s.data("status")){s.data("status","refreshing"),t.find(".status").addClass("refresh");var e=s.data("info");proxy.$.ajax({url:e.reload,cache:!1,success:function(e){s.data("status","normal"),e?t.find(".status").toggleClass("refresh ok"):a(s,"刷新失败","error")},error:function(){s.data("status","normal"),a(s,"服务器错误，稍后再试或者联系管理员","error")}})}})}}))})}}),Mo.register("staff.collect",function(t){var a={button:null,pageData:null,createOver:!1,geting:!1,collects:null,pv:[],ip:[],insert:function(t,e,s,i){var l=$('<a href="http://www.motie.com/click/result?pIds='+e+'" target="_blank" class="mo-ui-collect-tips" />').attr({"collect-id":e,"collect-index":s,id:"mo-collect-id-"+e+"-"+s}).data("element",t);return a.position(t,l),l.html("<b>pv:</b>"+i.pv+" <b>ip:</b>"+i.ip+" <sub>id:"+e+" index:"+s+"</sub>"),$("body").append(l),l},position:function(t,a){var e=t.offset().top+parseInt(t.css("padding-top"))-15,s=t.offset().left-parseInt(t.css("padding-left"));a.css({top:e,left:s})},show:function(){function t(t){e.each(function(){var e=$(this),s=e.data("collect-id"),i=t[s];if(i&&!$.isEmptyObject(i)){var l=e.find("[data-collect-index]");if(l.length)for(var o in i){var n=i[o],r=l.filter("[data-collect-index="+o+"]");r.length&&a.insert(r.first(),s,o,n)}}}),$("body").delegate(".mo-ui-collect-tips","mouseenter",function(){$(this)[0].style.zIndex="1000",$(this).data("element").effect("highlight")}).delegate(".mo-ui-collect-tips","mouseleave",function(){$(this)[0].style.zIndex="100"}),a.createOver=!0}var e=a.collects;if(null==this.pageData){a.geting=!0;var s=[];e.each(function(){s.push("&pIds="+$(this).data("collect-id"))}),a.button.addClass("icon-loading"),$.getJSON("http://www.motie.com/click/ajax/result?callback=?"+s.join(""),function(e){a.geting=!1,t(e),a.pageData=e,a.button.removeClass("icon-loading")})}else $("body").toggleClass("mo-ui-collect-tips-toggle")},setup:function(){null===a.button&&(a.collects=$("body [data-collect-id]"),a.button=$('<li class="icon-btn collect" title="本页PV与IP情况"><a href="javascript:;" class="prime"></a></li>'),a.collects.length?a.button.find(".prime").click(function(){a.geting||a.show()}):a.button.addClass("disabled"))}};return a}),Mo.register("core.staff",function(t){var a=[t.staff.collect];return function(){var e=$('<div class="mo-staff-toolbar mo-staff-toolbar-close"><div class="mod"><div class="hd">Staff</div><div class="bd" style="display:none"><ul></ul></div><div class="ft"><a href="javascript:;" class="close">close</a></div></div></div>'),s=e.find("ul"),i="",l=e.find(".hd"),o=e.find(".bd"),n=(e.find(".ft"),'<li class="line"></li>');"1"===_StaffPowser.analyticsShow&&($.map(a,function(t){t.setup(),s.append(t.button),s.append(n)}),i+='<li class="icon-btn charts"><a class="prime" target="_blank" href="http://www.motie.com/analytics/" title="统计总页"></a></li>',i+=n),i+='<li class="icon-btn manage"><a class="prime" href="/manage/index" title="去后台" target="_blank"></a></li>',i+=n,s.append(i),e.find(".close").click(function(){o.slideUp(150,function(){e.toggleClass("mo-staff-toolbar-close")})}),l.click(function(){e.hasClass("mo-staff-toolbar-close")&&(e.removeClass("mo-staff-toolbar-close"),setTimeout(function(){o.slideDown(150)},300))}),$("body").append(e),t.staff.update()}});