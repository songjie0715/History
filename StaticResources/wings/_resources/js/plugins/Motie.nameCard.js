Motie.nameCard=function(e,a,t,i){var d=this;Motie.nameCard.layer||d.createCard(),this.handle=$(e),this.type=a,this.xid=t,this.atname=i||"",this.getCard=null,this.getSuccess=!1,this.cacheId=this.type+(this.atname?this.atname:this.xid);var o=Motie.nameCard.layer,r=Motie.nameCard.setPosition,s=o.loading,n=o.bd,l=new Motie.openLayer(this.handle,o,{duration:100,showTime:300,onShow:function(e){s.show(),n.empty();var t=Motie.nameCard.checkCache(d.cacheId);t&&!$IE?(s.hide(),n.html(t),r(e)):d.getCard=$.ajax({url:"/ajax/namecard/show",cache:!1,data:{type:d.type,id:d.xid,atname:d.atname},success:function(a){""!=$.trim(a)&&(a=$(a),d.getSuccess=!0,Motie.nameCard.cache[d.cacheId]=a,n.html(a),s.hide(),r(e))},error:function(){s.hide(),n.html(['<div class="load-error ac" style="padding: 20px;">',"people"==a?"没有这个铁粉哟 :(":"这本书不存在哟:(","</div>"].join("")),r(e)}})},onHide:function(e){d.getCard&&d.getCard.abort()}});l.showLayer=function(){}},Motie.nameCard.setPosition=function(e){var a=e.handle,t=$html.scrollTop(),i=$win.height(),d=$main.offset().left,o=$main.width(),r=a.height(),s=(a.width(),a.offset().top),n=a.offset().left,l=Motie.nameCard.layer,h=Motie.nameCard.layer.arrow,c=(Motie.nameCard.layer.bd,0),p=0,m=function(){var e=t+i-s,a=e-r;return!(0==t&&s<l.height()||(a>0?a>=l.height():e>=l.height()||!(a<0)))}(),C=o-(n-d)<355;c=s+r+5,p=n-20,h.removeClass("pos-bl pos-rt pos-br"),m&&!C?(c=s-l.height()-10,h.addClass("pos-bl")):!m&&C?(c=s+r-30,p=n-l.width()-15,h.addClass("pos-rt")):m&&C&&(c=s-l.height()-10,p=n-l.width()+38,h.addClass("pos-br")),e.left=p,e.top=c,l.css({top:c,left:p}).show()},Motie.nameCard.prototype.createCard=function(){this.layer=$('<div class="namecard" visible="display" style="display: none; position: absolute;"><div style="position:relative"><div class="namecard-arrow"></div><table width="100%"><tbody><tr><td class="pop-tl"></td><td class="pop-border"></td><td class="pop-tr"></td></tr><tr><td class="pop-border"></td><td class="pop-content"><div class="mod-author-info mod"><div class="loading-card ac fz-14" style="background: url('+ImgMotie+'/_assets/ajax-loader.gif) no-repeat 100px center; line-height: 200px; height: 200px;">加载中..</div><div class="bd"></div></div></td><td class="pop-border"></td></tr><tr><td class="pop-bl"></td><td class="pop-border"></td><td class="pop-br"></td></tr></tbody></table></div></div>'),Motie.nameCard.layer=this.layer,Motie.nameCard.layer.bd=this.layer.find(".bd"),Motie.nameCard.layer.loading=this.layer.find(".loading-card"),Motie.nameCard.layer.arrow=this.layer.find(".namecard-arrow"),$body.append(this.layer)},Motie.nameCard.layer=null,Motie.nameCard.cache={},Motie.nameCard.checkCache=function(e){return Motie.nameCard.cache[e]||!1},Motie.nameCard.bind=function(e){$("a",e).each(function(){var e=$(this),a=e.attr("href").replace("http://www.motie.com",""),t=a.lastIndexOf("/")+1;t=a.substring(t,a.length),/^\/people\/\d+$/.test(a)?new Motie.nameCard(this,"people",t):a.match(/^\/book\/\d+$/)?new Motie.nameCard(this,"book",t):a.match(/^\/name\//)&&new Motie.nameCard(this,"people",0,t)})};