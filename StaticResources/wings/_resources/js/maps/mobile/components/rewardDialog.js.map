{"version":3,"sources":["mobile/components/rewardDialog.js"],"names":["define","Dialog","BookDetailService","loading","overlay","resultTipDialog","rewardDialog","template","data","quota","balancePrice","addReward","rewardItem","rewardVoid","rewardText","events","show","self","this","$emit","undefined","getBalance","bookId","then","status","result","balances","changeRewardStatus","methods","hideDialog","hide","reward","isZindex","chapterId","setContent","setTimeout","location","href","url","alert","valid","msg","rewardNum"],"mappings":"AAAA,YAIAA,SACA,oBACA,4BACA,qBACA,qBACA,8BACG,SAASC,EAAQC,EAAmBC,EAASC,EAASC,GAErD,GAAIC,GAAe,GAAIL,IACnBM,SAAU,0BACVC,MACIC,MAAO,EACPC,aAAc,GACdC,WAAW,EACXC,cACAC,YAAY,EACZC,WAAY,QAEhBC,QACIC,KAAM,WACF,GAAIC,GAAOC,IACXA,MAAKC,MAAM,sBACeC,SAAtBF,KAAKR,cAAoD,KAAtBQ,KAAKR,cAC5CR,EAAkBmB,WAAWC,QAAQC,KAAK,SAASf,GAC7B,GAAfA,EAAKgB,SACJP,EAAKP,aAAeF,EAAKiB,OAAOC,SAChCT,EAAKE,MAAM,0BAIvBQ,mBAAoB,WACZT,KAAKT,MAAQS,KAAKR,cAClBQ,KAAKL,YAAa,EAClBK,KAAKJ,WAAa,SAElBI,KAAKL,YAAa,EAClBK,KAAKJ,WAAa,UAI9Bc,SACIC,WAAY,WACRX,KAAKY,QAETC,OAAQ,WACJ,GAAId,GAAOC,IAEXf,GAAQa,OACRZ,EAAQ4B,UAAW,EACnB9B,EAAkB6B,OAAOd,EAAKK,OAAQL,EAAKR,MAAOQ,EAAKgB,WAAWV,KAAK,SAASf,GAI5E,OAHAL,EAAQ2B,OACRb,EAAKY,aACLzB,EAAQ4B,UAAW,EACXxB,EAAKgB,QACT,IAAK,GACDnB,EAAgBW,OAChBX,EAAgB6B,WAAW,YAAY,GACvCC,WAAW,WACP9B,EAAgByB,OAChBb,EAAKE,MAAM,OAAOX,EAAKiB,OAAOM,SAChC,IACF,MACJ,KAAK,GACDK,SAASC,KAAO7B,EAAK8B,GACrB,MACJ,QACIC,MAAM/B,EAAKgC,MAAMC,IACjB,MACJ,SACIF,MAAM,gBAM9B,OAAO,UAASjB,EAAQoB,EAAWT,GAK/B,MAJA3B,GAAagB,OAASA,EACtBhB,EAAaG,MAAQiC,EACrBpC,EAAa2B,UAAYA,EAElB3B","file":"../../../mobile/components/rewardDialog.js","sourcesContent":["/**\n * Created by janey on 16/6/20.\n */\n\ndefine([\n'components/dialog',\n'service/bookDetailService',\n'components/loading',\n'components/overlay',\n'components/resultTipDialog'\n], function(Dialog, BookDetailService, loading, overlay, resultTipDialog){\n\n    var rewardDialog = new Dialog({\n        template: '#template-reward-dialog',\n        data: {\n            quota: 0,\n            balancePrice: '',\n            addReward: false,\n            rewardItem: [],\n            rewardVoid: false,\n            rewardText: '确认打赏'\n        },\n        events: {\n            show: function(){\n                var self = this;\n                this.$emit('changeRewardStatus');\n                if( this.balancePrice !== undefined && this.balancePrice !== '' ) return;\n                BookDetailService.getBalance(bookId).then(function(data){\n                    if(data.status == 0){\n                        self.balancePrice = data.result.balances;\n                        self.$emit('changeRewardStatus');\n                    }\n                });\n            },\n            changeRewardStatus: function(){\n                if( this.quota > this.balancePrice ){\n                    this.rewardVoid = true;\n                    this.rewardText = '余额不足';\n                } else{\n                    this.rewardVoid = false;\n                    this.rewardText = '确认打赏';\n                }\n            }\n        },\n        methods: {\n            hideDialog: function(){\n                this.hide();\n            },\n            reward: function(){\n                var self = this;\n\n                loading.show();\n                overlay.isZindex = true;\n                BookDetailService.reward(self.bookId, self.quota, self.chapterId).then(function(data){\n                    loading.hide();\n                    self.hideDialog();\n                    overlay.isZindex = false;\n                    switch (data.status){\n                        case 0:\n                            resultTipDialog.show();\n                            resultTipDialog.setContent(\"恭喜,打赏成功!\", true);\n                            setTimeout(function(){\n                                resultTipDialog.hide();\n                                self.$emit('test',data.result.reward);\n                            },500);\n                            break;\n                        case 1:\n                            location.href = data.url;\n                            break;\n                        case -1:\n                            alert(data.valid.msg);\n                            break;\n                        default:\n                            alert('啊哦,出错了');\n                    }\n                });\n            }\n        }\n    });\n    return function(bookId, rewardNum, chapterId){\n        rewardDialog.bookId = bookId;\n        rewardDialog.quota = rewardNum;\n        rewardDialog.chapterId = chapterId;\n\n        return rewardDialog;\n    };\n});"]}