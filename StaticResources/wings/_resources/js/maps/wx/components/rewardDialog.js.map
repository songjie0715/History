{"version":3,"sources":["wx/components/rewardDialog.js"],"names":["define","Dialog","BookDetailService","loading","overlay","resultTipDialog","rewardDialog","template","data","quota","balancePrice","addReward","rewardItem","rewardVoid","rewardText","changeTextBg","events","show","self","this","$emit","undefined","getBalance","bookId","then","status","result","balances","changeRewardStatus","methods","hideDialog","hide","reward","isZindex","chapterId","setContent","setTimeout","location","href","url","alert","valid","msg","rewardNum"],"mappings":"AAAA,YAIAA,SACA,oBACA,4BACA,qBACA,qBACA,8BACG,SAASC,EAAQC,EAAmBC,EAASC,EAASC,GAErD,GAAIC,GAAe,GAAIL,IACnBM,SAAU,0BACVC,MACIC,MAAO,EACPC,aAAc,GACdC,WAAW,EACXC,cACAC,YAAY,EACZC,WAAY,OACZC,aAAc,WAElBC,QACIC,KAAM,WACF,GAAIC,GAAOC,IACX,QAAQA,KAAKV,OACT,IAAK,KACDU,KAAKJ,aAAe,SACpB,MACJ,KAAK,KACDI,KAAKJ,aAAe,SACpB,MACJ,KAAK,MACDI,KAAKJ,aAAe,SACpB,MACJ,KAAK,MACDI,KAAKJ,aAAe,SACpB,MACJ,KAAK,KACDI,KAAKJ,aAAe,UAG5BI,KAAKC,MAAM,sBACeC,SAAtBF,KAAKT,cAAoD,KAAtBS,KAAKT,cAC5CR,EAAkBoB,WAAWC,QAAQC,KAAK,SAAShB,GAC7B,GAAfA,EAAKiB,SACJP,EAAKR,aAAeF,EAAKkB,OAAOC,SAChCT,EAAKE,MAAM,0BAIvBQ,mBAAoB,WACZT,KAAKV,MAAQU,KAAKT,cAClBS,KAAKN,YAAa,EAClBM,KAAKL,WAAa,SAElBK,KAAKN,YAAa,EAClBM,KAAKL,WAAa,UAI9Be,SACIC,WAAY,WACRX,KAAKY,QAETC,OAAQ,WACJ,GAAId,GAAOC,IAEXhB,GAAQc,OACRb,EAAQ6B,UAAW,EACnB/B,EAAkB8B,OAAOd,EAAKK,OAAQL,EAAKT,MAAOS,EAAKgB,WAAWV,KAAK,SAAShB,GAI5E,OAHAL,EAAQ4B,OACRb,EAAKY,aACL1B,EAAQ6B,UAAW,EACXzB,EAAKiB,QACT,IAAK,GACDpB,EAAgBY,OAChBZ,EAAgB8B,WAAW,YAAY,GACvCC,WAAW,WACP/B,EAAgB0B,OAChBb,EAAKE,MAAM,OAAOZ,EAAKkB,OAAOM,SAChC,IACF,MACJ,KAAK,GACDK,SAASC,KAAO9B,EAAK+B,GACrB,MACJ,QACIC,MAAMhC,EAAKiC,MAAMC,IACjB,MACJ,SACIF,MAAM,gBAM9B,OAAO,UAASjB,EAAQoB,EAAWT,GAK/B,MAJA5B,GAAaiB,OAASA,EACtBjB,EAAaG,MAAQkC,EACrBrC,EAAa4B,UAAYA,EAElB5B","file":"../../../wx/components/rewardDialog.js","sourcesContent":["/**\n * Created by janey on 16/6/20.\n */\n\ndefine([\n'components/dialog',\n'service/bookDetailService',\n'components/loading',\n'components/overlay',\n'components/resultTipDialog'\n], function(Dialog, BookDetailService, loading, overlay, resultTipDialog){\n\n    var rewardDialog = new Dialog({\n        template: '#template-reward-dialog',\n        data: {\n            quota: 0,\n            balancePrice: '',\n            addReward: false,\n            rewardItem: [],\n            rewardVoid: false,\n            rewardText: '确认打赏',\n            changeTextBg: '#ffdc2e'\n        },\n        events: {\n            show: function(){\n                var self = this;\n                switch (this.quota){\n                    case 100:\n                        this.changeTextBg = '#ffdc2e';\n                        break;\n                    case 588:\n                        this.changeTextBg = '#ffb92e';\n                        break;\n                    case 1888:\n                        this.changeTextBg = '#ff962e';\n                        break;\n                    case 5888:\n                        this.changeTextBg = '#ff742e';\n                        break;\n                    case 10000:\n                        this.changeTextBg = '#ff4c2f';\n                        break;\n                }\n                this.$emit('changeRewardStatus');\n                if( this.balancePrice !== undefined && this.balancePrice !== '' ) return;\n                BookDetailService.getBalance(bookId).then(function(data){\n                    if(data.status == 0){\n                        self.balancePrice = data.result.balances;\n                        self.$emit('changeRewardStatus');\n                    }\n                });\n            },\n            changeRewardStatus: function(){\n                if( this.quota > this.balancePrice ){\n                    this.rewardVoid = true;\n                    this.rewardText = '余额不足';\n                } else{\n                    this.rewardVoid = false;\n                    this.rewardText = '确认打赏';\n                }\n            }\n        },\n        methods: {\n            hideDialog: function(){\n                this.hide();\n            },\n            reward: function(){\n                var self = this;\n\n                loading.show();\n                overlay.isZindex = true;\n                BookDetailService.reward(self.bookId, self.quota, self.chapterId).then(function(data){\n                    loading.hide();\n                    self.hideDialog();\n                    overlay.isZindex = false;\n                    switch (data.status){\n                        case 0:\n                            resultTipDialog.show();\n                            resultTipDialog.setContent(\"恭喜,打赏成功!\", true);\n                            setTimeout(function(){\n                                resultTipDialog.hide();\n                                self.$emit('test',data.result.reward);\n                            },500);\n                            break;\n                        case 1:\n                            location.href = data.url;\n                            break;\n                        case -1:\n                            alert(data.valid.msg);\n                            break;\n                        default:\n                            alert('啊哦,出错了');\n                    }\n                });\n            }\n        }\n    });\n    return function(bookId, rewardNum, chapterId){\n        rewardDialog.bookId = bookId;\n        rewardDialog.quota = rewardNum;\n        rewardDialog.chapterId = chapterId;\n\n        return rewardDialog;\n    };\n});"]}