{"version":3,"sources":["wx/controller/chapterList.js"],"names":["$","chapterList","chapterLoad","currentPage","pageSize","isAsc","chapterHtml","ajax","type","url","bookId","data","page","dataType","success","CatalogVO","seltxt","hide","find","filter","this","value","prop","children","eq","text","html","i","catalogs","length","vol","volume","name","chapter","free","isFree","id","booklp","scrollTop","attr","totalPage","parseInt","css","removeAttr","error","chapterPrev","location","href","show","chapterNext","winHeight","window","height","change","e","selectVal","val","on","$that","stopPropagation","preventDefault"],"mappings":"AAAA,YAAAA,GAAEC,YAAaD,EAAEC,gBACjBD,EAAEC,aACEC,YAAY,SAASC,EAAYC,EAASC,GACtC,GAAIC,GAAY,EAChBN,GAAEO,MACEC,KAAK,MACLC,IAAI,iBAAiBC,OAAO,YAC5BC,MACIC,KAAKT,EACLC,SAASA,EACTC,MAAMA,GAEVQ,SAAW,OACXC,QAAQ,SAASC,GACb,GAAIC,GAAO,EACXhB,GAAE,eAAeiB,OACjBd,GAA0B,EAC1BH,EAAE,iBACTkB,KAAK,UACLC,OAAO,WACJ,MAAOC,MAAKC,OAASlB,IAExBmB,KAAK,YAAY,GACVN,EAAShB,EAAE,iBAAiBuB,SAAS,UAAUC,GAAGrB,GAAasB,OAC/DzB,EAAE,kBAAkB0B,KAAKV,EAEzB,KAAI,GAAIW,GAAE,EAAEA,EAAEZ,EAAUa,SAASC,OAAOF,IAEjCZ,EAAUa,SAASD,GAAGG,IACrBxB,GAAc,OAAOS,EAAUa,SAASD,GAAGI,OAAOC,KAAK,SAEpDjB,EAAUa,SAASD,GAAGM,QAAQC,KAC7BC,OAAO,+BAEPA,OAAO,GAGP7B,GADDS,EAAUa,SAASD,GAAGM,QAAQG,IAAMC,OACrB,iCAAiC3B,OAAO,IAAIK,EAAUa,SAASD,GAAGM,QAAQG,GAAG,KAAKrB,EAAUa,SAASD,GAAGM,QAAQD,KAAK,0BAA0BG,OAAO,gBAEtJ,sBAAsBzB,OAAO,IAAIK,EAAUa,SAASD,GAAGM,QAAQG,GAAG,KAAKrB,EAAUa,SAASD,GAAGM,QAAQD,KAAK,0BAA0BG,OAAO,gBAIrKnC,GAAE,YAAYsC,UAAU,GACxBtC,EAAE,cAAc0B,KAAKpB,GACrBN,EAAE,QAAQuC,MAAMpC,YAAcA,EAAYqC,UAAYA,YACnDC,SAASzC,EAAE,QAAQuC,KAAK,iBAAkBE,SAASzC,EAAE,QAAQuC,KAAK,cAAc,EAC/EvC,EAAE,sBAAsB0C,IAAI,aAAa,QAAQC,WAAW,WAE5D3C,EAAE,sBAAsB0C,IAAI,aAAa,WAAWH,KAAK,UAAU,gCAG3EK,MAAM,gBAIdC,YAAY,WACR,MAA4C,IAAzCJ,SAASzC,EAAE,QAAQuC,KAAK,iBACvBO,SAASC,KAAK,SAASrC,QAChB,IAEXV,EAAE,cAAc0B,KAAK,IACrB1B,EAAE,eAAegD,OAClB7C,kBACLH,GAAEC,YAAYC,YAAYC,YAAYC,SAASC,SAEhD4C,YAAY,WACL,MAAGR,UAASzC,EAAE,QAAQuC,KAAK,iBAAkBE,SAASzC,EAAE,QAAQuC,KAAK,cAAc,IAGnFvC,EAAE,cAAc0B,KAAK,IACrB1B,EAAE,eAAegD,OAEjB7C,kBACAH,GAAEC,YAAYC,YAAYC,YAAYC,SAASC,UAIvDL,EAAE,WACD,GAAIkD,GAAUlD,EAAEmD,QAAQC,QACxBpD,GAAE,YAAYoD,OAAOF,GAClBlD,EAAEC,YAAYC,YAAYC,YAAYC,SAASC,SAGnDL,EAAE,6BAA6BqD,OAAO,SAASC,GAC9C,GAAIC,GAAUvD,EAAEoB,MAAMoC,KACtBrD,aAAcoD,EACdpD,cACAH,EAAEC,YAAYC,YAAYC,YAAYC,SAASC,SAGhDL,EAAE,gBAAgByD,GAAG,WAAW,SAASH,GACrC,GAAII,GAAM1D,EAAEoB,KACTsC,GAAM/C,KAAK,WACVN,OAAM,EACNyC,SAASC,KAAK,SAASrC,OAAO,0BAE9BL,OAAM,EACNyC,SAASC,KAAK,SAASrC,OAAO,wBAGlC4C,EAAEK,kBACFL,EAAEM","file":"../../../wx/controller/chapterList.js","sourcesContent":["$.chapterList= $.chapterList || {};\r\n$.chapterList={\r\n    chapterLoad:function(currentPage,pageSize,isAsc){\r\n        var chapterHtml='';\r\n        $.ajax({\r\n            type:'get',\r\n            url:'/wx/ajax/book/'+bookId+'/catalogs',\r\n            data:{\r\n                page:currentPage,\r\n                pageSize:pageSize,\r\n                isAsc:isAsc\r\n            },\r\n            dataType : 'json',\r\n            success:function(CatalogVO){\r\n                var seltxt=''; \r\n                $('.beforesend').hide();\r\n                currentPage = currentPage-1;\r\n                $('.clist_select')\r\n\t\t\t\t    .find('option')\r\n\t\t\t\t    .filter(function() {\r\n\t\t\t\t        return this.value == currentPage; \r\n\t\t\t\t    })\r\n\t\t\t\t    .prop('selected', true);\r\n                seltxt = $(\".clist_select\").children(\"option\").eq(currentPage).text();\r\n                $(\".selectbox-div\").html(seltxt);\r\n\r\n                for(var i=0;i<CatalogVO.catalogs.length;i++){\r\n                \t// console.log(CatalogVO.catalogs[i]);\r\n                    if(CatalogVO.catalogs[i].vol){\r\n                        chapterHtml +='<h2>'+CatalogVO.catalogs[i].volume.name+'</h2>';  \r\n                    }else{\r\n                        if(CatalogVO.catalogs[i].chapter.free){\r\n                            isFree='<span class=\"free\">免费</span>';\r\n                        }else{\r\n                            isFree='';\r\n                        }\r\n                        if(CatalogVO.catalogs[i].chapter.id == booklp){\r\n                            chapterHtml +='<li class=\"on\"><a href=\"/book/'+bookId+'/'+CatalogVO.catalogs[i].chapter.id+'\">'+CatalogVO.catalogs[i].chapter.name+'<p class=\"chapter-tag\">'+isFree+'</p></a></li>';\r\n                        }else{\r\n                            chapterHtml +='<li><a href=\"/book/'+bookId+'/'+CatalogVO.catalogs[i].chapter.id+'\">'+CatalogVO.catalogs[i].chapter.name+'<p class=\"chapter-tag\">'+isFree+'</p></a></li>';\r\n                        } \r\n                    } \r\n                }\r\n                $('.wrapper').scrollTop(0);\r\n                $('#chapterUl').html(chapterHtml); \r\n                $(\"body\").attr({\"currentPage\":currentPage,\"totalPage\":totalPage}); \r\n                if(parseInt($(\"body\").attr(\"currentPage\"))==(parseInt($(\"body\").attr(\"totalPage\"))-1)){\r\n                    $('.mod-r ul li:eq(2)').css('background','#ddd').removeAttr('onclick');\r\n                }else{\r\n                    $('.mod-r ul li:eq(2)').css('background','#fafafa').attr('onclick','$.chapterList.chapterNext()');\r\n                }\r\n            },\r\n            error:function(){}\r\n        });\r\n        \r\n    },\r\n    chapterPrev:function(){\r\n        if(parseInt($(\"body\").attr(\"currentPage\"))==0){\r\n            location.href=\"/book/\"+bookId;\r\n            return false;\r\n        }\r\n        $('#chapterUl').html(''); \r\n        $('.beforesend').show();\r\n       currentPage--;\r\n\t\t$.chapterList.chapterLoad(currentPage,pageSize,isAsc);\r\n    },\r\n\tchapterNext:function(){\r\n        if(parseInt($(\"body\").attr(\"currentPage\"))==(parseInt($(\"body\").attr(\"totalPage\"))-1)){\r\n            return false;\r\n        }\r\n        $('#chapterUl').html(''); \r\n        $('.beforesend').show();\r\n        \r\n       \tcurrentPage++;\r\n       \t$.chapterList.chapterLoad(currentPage,pageSize,isAsc);\r\n\t}\r\n};\r\n\r\n$(function(){\r\n\tvar winHeight=$(window).height();\r\n\t$('.wrapper').height(winHeight);\r\n    $.chapterList.chapterLoad(currentPage,pageSize,isAsc);\r\n});\r\n\r\n$(\".chapter-selectbox select\").change(function(e) {\r\n\tvar selectVal=$(this).val();\r\n\tcurrentPage = selectVal;\r\n\tcurrentPage++;\r\n\t$.chapterList.chapterLoad(currentPage,pageSize,isAsc);\r\n});\r\n\r\n$(\".chapter-asc\").on('touchend',function(e){\r\n    var $that=$(this);\r\n    if($that.data('status')){\r\n        isAsc=false;\r\n        location.href='/book/'+bookId+'/catalogs?isAsc=false';\r\n    }else{\r\n        isAsc=true;\r\n        location.href='/book/'+bookId+'/catalogs?isAsc=true';\r\n    }\r\n\r\n    e.stopPropagation();\r\n    e.preventDefault();\r\n});\r\n    \r\n"]}