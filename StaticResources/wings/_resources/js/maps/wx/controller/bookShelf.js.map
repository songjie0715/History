{"version":3,"sources":["wx/controller/bookShelf.js"],"names":["define","Vue","bookShelfService","loadingMoreMixin","loading","Dialog","core","hasBookItems","delDialog","template","data","events","show","hide","methods","hideDialog","this","comfirmDel","self","bookId","bookShelfVue","delBookId","delBook","then","status","isDel","delCurBookIdList","push","el","mixins","isLoading","hasNoMore","isManage","isAjaxLoaded","ajaxBookItems","flag","noLoading","scrollBottom","getMoreBook","pageNum","location","href","url","concat","result","followBooks","items","haveNextPage","init","manageType","attached","showDialog","manage","console","log","reload"],"mappings":"AAAA,YAKAA,SACI,MACA,2BACA,yBACA,qBACA,oBACA,QACF,SAASC,EAAIC,EAAkBC,EAAkBC,EAASC,EAAQC,GAEhE,MAAO,UAASC,GAEZ,GAAIC,GAAY,GAAIH,IAChBI,SAAU,4BACVC,QAEAC,QACIC,KAAM,aAGNC,KAAM,cAGVC,SACIC,WAAY,WACRC,KAAKH,QAETI,WAAY,WACR,GAAIC,GAAOF,IACXZ,GAAQQ,MACR,IAAIO,GAASC,EAAaC,SAC1BnB,GAAiBoB,QAAQH,GAAQI,KAAK,SAASb,GAExB,GAAfA,EAAKc,SACLpB,EAAQS,OACRO,EAAaK,OAAQ,EACrBL,EAAaM,iBAAiBC,KAAKR,GACnCD,EAAKL,cASrBO,EAAe,GAAInB,IACnB2B,GAAI,OACJC,QAAS1B,GACTO,MACIe,OAAO,EACPK,WAAW,EACXC,WAAW,EACXV,UAAW,EACXK,oBACAnB,aAAcA,EACdyB,UAAU,EACVC,cAAc,EACdC,iBACAC,MAAM,EACNC,WAAW,GAEfzB,QACI0B,aAAe,WACX,GAAInB,GAAOF,IACX,OAAGA,MAAKoB,eACJpB,KAAKe,WAAY,IAGrBf,KAAKc,WAAY,OACdd,KAAKmB,OACRnB,KAAKmB,MAAO,EAEZjC,EAAiBoC,cAAcpB,EAAKqB,SAAShB,KAAK,SAASb,GAEpC,GAAfA,EAAKc,OACLgB,SAASC,KAAO/B,EAAKgC,IACC,GAAfhC,EAAKc,QACZN,EAAKe,cAAe,EACpBf,EAAKY,WAAY,EACjBZ,EAAKiB,MAAO,EACZjB,EAAKgB,cAAgBhB,EAAKgB,cAAcS,OAAOjC,EAAKkC,OAAOC,YAAYC,QAChEpC,EAAKc,aACZN,EAAKY,WAAY,EACjBZ,EAAKa,WAAY,EACjBb,EAAKiB,MAAO,GAGXzB,EAAKkC,OAAOC,YAAYE,eACzB7B,EAAKkB,WAAY,UAKjCY,KAAM,WACFhC,KAAKiC,YAAa,EAClBjC,KAAKuB,QAAU,GAEnBW,SAAS,aAGTpC,SACIqC,WAAY,SAAUhC,GAClBX,EAAUI,OACVI,KAAKK,UAAYF,GAErBiC,OAAQ,WACCpC,KAAKiC,YAINI,QAAQC,IAAId,SAASC,MACrBD,SAASe,WAJTvC,KAAKgB,UAAW,EAChBhB,KAAKiC,YAAa","file":"../../../wx/controller/bookShelf.js","sourcesContent":["/**\n * Created by janey on 16/6/7.\n */\n\n\ndefine([\n    'vue',\n    'service/bookShelfService',\n    'mixin/loadingMoreMixin',\n    'components/loading',\n    'components/dialog',\n    'core'\n],function(Vue,bookShelfService, loadingMoreMixin, loading, Dialog, core){\n\n    return function(hasBookItems){\n\n        var delDialog = new Dialog({\n            template: '#template-del-book-dialog',\n            data: {\n            },\n            events:{\n                show: function(){\n\n                },\n                hide: function(){\n                }\n            },\n            methods: {\n                hideDialog: function(){\n                    this.hide();\n                },\n                comfirmDel: function(){\n                    var self = this;\n                    loading.show();\n                    var bookId = bookShelfVue.delBookId;\n                    bookShelfService.delBook(bookId).then(function(data){\n\n                        if( data.status == 0 ){\n                            loading.hide();\n                            bookShelfVue.isDel = true;\n                            bookShelfVue.delCurBookIdList.push(bookId);\n                            self.hide();\n                        }\n                    });\n                }\n            }\n        });\n\n\n\n        var bookShelfVue = new Vue({\n            el: '#app',\n            mixins: [loadingMoreMixin],\n            data : {\n                isDel: false,\n                isLoading: false,\n                hasNoMore: false,\n                delBookId: 0,\n                delCurBookIdList: [],\n                hasBookItems: hasBookItems,\n                isManage: false,\n                isAjaxLoaded: false,\n                ajaxBookItems: [],\n                flag: false,\n                noLoading: false\n            },\n            events: {\n                scrollBottom : function(){\n                    var self = this;\n                    if(this.noLoading){\n                        this.hasNoMore = true;\n                        return;\n                    }\n                    this.isLoading = true;\n                    if(this.flag) return;\n                    this.flag = true;\n\n                    bookShelfService.getMoreBook(++self.pageNum).then(function(data){\n\n                        if( data.status == 1 ){\n                            location.href = data.url;\n                        } else if( data.status == 0 ){\n                            self.isAjaxLoaded = true;\n                            self.isLoading = false;\n                            self.flag = false;\n                            self.ajaxBookItems = self.ajaxBookItems.concat(data.result.followBooks.items);\n                        } else if( data.status == -1 ){\n                            self.isLoading = false;\n                            self.hasNoMore = true;\n                            self.flag = false;\n                        }\n\n                        if( !data.result.followBooks.haveNextPage ){\n                            self.noLoading = true;\n                        }\n                    });\n                }\n            },\n            init: function(){\n                this.manageType = false;\n                this.pageNum = 1;\n            },\n            attached:function(){\n\n            },\n            methods: {\n                showDialog: function (bookId) {\n                    delDialog.show();\n                    this.delBookId = bookId;\n                },\n                manage: function(){\n                    if( !this.manageType ){\n                        this.isManage = true;\n                        this.manageType = true;\n                    } else{\n                        console.log(location.href);\n                        location.reload();\n                    }\n                }\n            }\n        });\n    }\n});\n\n"]}