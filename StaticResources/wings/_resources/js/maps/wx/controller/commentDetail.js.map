{"version":3,"sources":["wx/controller/commentDetail.js"],"names":["define","Vue","commentService","Dialog","loadingMoreMixin","legionConfigVue","resultTipDialog","loading","reviewId","haveReplyItem","isLogIn","bookId","haveNextPage","replyDialog","template","data","commentDet","commentLen","errorTip","hasContent","isErrorTip","isReply","contentPLH","commentSelf","events","show","hide","computed","this","length","methods","hideDialog","setComment","review","self","reply","then","status","setContent","reviewDetailVue","hasReply","setTimeout","isPrivateReply","privateReplyList","unshift","result","location","href","url","alert","blurComment","reset","el","mixins","isTipShow","isLoading","hasNoMore","flag","noLoading","isAjaxLoaded","ajaxReplyItems","scrollBottom","getReplyList","pageNum","concat","replys","items","init","attached","$","window","on","scrollY","showDialog"],"mappings":"AAAA,YAKAA,SACA,MACA,yBACA,oBACA,yBACA,0BACA,6BACA,sBACG,SAASC,EAAKC,EAAeC,EAAQC,EAAkBC,EAAiBC,EAAiBC,GAExF,MAAO,UAASC,EAAUC,EAAeC,EAASC,EAAQC,GAEtD,GAAIC,GAAc,GAAIV,IAClBW,SAAU,2BACVC,MACIC,WAAY,GACZC,WAAY,EACZC,SAAU,GACVC,YAAY,EACZC,YAAY,EACZC,SAAS,EACTC,WAAY,SACZC,YAAa,MAEjBC,QACIC,KAAM,aAGNC,KAAM,cAGVC,UACIV,WAAY,WACR,MAAOW,MAAKZ,WAAWa,SAG/BC,SACIC,WAAY,WACRH,KAAKF,QAETM,WAAY,WACsB,GAA1BJ,KAAKZ,WAAWa,SAChBD,KAAKR,YAAa,GAEtBQ,KAAKT,YAAa,GAEtBc,OAAQ,SAAStB,GACb,GAAIuB,GAAON,IAEX,OAA8B,IAA1BA,KAAKZ,WAAWa,QAChBD,KAAKR,YAAa,OAClBQ,KAAKV,SAAW,aAIpBX,EAAQkB,WACRvB,GAAeiC,MAAM3B,EAAU0B,EAAKlB,WAAYL,GAAQyB,KAAK,SAASrB,GAClE,OAAQA,EAAKsB,QACT,IAAK,GACDH,EAAKlB,WAAa,GAClBkB,EAAKH,aACLxB,EAAQmB,OACRpB,EAAgBmB,OAChBnB,EAAgBgC,WAAW,QAAQ,GACnCC,EAAgBC,UAAW,EAC3BC,WAAW,WACPnC,EAAgBoB,OAChBa,EAAgBG,gBAAiB,GACnC,KACFH,EAAgBI,iBAAiBC,QAAQ7B,EAAK8B,OAAOV,MACrD,MACJ,KAAK,GACDW,SAASC,KAAOhC,EAAKiC,GACrB,MACJ,QACI,KACJ,SACIC,MAAM,eAItBC,YAAa,WACqB,GAA1BtB,KAAKZ,WAAWa,SAChBD,KAAKT,YAAa,IAG1BgC,MAAO,WACHvB,KAAKZ,WAAa,OAK1BuB,EAAkB,GAAIlC,IACtB+C,GAAI,OACJC,QAASjD,GACTW,MACIuC,WAAW,EACXC,WAAW,EACXC,WAAW,EACXC,MAAM,EACNC,UAAW9C,IAAgB,EAC3B+C,cAAc,EACdC,kBACAlB,gBAAgB,EAChBF,UAAW/B,EACXkC,qBAEJnB,QACIqC,aAAe,WACX,GAAI3B,GAAON,IACX,OAAGA,MAAK8B,eACJ9B,KAAK4B,WAAY,IAGrB5B,KAAK2B,WAAY,OACd3B,KAAK6B,OACR7B,KAAK6B,MAAO,EACZvD,EAAe4D,aAAatD,IAAY0B,EAAK6B,SAAS3B,KAAK,SAASrB,GAE7C,GAAfA,EAAKsB,OACLS,SAASC,KAAOhC,EAAKiC,IACC,GAAfjC,EAAKsB,QACZH,EAAKyB,cAAe,EACpBzB,EAAKqB,WAAY,EACjBrB,EAAKuB,MAAO,EACZvB,EAAK0B,eAAiB1B,EAAK0B,eAAeI,OAAOjD,EAAK8B,OAAOoB,OAAOC,QAC7DnD,EAAKsB,aACZH,EAAKqB,WAAY,EACjBrB,EAAKsB,WAAY,EACjBtB,EAAKuB,MAAO,GAGX1C,EAAK8B,OAAOoB,OAAOrD,eACpBsB,EAAKwB,WAAY,UAKjCS,KAAM,WACFvC,KAAKmC,QAAU,GAEnBK,SAAS,WACL,GAAIlC,GAAON,IACXyC,GAAEC,QAAQC,GAAG,SAAU,WAEfD,OAAOE,SAAW,IAClBtC,EAAKoB,WAAY,EAEjBpB,EAAKoB,WAAY,KAI7BxB,SACI2C,WAAY,WACR,MAAK/D,OAILG,GAAYY,YAHRqB,SAASC,KAAO,mCAAoCvC,EAAU,kBAAkBG","file":"../../../wx/controller/commentDetail.js","sourcesContent":["/**\n * Created by janey on 16/6/7.\n */\n\n\ndefine([\n'vue',\n'service/commentService',\n'components/dialog',\n'mixin/loadingMoreMixin',\n'components/legionConfig',\n'components/resultTipDialog',\n'components/loading'\n], function(Vue, commentService,Dialog, loadingMoreMixin, legionConfigVue, resultTipDialog, loading){\n\n    return function(reviewId, haveReplyItem, isLogIn, bookId, haveNextPage){\n\n        var replyDialog = new Dialog({\n            template: '#template-comment-dialog',\n            data: {\n                commentDet: '',\n                commentLen: 0,\n                errorTip: '',\n                hasContent: false,\n                isErrorTip: false,\n                isReply: true,\n                contentPLH: '输入回复详情',\n                commentSelf: '回复'\n            },\n            events:{\n                show: function(){\n\n                },\n                hide: function(){\n                }\n            },\n            computed: {\n                commentLen: function(){\n                    return this.commentDet.length;\n                }\n            },\n            methods: {\n                hideDialog: function(){\n                    this.hide();\n                },\n                setComment: function(){\n                    if( this.commentDet.length != 0 ){\n                        this.isErrorTip = false;\n                    }\n                    this.hasContent = true;\n                },\n                review: function(bookId){\n                    var self = this;\n\n                    if( this.commentDet.length == 0 ){\n                        this.isErrorTip = true;\n                        this.errorTip = '请输入回复详情';\n                        return;\n                    }\n                    // this.isErrorTip = false;\n                    loading.show();\n                    commentService.reply(reviewId, self.commentDet, bookId).then(function(data){\n                        switch (data.status){\n                            case 0:\n                                self.commentDet = '';\n                                self.hideDialog();\n                                loading.hide();\n                                resultTipDialog.show();\n                                resultTipDialog.setContent('回复成功', true);\n                                reviewDetailVue.hasReply = true;\n                                setTimeout(function(){\n                                    resultTipDialog.hide();\n                                    reviewDetailVue.isPrivateReply = true;\n                                },2000);\n                                reviewDetailVue.privateReplyList.unshift(data.result.reply);\n                                break;\n                            case 1:\n                                location.href = data.url;\n                                break;\n                            case -1:\n                                break;\n                            default:\n                                alert('啊哦,出错咯');\n                        }\n                    });\n                },\n                blurComment: function(){\n                    if( this.commentDet.length == 0 ){\n                        this.hasContent = false;\n                    }\n                },\n                reset: function(){\n                    this.commentDet = '';\n                }\n            }\n        });\n\n        var reviewDetailVue = new legionConfigVue({\n            el: '#app',\n            mixins: [loadingMoreMixin],\n            data : {\n                isTipShow: false,\n                isLoading: false,\n                hasNoMore: false,\n                flag: false,\n                noLoading: haveNextPage || false,\n                isAjaxLoaded: false,\n                ajaxReplyItems: [],\n                isPrivateReply: false,\n                hasReply: !haveReplyItem,\n                privateReplyList: []\n            },\n            events: {\n                scrollBottom : function(){\n                    var self = this;\n                    if(this.noLoading){\n                        this.hasNoMore = true;\n                        return;\n                    }\n                    this.isLoading = true;\n                    if(this.flag) return;\n                    this.flag = true;\n                    commentService.getReplyList(reviewId, ++self.pageNum).then(function(data){\n\n                        if( data.status == 1 ){\n                            location.href = data.url;\n                        } else if( data.status == 0 ){\n                            self.isAjaxLoaded = true;\n                            self.isLoading = false;\n                            self.flag = false;\n                            self.ajaxReplyItems = self.ajaxReplyItems.concat(data.result.replys.items);\n                        } else if( data.status == -1 ){\n                            self.isLoading = false;\n                            self.hasNoMore = true;\n                            self.flag = false;\n                        }\n\n                        if( !data.result.replys.haveNextPage ){\n                            self.noLoading = true;\n                        }\n                    });\n                }\n            },\n            init: function(){\n                this.pageNum = 1;\n            },\n            attached:function(){\n                var self = this;\n                $(window).on('scroll', function(){\n                    // 如果 scrollY == 100, 评论浮窗显示\n                    if( window.scrollY >= 300){\n                        self.isTipShow = true;\n                    } else {\n                        self.isTipShow = false;\n                    }\n                })\n            },\n            methods: {\n                showDialog: function(){\n                    if( !isLogIn ){\n                        location.href = '/accounts/login?backUrl=/review/'+ reviewId +'/detail?bookId='+bookId;\n                        return;\n                    }\n                    replyDialog.show();\n                }\n            }\n        });\n\n    };\n\n});"]}