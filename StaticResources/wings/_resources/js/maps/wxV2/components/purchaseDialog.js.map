{"version":3,"sources":["wxV2/components/purchaseDialog.js"],"names":["define","Dialog","BookDetailService","loading","overlay","resultTipDialog","core","purchaseDialog","template","data","selectedIndex","selectedChapters","btnList","text","discount","active","costPrice","discountPrice","isActive","balancePrice","redPacket","buyVoid","isGetPrice","unBuyCount","buyText","buyFlag","computed","this","events","show","self","undefined","getDiscount","currentChapter","then","status","obj","result","balances","ticket","$","each","i","v","j","$emit","location","href","url","alert","changeBuyText","methods","hideDialog","hide","purchase","num","chapterId","isZindex","purchaseChapter","isAutoSub","wap_DOMAIN","setContent","setTimeout","reload","select","index","isCheck","isVoid","autoSub"],"mappings":"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","file":"../../../wxV2/components/purchaseDialog.js","sourcesContent":["/**\n * Created by janey on 16/6/20.\n */\n\ndefine([\n'components/dialog',\n'service/bookDetailService',\n'components/loading',\n'components/overlay',\n'components/resultTipDialog',\n'core'\n], function(Dialog, BookDetailService, loading, overlay, resultTipDialog,core){\n\n    var purchaseDialog = new Dialog({\n        template: '#template-buy-dialog',\n        data: {\n            selectedIndex: 0,\n            selectedChapters: 20,\n            btnList: [{\n                text: '后20章',\n                discount: '九折',\n                active: false,\n                costPrice: 0,\n                discountPrice: 0\n            },{\n                text: '后50章',\n                discount: '八折',\n                active: false,\n                costPrice: 0,\n                discountPrice: 0\n            },{\n                text: '后100章',\n                discount: '七折',\n                active: false,\n                costPrice: 0,\n                discountPrice: 0\n            },{\n                text: '后200章',\n                discount: '六折',\n                active: false,\n                costPrice: 0,\n                discountPrice: 0\n            }],\n            isActive: false,\n            balancePrice: '',\n            redPacket: '',\n            costPrice: 0,\n            discountPrice: 0,\n            buyVoid: true,\n            isGetPrice: false,\n            unBuyCount: 0,\n            buyText: '确认购买',\n            buyFlag: false\n        },\n        computed: {\n            buyVoid: function(){\n                if( this.balancePrice &&  this.balancePrice != 0 && this.balancePrice >= this.discountPrice && this.unBuyCount >= this.selectedChapters ){\n                    return false;\n                } else if( this.redPacket &&  this.redPacket != 0 && this.redPacket >= this.costPrice && this.unBuyCount >= this.selectedChapters ){\n                    return false;\n                } else {\n                    return true;\n                }\n            }\n        },\n        events: {\n            show: function(){\n                var self = this;\n                if ( this.buyFlag ) return;\n                this.buyFlag = true;\n                if( this.balancePrice != undefined && this.balancePrice !== '' ) return;\n                BookDetailService.getDiscount(self.currentChapter).then(function(data){\n                    switch ( data.status ){\n                        case 0:\n                            var obj = data.result.discount;\n                            self.isGetPrice = true;\n                            self.balancePrice = data.result.balances;\n                            self.redPacket = data.result.ticket;\n                            $.each(obj, function(i,v){\n                                self.btnList[i].costPrice = v[0];\n                                self.btnList[i].discountPrice = v[1];\n                            });\n\n                            var j = self.selectedIndex;\n\n                            self.costPrice = self.btnList[j].costPrice;\n                            self.discountPrice = self.btnList[j].discountPrice;\n                            self.unBuyCount = data.result.unBuyCount;\n\n\n                            self.$emit('changeBuyText');\n                            self.buyFlag = false;\n                            break;\n                        case 1:\n                            location.href = data.url;\n                            break;\n                        case -1:\n                            alert('啊哦,出错了');\n                            break;\n                        default:\n                            alert('啊哦,出错了');\n                    }\n                });\n            },\n            changeBuyText: function(){\n                if( this.balancePrice < this.discountPrice && this.redPacket < this.costPrice ){\n                    this.buyText = '余额不足';\n                }\n\n                if( this.balancePrice >= this.discountPrice || this.redPacket >= this.costPrice ){\n                    this.buyText = '确认购买';\n                }\n\n                if( this.unBuyCount < this.selectedChapters ){\n                    this.buyText = '剩余章节不足';\n                } else {\n                    this.buyText = '确认购买'\n                }\n            }\n        },\n        methods: {\n            hideDialog: function(){\n                this.hide();\n            },\n            purchase: function(num){\n                var self = this;\n                var chapterId = this.currentChapter;\n                loading.show();\n                overlay.isZindex = true;\n\n                BookDetailService.purchaseChapter(num, chapterId, self.isAutoSub).then(function(data){\n                    loading.hide();\n                    self.hideDialog();\n                    overlay.isZindex = false;\n                    // resultTipDialog.show();\n\n                    switch (data.status){\n                        case 1:\n                            location.href = core.wap_DOMAIN + data.url;\n                        break;\n                        case -1:\n                            resultTipDialog.show();\n                            resultTipDialog.setContent(\"抱歉,购买失败,请重新购买!\", false);\n                            setTimeout(function(){\n                                location.reload();\n                            }, 1000);\n                        break;\n                        default:\n                            alert('啊哦,出错了');\n                    }\n\n\n                });\n            },\n            select: function(index){\n                this.selectedIndex = index;\n\n                switch (index){\n                    case 0:\n                        this.selectedChapters = 20;\n                        break;\n                    case 1:\n                        this.selectedChapters = 50;\n                        break;\n                    case 2:\n                        this.selectedChapters = 100;\n                        break;\n                    case 3:\n                        this.selectedChapters = 200;\n                        break;\n                    default:\n                        this.selectedChapters = 20;\n                }\n\n                this.costPrice = this.btnList[index].costPrice;\n                this.discountPrice = this.btnList[index].discountPrice;\n\n\n                this.$emit('changeBuyText');\n\n            },\n            isCheck: function(index){\n                return index == this.selectedIndex;\n            },\n            isVoid: function(index){\n\n            }\n        }\n    });\n    return function(chapterId, autoSub){\n        purchaseDialog.currentChapter = chapterId;\n        purchaseDialog.autoSub = autoSub || false;\n        return purchaseDialog;\n    };\n});"]}