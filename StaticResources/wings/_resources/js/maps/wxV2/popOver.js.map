{"version":3,"sources":["wxV2/popOver.js"],"names":["$","fn","extend","popOver","options","setLayoutPos","elem","layoutHeight","$layout","innerHeight","layoutLeft","innerWidth","offset","top","left","layoutOffsetTop","layoutOffsetLeft","winHeight","window","height","opts","direction","addClass","$this","this","data","$elemPopOver","show","attr","hide","removeClass","defaults","tpl","layout","IdProp","$tpl","append","on","event","preventDefault","stopPropagation","scrollEnd","callback","timeout","scroll","clearTimeout","setTimeout","haveTap","$elem","$topNav","$botNav","$fz","$pd","find","load","touch","d","Date","type","$targetElem","target","parentNode","hasClass","startX","touches","clientX","startY","clientY","currentTime","getTime","tapLength","lastTap","showTap","document","endX","changedTouches","endY","addEventListener","e","$wrapper","$lightImg","$lightText","$staticFontBulb","$staticFontBulbImg","$imgPlus","$imgMinus","localStorage","setItem","cookie","path","expires","GLOBAL_PATH","html","$img","$fontChange","closest","$menuFontBulb","$menuFontBulbLightImg","$menuFontBulbLightText","$topBotNav","location","href","STATUS","_hmt","push","bookId","chapterId","min","max","elm","fontSize","size","Number","css","font-size","line-height","unbind","self","val","ajax","url","backUrl","dataType","success","result","status"],"mappings":"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","file":"../../wxV2/popOver.js","sourcesContent":["/**\n * Created by janey on 16/8/2.\n */\n\n$.fn.extend({\n    popOver: function(options){\n        var $this = $(this);\n        var elem = $(this).data('prop');\n        var $elemPopOver = $('#'+elem);\n        var show = $(this).attr('showPop');\n\n        if( show === 'true' ){\n            $elemPopOver.hide();\n            $this.removeClass('showPop');\n            $(this).attr('showPop', 'false');\n            $(this).removeClass('chapterFontSize-on');\n            return;\n        }\n\n        if( show === 'false' ){\n            $elemPopOver.show();\n            $this.addClass('showPop');\n            $(this).attr('showPop', 'true');\n            $(this).addClass('chapterFontSize-on');\n            return;\n        }\n\n        var defaults = {\n            tpl: '<a>哈哈,我是popOver</a>',\n            layout: '<div class=\"popOver\" data-show=true></div>',\n            direction: 'up'\n        };\n\n        var opts = $.extend(defaults, options);\n\n        var IdProp = $(this).data('prop');\n        var $tpl = $(opts.tpl);\n        var $layout = $(opts.layout);\n        $layout.attr('id', IdProp);\n\n        $layout.append($tpl);\n        $this.append($layout);\n\n        function setLayoutPos(elem){\n            var layoutHeight = $layout.innerHeight();\n            var layoutWidth = $layout.innerWidth();\n\n            var layoutTop = elem.offset().top;\n            var layoutLeft = elem.offset().left;\n            var layoutOffsetTop = 0;\n            var layoutOffsetLeft = 0;\n            var winHeight=$(window).height();\n\n\n            if( opts.direction == 'up' ){\n                layoutOffsetTop = (winHeight- elem.innerHeight() - layoutHeight - 30  );\n                $layout.addClass('up');\n                layoutOffsetLeft = layoutLeft;\n            }\n            if( opts.direction == 'down' ){\n                // layoutOffsetTop = layoutHeight+10;\n                $layout.addClass('down');\n                layoutOffsetLeft = layoutLeft;\n            }\n\n\n            // $layout.css({\n            //     top: layoutOffsetTop+'px',\n            //     left: layoutOffsetLeft+'px'\n            //\n            // });\n            $this.addClass('show');\n        }\n\n        setLayoutPos($this);\n\n        $layout.show();\n\n        $layout.on('touchend',function(event){\n            event.preventDefault();\n            event.stopPropagation();\n        });\n\n\n        $(this).attr('showPop', true);\n    }\n});\n\n$.fn.scrollEnd = function(callback, timeout) {\n    $(this).scroll(function(){\n        var $this = $(this);\n        if ($this.data('scrollTimeout')) {\n            clearTimeout($this.data('scrollTimeout'));\n        }\n        $this.data('scrollTimeout', setTimeout(callback,timeout));\n    });\n};\n\n\n$(function(){\n\n    $('#fontBulb').on('touchend',function (e) {\n        var $this = $(this);\n        var $wrapper = $('.wrapper');\n        var $lightImg = $this.find('img');\n        var $lightText = $this.find('span');\n        var $staticFontBulb = $('.fontBulb');\n        var $staticFontBulbImg = $staticFontBulb.find('img');\n        var $imgPlus = $('.fontSizePlus img');\n        var $imgMinus = $('.fontSizeMinus img');\n\n        if( !$this.data('status')){\n            localStorage.setItem('readStatus', 'night');\n            $.cookie(\"fontBulb\",'changBg', {path: \"/\", expires: 7 });\n            $wrapper.removeClass('day-status').addClass('night-status');\n            $lightImg.attr('src', window.GLOBAL_PATH + '/_resources/img/wx/laikan/chapter-menu_status-on-new.png');\n            $staticFontBulbImg.attr('src',GLOBAL_PATH +'/_resources/img/mobile/chapter_nightn_ico.png');\n            $imgPlus.attr('src',GLOBAL_PATH +'/_resources/img/mobile/chapter_night_aplus_ico.png');\n            $imgMinus.attr('src',GLOBAL_PATH +'/_resources/img/mobile/chapter_night_asub_ico.png');\n            $lightText.html('黑夜');\n\n            $this.data('status', true);\n            $staticFontBulb.data('status', true);\n\n            e.stopPropagation();\n            e.preventDefault();\n        }else{\n            localStorage.setItem('readStatus', 'day');\n            $.cookie(\"fontBulb\",' ', {path: \"/\", expires: 7});\n            $wrapper.removeClass('night-status').addClass('day-status');\n            $lightImg.attr('src', window.GLOBAL_PATH  + '/_resources/img/wx/laikan/chapter-menu_status.png');\n            $staticFontBulbImg.attr('src',GLOBAL_PATH +'/_resources/img/wx/laikan/chapter_day_ico.png');\n            $imgPlus.attr('src',GLOBAL_PATH +'/_resources/img/wx/laikan/chapter_day_aplus_ico.png');\n            $imgMinus.attr('src',GLOBAL_PATH +'/_resources/img/wx/laikan/chapter_day_asub_ico.png');\n            $lightText.html('白天');\n\n            $this.data('status', false);\n            $staticFontBulb.data('status', false);\n            e.stopPropagation();\n            e.preventDefault();\n        }\n    });\n\n    $('.fontBulb').on('touchend',function (e) {\n        var $this = $(this);\n        var $img = $this.find('img');\n        var $fontChange = $this.closest('.font-change');\n        var $imgPlus = $fontChange.find('.fontSizePlus img');\n        var $imgMinus = $fontChange.find('.fontSizeMinus img');\n        var $menuFontBulb = $('#fontBulb');\n        var $menuFontBulbLightImg = $menuFontBulb.find('img');\n        var $menuFontBulbLightText = $menuFontBulb.find('span');\n\n        var $wrapper = $('.wrapper');\n\n        if( !$this.data('status')){\n            $wrapper.removeClass('day-status').addClass('night-status');\n            $img.attr('src', GLOBAL_PATH +'/_resources/img/mobile/chapter_nightn_ico.png');\n            $imgPlus.attr('src',GLOBAL_PATH +'/_resources/img/mobile/chapter_night_aplus_ico.png');\n            $imgMinus.attr('src',GLOBAL_PATH +'/_resources/img/mobile/chapter_night_asub_ico.png');\n            $menuFontBulbLightImg.attr('src', GLOBAL_PATH + '/_resources/img/wx/laikan/chapter-menu_status-on-new.png');\n            $menuFontBulbLightText.html('黑夜');\n\n            $this.data('status', true);\n            $menuFontBulb.data('status', true);\n\n            localStorage.setItem('readStatus', 'night');\n            $.cookie(\"fontBulb\",'changBg', {path: \"/\", expires: 7 });\n            $this.data('status', true);\n            e.stopPropagation();\n            e.preventDefault();\n        }else{\n            $wrapper.removeClass('night-status').addClass('day-status');\n            $img.attr('src', GLOBAL_PATH +'/_resources/img/wx/laikan/chapter_day_ico.png');\n            $imgPlus.attr('src',GLOBAL_PATH +'/_resources/img/wx/laikan/chapter_day_aplus_ico.png');\n            $imgMinus.attr('src',GLOBAL_PATH +'/_resources/img/wx/laikan/chapter_day_asub_ico.png');\n            $menuFontBulbLightImg.attr('src', GLOBAL_PATH  + '/_resources/img/wx/laikan/chapter-menu_status.png');\n            $menuFontBulbLightText.html('白天');\n\n            $this.data('status', false);\n            $menuFontBulb.data('status', false);\n\n            localStorage.setItem('readStatus', 'day');\n            $.cookie(\"fontBulb\",' ', {path: \"/\", expires: 7});\n            e.stopPropagation();\n            e.preventDefault();\n        }\n    });\n\n    //字体弹框\n    var $topNav = $('.chapter-menu-top');\n    var $botNav = $('.chapter-menu-bottom');\n    var $topBotNav = $('.chapter-menu-top, .chapter-menu-bottom');\n    var winHeight = $(window).height();\n    var $fz = $botNav.find('#chapterFontSize');\n    var $pd = $topNav.find('#chapterAutoBuy');\n\n\n    function haveTap($elem){\n        var show = $elem.data('show');\n        if( show ){\n            $('.popOver').hide();\n            $topNav.removeClass('show').hide();\n            $botNav.removeClass('show').hide();\n            $fz.removeClass('showPop');\n            $pd.removeClass('showPop');\n            $('#chapterFontSize').attr('showPop', false);\n            $botNav.find('li').removeClass('chapterFontSize-on');\n            $elem.data('show',false);\n            $('#chapterFontSize, #chapterAutoBuy').data('show', false);\n\n        } else{\n            $topNav.addClass('show').show();\n            $botNav.addClass('show').show();\n\n            $elem.data('show',true);\n        }\n    }\n\n    var startX,startY,endX,endY,firstT, firstF = true, lastTap, showTap;\n\n\n    function load (){\n\n        document.addEventListener('touchstart',touch,false);\n        document.addEventListener('touchmove',touch,false);\n        document.addEventListener('touchend',touch,false);\n\n        function touch (event){\n            var event = event || window.event;\n            var d = new Date();\n\n            switch(event.type){\n                case \"touchstart\":\n                    var $targetElem = $(event.target.parentNode);\n                    if( !$targetElem.hasClass('intro') ){\n                        return;\n                    }\n\n                    startX = event.touches[0].clientX;\n                    startY = event.touches[0].clientY;\n\n                    var currentTime = d.getTime();\n                    var tapLength = currentTime - lastTap;\n\n                    if( tapLength < 300 && tapLength > 0 ){\n                        clearTimeout(showTap);\n                        if( $(document).data('show') ){\n\n                            $('.popOver').hide();\n                            $topNav.removeClass('show').hide();\n                            $botNav.removeClass('show').hide();\n                            $fz.removeClass('showPop');\n                            $pd.removeClass('showPop');\n                            $botNav.find('li').removeClass('chapterFontSize-on');\n                            $(document).data('show',false);\n                            $('#chapterFontSize').data('show', 'no');\n                            $('#chapterAutoBuy').data('show', 'no');\n                        }\n                        event.preventDefault();\n                    }\n\n                    lastTap = currentTime;\n                    break;\n\n                case \"touchend\":\n                    endX = event.changedTouches[0].clientX;\n                    endY = event.changedTouches[0].clientY;\n\n                    if( endX == startX && endY == startY ){\n\n                        showTap = setTimeout(function(){\n                            haveTap($(document));\n                        },300);\n                    }else {\n                        if( $(document).data('show') ){\n                            haveTap($(document));\n                        }\n                    }\n\n                    break;\n                case \"touchmove\":\n                    if( $(document).data('show') ){\n                        event.preventDefault();\n                    }\n                    break;\n            }\n\n        }\n\n    }\n    window.addEventListener('load',load,false);\n\n\n    $('.chapter-menu a').on('touchend',function(event){\n        var $this = $(this);\n        location.href = $this.attr('href');\n        event.preventDefault();\n    });\n\n    $topBotNav.on('touchend',function(e){\n        e.stopPropagation();\n        e.preventDefault();\n    });\n\n    $('.chapter-menu .status').on('touchend',function(event){\n        var $this = $(this);\n        var STATUS = $this.data('status');\n        _hmt.push(['_trackEvent', 'menu', 'menu_'+STATUS, bookId+'/'+chapterId]);\n        event.preventDefault();\n    });\n\n\n    //字体变化\n    var min=1.2,max=2.8;\n    var elm = $('.intro');\n    var fontSize= $.cookie(\"fontSize\");\n    var size = 1.6;\n\n    if( fontSize ){\n        fontSize = Number(fontSize);\n        size = fontSize;\n        $('.intro').css({\"font-size\":fontSize+\"rem\",\"line-height\":fontSize*1.8+\"rem\"});\n    }\n\n    $('#chapterFontSize').on('touchend',function(e){\n        var $this = $(this);\n        $this.addClass('chapterFontSize-on');\n        $this.addClass('showPop');\n        $this.popOver({\n            tpl:$('#template-dialog-font').html(),\n            direction: 'up'\n        });\n\n        $('.fontSizePlus, .fontSizeMinus').unbind('touchend');\n\n        $('.fontSizePlus').on('touchend',function(e) {\n            if (size<=max ) {\n                size+=0.2;\n                elm.css({'fontSize' : size+'rem','line-height':size*1.8+'rem'});\n                $.cookie(\"fontSize\",size, { path: \"/\", expires: 7});\n            }\n            e.preventDefault();\n            e.stopPropagation();\n        });\n        $('.fontSizeMinus').on('touchend',function(e) {\n            if (size>=min ) {\n                size-=0.2;\n                elm.css({'fontSize' : size+'rem','line-height':size*1.8 +'rem'});\n                $.cookie(\"fontSize\",size, { path: \"/\", expires: 7});\n            }\n            e.preventDefault();\n            e.stopPropagation();\n        });\n\n        e.preventDefault();\n        e.stopPropagation();\n    });\n\n    $('.fontSizePlus').on('touchend',function(e) {\n        if (size<=max ) {\n            size+=0.2;\n            elm.css({'fontSize' : size+'rem','line-height':size*1.8+'rem'});\n            $.cookie(\"fontSize\",size, { path: \"/\", expires: 7});\n        }\n        e.preventDefault();\n        e.stopPropagation();\n    });\n    $('.fontSizeMinus').on('touchend',function(e) {\n        if (size>=min ) {\n            size-=0.2;\n            elm.css({'fontSize' : size+'rem','line-height':size*1.8 +'rem'});\n            $.cookie(\"fontSize\",size, { path: \"/\", expires: 7});\n        }\n        e.preventDefault();\n        e.stopPropagation();\n    });\n\n    //自动购买\n    $('#chapterAutoBuy').on('touchend',function(e){\n        var self = $(this);\n        self.addClass('showPop');\n        self.popOver({\n            tpl: $('#template-dialog-buy').html(),\n            direction: 'down'\n        });\n\n\n        $('.chapterAuto').on('touchend',function(e) {\n            var $this=$(this);\n            var bookId=$this.find('input[name=\"bookId\"]').val();\n            $.ajax({\n                type:'POST',\n                url : '/ajax/i/autofeed',\n                data :  {\"bookId\" : bookId,\"backUrl\":'/book/' + bookId + '/' + window.chapterId},\n                dataType : 'json',\n                success:function(result){\n                    if(result.status == 1){\n                        location.href = result.url;\n                        return;\n                    }\n                    if(result.status == 0){\n                        if(!$this.data(\"auto\")){\n                            $this.addClass('on');\n                            $this.data('auto',true);\n                        }else{\n                            $this.removeClass('on');\n                            $this.data('auto',false);\n                        }\n                    }\n                }\n            });\n            e.stopPropagation();\n            e.preventDefault();\n        });\n\n        e.stopPropagation();\n        e.preventDefault();\n    });\n\n});\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n"]}