{"version":3,"sources":["wxV2/controller/bookHot.js"],"names":["define","Vue","bookHotService","loadingMoreMixin","core","hotObj","el","mixins","data","sex","female","noMore","BookList","page","haveNextPage","loading","male","created","self","this","history","state","sessionStorage","getItem","JSON","parse","$","animate","scrollTop","scrollY","length","getHotBooks","then","lists","result","list","status","alert","concat","setItem","stringify","currentPage","totalPage","events","getChangeSexBooks","scrollBottom","init","attached","methods","changeStatus","$emit","directTo","pushState","window"],"mappings":"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","file":"../../../wxV2/controller/bookHot.js","sourcesContent":["/**\n * Created by janey on 16/6/7.\n */\n\n\ndefine([\n    'vue',\n    'service/accountService',\n    'mixin/loadingMoreMixin',\n    'core'\n],function(Vue,bookHotService, loadingMoreMixin, core){\n\n    return function(hotObj){\n\n\n        var bookHotVue = new Vue({\n            el: '#app',\n            mixins: [loadingMoreMixin],\n            data : {\n                sex: hotObj.sex,\n                female: {\n                    noMore: false,\n                    BookList: [], //获取的阅读券集合，与原有的集合合并\n                    page: 1, //页码，默认从1开始\n                    haveNextPage: true, //如果有下一页则改变状态，默认为有下一页\n                    loading: true\n                },\n                male: {\n                    noMore: false,\n                    BookList: [], //获取的阅读券集合，与原有的集合合并\n                    page: 1, //页码，默认从1开始\n                    haveNextPage: true, //如果有下一页则改变状态，默认为有下一页\n                    loading: true\n                }\n            },\n            created: function(){\n                var self = this;\n\n                if( history.state != null ){\n                    this.sex = history.state.sex;\n                    hotObj.sex = this.sex;\n                    if( sessionStorage.getItem(hotObj.sex) && JSON.parse(sessionStorage.getItem(hotObj.sex)).BookList != null ){\n\n                        self[hotObj.sex].page = history.state.page;\n                        self[hotObj.sex].BookList =  JSON.parse(sessionStorage.getItem(hotObj.sex)).BookList;\n                        self[hotObj.sex].noMore = history.state.noMore;\n                        self[hotObj.sex].haveNextPage = history.state.haveNextPage;\n\n                        $('html,body').animate({scrollTop:history.state.scrollY},50);\n\n                        if( this[this.sex].BookList.length != 0 ){\n                            this[this.sex].loading = !this[this.sex].loading;\n                        }\n\n                        return;\n                    }\n                }\n                hotObj.page = this[this.sex].page;\n\n\n                bookHotService.getHotBooks(hotObj).then(function (data) {\n\n                    var lists = data.result.list;\n                    if (lists.length == 0) {\n                        self[hotObj.sex].noMore = true;\n                    }\n\n                    switch (data.status) {\n                        case -1:\n                            alert('不好意思，服务器开小差了，请重新刷新页面');\n                            break;\n                        case 0:\n                            self[hotObj.sex].BookList = self[hotObj.sex].BookList.concat(lists);\n\n\n                            if( hotObj.sex == 'female' ){\n                                sessionStorage.setItem('female', JSON.stringify({\n                                    BookList: self[hotObj.sex].BookList\n                                }))\n                            } else {\n                                sessionStorage.setItem('male', JSON.stringify({\n                                    BookList: self[hotObj.sex].BookList\n                                }))\n                            }\n\n                            self[self.sex].loading = !self[self.sex].loading;\n\n                            data.result.currentPage >= data.result.totalPage ? self[hotObj.sex].haveNextPage = false : self[hotObj.sex].haveNextPage = true;\n\n                            break;\n                        default:\n                            ;\n                    }\n\n                })\n            },\n            events: {\n                getChangeSexBooks: function(){\n                    var self = this;\n\n                    if (!this[this.sex].haveNextPage) return;\n\n                    if (this[this.sex].haveNextPage) {\n                        hotObj.sex = this.sex;\n                        hotObj.page = this[this.sex].page;\n                        bookHotService.getHotBooks(hotObj).then(function (data) {\n\n                            var lists = data.result.list;\n\n                            if (lists.length == 0) {\n                                self[hotObj.sex].noMore = true;\n                                self[self.sex].loading = !self[self.sex].loading;\n                            }\n\n                            switch (data.status) {\n                                case -1:\n                                    alert('不好意思，服务器开小差了，请重新刷新页面');\n                                    break;\n                                case 0:\n\n                                    self[hotObj.sex].BookList = self[hotObj.sex].BookList.concat(lists);\n\n                                    if( hotObj.sex == 'female' ){\n                                        sessionStorage.setItem('female', JSON.stringify({\n                                            BookList: self[hotObj.sex].BookList\n                                        }))\n                                    } else {\n                                        sessionStorage.setItem('male', JSON.stringify({\n                                            BookList: self[hotObj.sex].BookList\n                                        }))\n                                    }\n                                    self[self.sex].loading = false;\n\n                                    data.result.currentPage >= data.result.totalPage ? self[hotObj.sex].haveNextPage = false : self[hotObj.sex].haveNextPage = true;\n\n                                    break;\n                                default:\n                                    ;\n                            }\n\n                        })\n                    }\n\n                },\n                scrollBottom : function(){\n\n                    var self = this;\n                    if (!this[this.sex].haveNextPage) return;\n                    if (this[this.sex].haveNextPage) {\n                        hotObj.sex = this.sex;\n                        hotObj.page = ++this[hotObj.sex].page;\n                        bookHotService.getHotBooks(hotObj).then(function(data){\n\n                            var lists = data.result.list;\n\n                            switch (data.status) {\n                                case -1:\n                                    alert('不好意思，服务器开小差了，请重新刷新页面');\n                                    break;\n                                case 0:\n                                    self[hotObj.sex].BookList = self[hotObj.sex].BookList.concat(lists);\n\n                                    if( hotObj.sex == 'female' ){\n                                        sessionStorage.setItem('female', JSON.stringify({\n                                            BookList: self[hotObj.sex].BookList\n                                        }))\n                                    } else {\n                                        sessionStorage.setItem('male', JSON.stringify({\n                                            BookList: self[hotObj.sex].BookList\n                                        }))\n                                    };\n\n                                    data.result.currentPage >= data.result.totalPage ? self[hotObj.sex].haveNextPage = false : self[hotObj.sex].haveNextPage = true;\n                                    break;\n                                default:\n                                    ;\n                            }\n                        })\n                    }\n                }\n            },\n            init: function(){\n            },\n            attached:function(){\n\n            },\n            methods: {\n                changeStatus: function(){\n                    if( this.sex == 'male' && this.male.BookList.length != 0 ){\n                        return;\n                    }\n                    if(this.sex == 'female' && this.female.BookList.length != 0){\n                        return;\n                    }\n                    if( this[this.sex].BookList.length != 0 ){\n                        this.loading = !this.loading;\n                    }\n                    this.$emit('getChangeSexBooks');\n                },\n                directTo: function(sex){\n                    var self= this;\n                    history.pushState({\n                        sex: sex,\n                        scrollY: window.scrollY,\n                        page: self[sex].page,\n                        noMore: self[sex].noMore,\n                        haveNextPage: self[sex].haveNextPage\n                    },'');\n                }\n            }\n        });\n    }\n});\n\n"]}