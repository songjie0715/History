{"version":3,"sources":["wxV2/controller/commentDetail.js"],"names":["define","Vue","commentService","Dialog","loadingMoreMixin","legionConfigVue","resultTipDialog","loading","reviewId","haveReplyItem","isLogIn","bookId","haveNextPage","replyDialog","template","data","commentDet","commentLen","errorTip","hasContent","isErrorTip","isReply","contentPLH","commentSelf","events","show","hide","computed","this","length","methods","hideDialog","setComment","$","trim","review","self","reply","then","status","setContent","reviewDetailVue","hasReply","setTimeout","isPrivateReply","privateReplyList","unshift","result","location","href","url","alert","blurComment","reset","el","mixins","isTipShow","isLoading","hasNoMore","flag","noLoading","isAjaxLoaded","ajaxReplyItems","scrollBottom","getReplyList","pageNum","concat","replys","items","init","attached","window","on","scrollY","showDialog"],"mappings":"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","file":"../../../wxV2/controller/commentDetail.js","sourcesContent":["/**\n * Created by janey on 16/6/7.\n */\n\n\ndefine([\n'vue',\n'service/commentService',\n'components/dialog',\n'mixin/loadingMoreMixin',\n'components/legionConfig',\n'components/resultTipDialog',\n'components/loading'\n], function(Vue, commentService,Dialog, loadingMoreMixin, legionConfigVue, resultTipDialog, loading){\n\n    return function(reviewId, haveReplyItem, isLogIn, bookId, haveNextPage){\n\n        var replyDialog = new Dialog({\n            template: '#template-comment-dialog',\n            data: {\n                commentDet: '',\n                commentLen: 0,\n                errorTip: '评论内容最少5个字',\n                hasContent: false,\n                isErrorTip: false,\n                isReply: true,\n                contentPLH: '输入回复详情',\n                commentSelf: '回复'\n            },\n            events:{\n                show: function(){\n\n                },\n                hide: function(){\n                }\n            },\n            computed: {\n                commentLen: function(){\n                    return this.commentDet.length;\n                }\n            },\n            methods: {\n                hideDialog: function(){\n                    this.hide();\n                    this.errorTip = '评论内容最少5个字';\n                },\n                setComment: function(){\n                    if( this.commentDet.length != 0 ){\n                        this.isErrorTip = false;\n                    }\n                    if(this.commentDet.length > 4){\n                        this.isErrorTip = true;\n                    }else if($.trim(this.commentDet) == ''){\n                        this.isErrorTip = false;\n                    }\n                    this.hasContent = true;\n                },\n                review: function(bookId){\n                    var self = this;\n\n                    // if( this.commentDet.length == 0 ){\n                    //     this.isErrorTip = true;\n                    //     this.errorTip = '请输入回复详情';\n                    //     return;\n                    // }\n                    if( this.commentDet.length == 0){\n                        this.isErrorTip = false;\n                        this.errorTip = '请输入回复详情';\n                        return;\n                    }else if(this.commentDet.length < 5){\n                        this.isErrorTip = false;\n                        this.errorTip = '回复内容最少5个字';\n                        return;\n                    }else if($.trim(this.commentDet) == ''){\n                        this.isErrorTip = false;\n                        this.errorTip = '回复内容不能是空格';\n                        this.commentDet = '';\n                        return;\n                    }else{\n                        this.isErrorTip = true;\n                    }\n\n                    // this.isErrorTip = false;\n                    loading.show();\n                    commentService.reply(reviewId, self.commentDet, bookId).then(function(data){\n                        switch (data.status){\n                            case 0:\n                                self.commentDet = '';\n                                self.hideDialog();\n                                loading.hide();\n                                resultTipDialog.show();\n                                resultTipDialog.setContent('回复成功', true);\n                                reviewDetailVue.hasReply = true;\n                                setTimeout(function(){\n                                    resultTipDialog.hide();\n                                    reviewDetailVue.isPrivateReply = true;\n                                },2000);\n                                reviewDetailVue.privateReplyList.unshift(data.result.reply);\n                                self.isErrorTip = false;\n                                break;\n                            case 1:\n                                location.href = data.url;\n                                break;\n                            case -1:\n                                break;\n                            default:\n                                alert('啊哦,出错咯');\n                        }\n                    });\n                },\n                blurComment: function(){\n                    if( this.commentDet.length == 0 ){\n                        this.hasContent = false;\n                    }\n                },\n                reset: function(){\n                    this.commentDet = '';\n                }\n            }\n        });\n\n        var reviewDetailVue = new legionConfigVue({\n            el: '#app',\n            mixins: [loadingMoreMixin],\n            data : {\n                isTipShow: false,\n                isLoading: false,\n                hasNoMore: false,\n                flag: false,\n                noLoading: haveNextPage || false,\n                isAjaxLoaded: false,\n                ajaxReplyItems: [],\n                isPrivateReply: false,\n                hasReply: !haveReplyItem,\n                privateReplyList: []\n            },\n            events: {\n                scrollBottom : function(){\n                    var self = this;\n                    if(this.noLoading){\n                        this.hasNoMore = true;\n                        return;\n                    }\n                    this.isLoading = true;\n                    if(this.flag) return;\n                    this.flag = true;\n                    commentService.getReplyList(reviewId, ++self.pageNum).then(function(data){\n\n                        if( data.status == 1 ){\n                            location.href = data.url;\n                        } else if( data.status == 0 ){\n                            self.isAjaxLoaded = true;\n                            self.isLoading = false;\n                            self.flag = false;\n                            self.ajaxReplyItems = self.ajaxReplyItems.concat(data.result.replys.items);\n                        } else if( data.status == -1 ){\n                            self.isLoading = false;\n                            self.hasNoMore = true;\n                            self.flag = false;\n                        }\n\n                        if( !data.result.replys.haveNextPage ){\n                            self.noLoading = true;\n                        }\n                    });\n                }\n            },\n            init: function(){\n                this.pageNum = 1;\n            },\n            attached:function(){\n                var self = this;\n                $(window).on('scroll', function(){\n                    // 如果 scrollY == 100, 评论浮窗显示\n                    if( window.scrollY >= 300){\n                        self.isTipShow = true;\n                    } else {\n                        self.isTipShow = false;\n                    }\n                })\n            },\n            methods: {\n                showDialog: function(){\n                    if( !isLogIn ){\n                        location.href = '/wx/accounts/login?backUrl=/wx/review/'+ reviewId +'/detail?bookId='+bookId;\n                        return;\n                    }\n                    replyDialog.show();\n                }\n            }\n        });\n\n    };\n\n});"]}