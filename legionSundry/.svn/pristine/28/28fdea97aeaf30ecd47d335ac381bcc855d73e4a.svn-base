"undefined"!=typeof KJUR&&KJUR||(KJUR={}),"undefined"!=typeof KJUR.jws&&KJUR.jws||(KJUR.jws={}),KJUR.jws.JWSJS=function(){var t=KJUR.jws.JWS,a=KJUR.jws.JWS;this.aHeader=[],this.sPayload="",this.aSignature=[],this.init=function(){this.aHeader=[],this.sPayload=void 0,this.aSignature=[]},this.initWithJWS=function(t){this.init();var a=t.split(".");if(3!=a.length)throw"malformed input JWS";this.aHeader.push(a[0]),this.sPayload=a[1],this.aSignature.push(a[2])},this.addSignature=function(t,a,e,i){if(void 0===this.sPayload||null===this.sPayload)throw"there's no JSON-JS signature to add.";var r=this.aHeader.length;if(this.aHeader.length!=this.aSignature.length)throw"aHeader.length != aSignature.length";try{var s=KJUR.jws.JWS.sign(t,a,this.sPayload,e,i),h=s.split(".");h[0],h[2];this.aHeader.push(h[0]),this.aSignature.push(h[2])}catch(t){throw this.aHeader.length>r&&this.aHeader.pop(),this.aSignature.length>r&&this.aSignature.pop(),"addSignature failed: "+t}},this.addSignatureByHeaderKey=function(t,a){var e=b64utoutf8(this.sPayload),i=new KJUR.jws.JWS;i.generateJWSByP1PrvKey(t,e,a);this.aHeader.push(i.parsedJWS.headB64U),this.aSignature.push(i.parsedJWS.sigvalB64U)},this.addSignatureByHeaderPayloadKey=function(t,a,e){var i=new KJUR.jws.JWS;i.generateJWSByP1PrvKey(t,a,e);this.aHeader.push(i.parsedJWS.headB64U),this.sPayload=i.parsedJWS.payloadB64U,this.aSignature.push(i.parsedJWS.sigvalB64U)},this.verifyAll=function(t){if(this.aHeader.length!==t.length||this.aSignature.length!==t.length)return!1;for(var a=0;a<t.length;a++){var e=t[a];if(2!==e.length)return!1;var i=this.verifyNth(a,e[0],e[1]);if(i===!1)return!1}return!0},this.verifyNth=function(t,e,i){if(this.aHeader.length<=t||this.aSignature.length<=t)return!1;var r=this.aHeader[t],s=this.aSignature[t],h=r+"."+this.sPayload+"."+s,n=!1;try{n=a.verify(h,e,i)}catch(t){return!1}return n},this.verifyWithCerts=function(t){if(this.aHeader.length!=t.length)throw"num headers does not match with num certs";if(this.aSignature.length!=t.length)throw"num signatures does not match with num certs";for(var a=this.sPayload,e="",i=0;i<t.length;i++){var r=t[i],s=this.aHeader[i],h=this.aSignature[i],n=s+"."+a+"."+h,d=new KJUR.jws.JWS;try{var u=d.verifyJWSByPemX509Cert(n,r);1!=u&&(e+=i+1+"th signature unmatch. ")}catch(t){e+=i+1+"th signature fail("+t+"). "}}if(""==e)return 1;throw e},this.readJWSJS=function(a){if("string"==typeof a){var e=t.readSafeJSONString(a);if(null==e)throw"argument is not safe JSON object string";this.aHeader=e.headers,this.sPayload=e.payload,this.aSignature=e.signatures}else try{if(!(a.headers.length>0))throw"malformed header";if(this.aHeader=a.headers,"string"!=typeof a.payload)throw"malformed signatures";if(this.sPayload=a.payload,!(a.signatures.length>0))throw"malformed signatures";this.signatures=a.signatures}catch(t){throw"malformed JWS-JS JSON object: "+t}},this.getJSON=function(){return{headers:this.aHeader,payload:this.sPayload,signatures:this.aSignature}},this.isEmpty=function(){return 0==this.aHeader.length?1:0}};